{"config":{"lang":["en","zh"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Shioaji","text":"<p>Shioaji is the most pythonic API for trading the Taiwan and global financial market. You can integrated your favorite Python packages such as NumPy, pandas, PyTorch or TensorFlow to build your trading model with the Shioaji API on cross-platform.</p> <p>We are in early-release alpha. Expect some adventures and rough edges.</p> <p>The key features are:</p> <ul> <li> <p>Fast: High performance with c++ implement core and FPGA event broker.</p> </li> <li> <p>Easy: Designed to be easy to use and learn.</p> </li> <li> <p>Fast to code: With native python to integrate with large python ecosystem.</p> </li> <li> <p>Cross-Platform: The first one python trading API with Linux compatible in Taiwan.</p> </li> </ul>"},{"location":"#installation","title":"Installation","text":""},{"location":"#binaries","title":"Binaries","text":"<p>simple using pip to install <pre><code>pip install shioaji\n</code></pre> update shioaji with </p> <pre><code>pip install -U shioaji\n</code></pre>"},{"location":"#uv","title":"uv","text":"<p>using uv to install <pre><code>uv add shioaji \n</code></pre> install speed version <pre><code>uv add shioaji --extra speed\n</code></pre></p>"},{"location":"#docker-image","title":"Docker Image","text":"<p>simple run with interactive mode in docker  <pre><code>docker run -it sinotrade/shioaji:latest\n</code></pre> run with jupyter lab or notebook  <pre><code>docker run -p 8888:8888 sinotrade/shioaji:jupyter\n</code></pre></p>"},{"location":"env_setup/","title":"Environment Setup","text":"<p>In this section, we will introduce how to setup the python environment with <code>uv</code> for using Shioaji API. <code>uv</code> is the best solution for managing python environment on cross-platform.</p>"},{"location":"env_setup/#system-requirements","title":"System Requirements","text":"<p>Before starting, please ensure your system meets the following requirements:</p> <ul> <li>Operating System: 64-bit version of Windows, MacOS, or Linux</li> <li>Python Version: 3.8 or later</li> <li>User needs to have a Sinopac account and obtain Shioaji API permissions.</li> </ul>"},{"location":"env_setup/#install-python-environment","title":"Install Python Environment","text":"<p>First, you need to install Python on your system. We recommend using <code>uv</code> as the Python environment and project environment management tool. And we will use <code>uv</code> to install Shioaji API in the project.</p> <p>note</p> <p><code>uv</code> is the best solution for managing python environment on cross-platform.</p>"},{"location":"env_setup/#install-uv","title":"Install uv","text":"<p>script</p> Linux and MacOSWindows <pre><code>curl -LsSf https://astral.sh/uv/install.sh | sh\n</code></pre> <pre><code>powershell -c \"irm https://astral.sh/uv/install.ps1 | iex\"\n</code></pre> <p>More information about installation and usage can be found at uv official document</p>"},{"location":"env_setup/#create-project-environment","title":"Create Project Environment","text":"<p>First, create a project named <code>sj-trading</code></p> <pre><code>uv init sj-trading --package --app --vcs git\ncd sj-trading\n</code></pre> <p>The project structure will be like this:</p> <pre><code>sj-trading\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 pyproject.toml\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 sj_trading\n        \u2514\u2500\u2500 __init__.py\n</code></pre> <p>add Shioaji API to the project</p> <pre><code>uv add shioaji\n</code></pre> <p>Open <code>pyproject.toml</code> file and you will see the following content <pre><code>[project]\nname = \"sj-trading\"\nversion = \"0.1.0\"\ndescription = \"Shioaji Trading\"\nreadme = \"README.md\"\nrequires-python = \"&gt;=3.12\"\ndependencies = [\n    \"shioaji&gt;=1.2.5\",\n]\n\n[project.scripts]\nhello = \"sj_trading:hello\"\n\n[build-system]\nrequires = [\"hatchling\"]\nbuild-backend = \"hatchling.build\"\n</code></pre> the <code>hello</code> command is the entry point of the project.</p> <p>execute hello command</p> <pre><code>uv run hello\n</code></pre> <p>output</p> <pre><code>Hello from sj-trading!\n</code></pre> <p>open <code>src/sj_trading/__init__.py</code> file and copy the following content <pre><code>import shioaji as sj\n\ndef hello():\n    get_shioaji_client()\n\n\ndef get_shioaji_client() -&gt; sj.Shioaji:\n    api =  sj.Shioaji()\n    print(\"Shioaji API created\")\n    return api\n</code></pre></p> <p>execute command</p> <pre><code>uv run hello\n</code></pre> <p>output</p> <pre><code>Shioaji API created\n</code></pre> <p>This is the most basic environment setup and you can start using Shioaji API now.</p>"},{"location":"env_setup/#use-jupyter-environment","title":"Use Jupyter Environment","text":"<p>Add ipykernel to the project development dependencies</p> <pre><code>uv add --dev ipykernel\n</code></pre> <p>Add the project environment to the Jupyter kernel</p> <pre><code>uv run ipython kernel install --user --name=sj-trading\n</code></pre> <p>Start Jupyter</p> <pre><code>uv run --with jupyter jupyter lab\n</code></pre> <p>Open <code>dev.ipynb</code> file in Jupyter and select <code>sj-trading</code> kernel to execute the command</p> <p>The <code>hello</code> command we wrote earlier can be executed in this way     </p> <p>If you have already opened an account, you can skip the next chapter and go to Token &amp; Certificate to get the API Key and certificate.</p>"},{"location":"qa/","title":"QA","text":""},{"location":"qa/#_1","title":"\u4e0b\u55ae","text":"<p>\u5982\u4f55\u4e0b\u5e02\u50f9\u55ae(MKT)\u3001\u7bc4\u570d\u5e02\u50f9\u55ae(MKP)</p> <pre><code>order = api.Order(\n    action=sj.constant.Action.Buy,\n    price=0, # MKT, MKP will not use price parameter\n    quantity=1,\n    price_type='MKP', # change to MKT or MKP\n    order_type='IOC', # MKT, MKP only accecpt IOC order\n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\n</code></pre> <p>\u5982\u4f55\u639b\u6f32(\u8dcc)\u505c\u9650\u50f9ROD\u55ae</p> <p>First, we need to know the <code>limit up(limit down)</code> price of the security. Just take  a look at the <code>api.Contracts</code>, you will find the information you want.</p> <p>In</p> <pre><code>api.Contracts.Stocks.TSE['TSE2330']\n</code></pre> <p>Out</p> <pre><code>Stock(\n    exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n    code='2330', \n    symbol='TSE2330', \n    name='\u53f0\u7a4d\u96fb', \n    category='24', \n    unit=1000, \n    limit_up=653.0, \n    limit_down=535.0, \n    reference=594.0, \n    update_date='2021/08/27', \n    margin_trading_balance=6565, \n    short_selling_balance=365, \n    day_trade=&lt;DayTrade.Yes: 'Yes'&gt;\n)\n</code></pre> <p>Example place LMT and ROD order at limit up price.</p> <p>In</p> <pre><code>contract = api.Contracts.Stocks.TSE['TSE2330']\nprice = contract.limit_up\norder = api.Order(\n    action=sj.constant.Action.Buy,\n    price=price,\n    quantity=1,\n    price_type='LMT',\n    order_type='ROD', \n    order_lot=sj.constant.StockOrderLot.Common,\n    account=api.stock_account\n)\n</code></pre>"},{"location":"qa/#_2","title":"\u884c\u60c5","text":"<p>\u70ba\u4ec0\u9ebc\u884c\u60c5\u53ea\u80fd\u6536\u5e7e\u884c\u5c31\u65b7\u6389\u4e86</p> <p>If your code something like this, and possibly run code on cmd/terminal with <code>python stream.py</code>. Then you definitely won't get any additional ticks, since the python program has already terminated.</p> version&gt;=1.0version&lt;1.0 <pre><code>import shioaji as sj\n\napi = sj.Shioaji(simulation=True)\napi.login('YOUR_API_KEY', 'YOUR_SECRET_KEY')\napi.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"], \n    quote_type = sj.constant.QuoteType.Tick\n)\n</code></pre> <pre><code># stream.py\nimport shioaji as sj\n\napi = sj.Shioaji(simulation=True)\napi.login('YOUR_PERSON_ID', '2222')\napi.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"], \n    quote_type = sj.constant.QuoteType.Tick\n)\n</code></pre> <p>If you wish your python program to survive, please modify you python script as below.</p> version&gt;=1.0version&lt;1.0 <pre><code># stream.py\nimport shioaji as sj\nfrom threading import Event\n\napi = sj.Shioaji(simulation=True)\napi.login('YOUR_API_KEY', 'YOUR_SECRET_KEY')\napi.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"], \n    quote_type = sj.constant.QuoteType.Tick\n)\n\nEvent().wait()\n</code></pre> <pre><code># stream.py\nimport shioaji as sj\nfrom threading import Event\n\napi = sj.Shioaji(simulation=True)\napi.login('YOUR_PERSON_ID', '2222')\napi.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"], \n    quote_type = sj.constant.QuoteType.Tick\n)\n\nEvent().wait()\n</code></pre>"},{"location":"qa/#_3","title":"\u5176\u4ed6","text":"<p>\u51fa\u73fe Account not acceptable\uff0c\u53ef\u80fd\u539f\u56e0\u5982\u4e0b</p> <pre><code>- \u672a\u5b8c\u6210[\u7c3d\u7f72](https://sinotrade.github.io/zh_TW/tutor/prepare/terms/#_1)\u53ca[API\u6e2c\u8a66](https://sinotrade.github.io/zh_TW/tutor/prepare/terms/#api)\u3002\n- [`update_status`](../tutor/order/UpdateStatus)\u9810\u8a2d\u67e5\u8a62\u70ba\u540d\u4e0b\u6240\u6709\u5e33\u865f\uff0c\u82e5\u60f3\u4f7f\u7528\u9810\u8a2d\u67e5\u8a62\u65b9\u5f0f\uff0c\u8acb\u78ba\u8a8d\u6240\u6709\u5e33\u865f\u7686\u6709\u5b8c\u6210\u7c3d\u7f72\u53ca\u6e2c\u8a66\u3002\n</code></pre> <p>\u5982\u4f55\u66f4\u6539shioaji.log</p> <p>Please add environment variable before import shioaji. <code>(version &gt;= 0.3.3.dev0)</code></p> <p>linux or Mac OS: <pre><code>export SJ_LOG_PATH=/path/to/shioaji.log\n</code></pre></p> <p>windows: <pre><code>set SJ_LOG_PATH=C:\\path\\to\\shioaji.log\n</code></pre></p> <p>\u5982\u4f55\u66f4\u6539contracts\u4e0b\u8f09\u8def\u5f91</p> <p>Please add environment variable before import shioaji. <code>(version &gt;= 0.3.4.dev2)</code></p> <p>linux or Mac OS: <pre><code>export SJ_CONTRACTS_PATH=MY_PATH\n</code></pre></p> <p>windows: <pre><code>set SJ_CONTRACTS_PATH=MY_PATH\n</code></pre></p> <p>python: <pre><code>os.environ[\"SJ_CONTRACTS_PATH\"]=MY_PATH\n</code></pre></p> <p>\u8f38\u5165\u5bc6\u78bc\u932f\u8aa43\u6b21\u600e\u9ebc\u8fa6</p> <p>\u7dda\u4e0a\u89e3\u9396</p> <p>** Note that you only have 2 chances to unlock your account online in a day. **</p> <p>** We've migrate QA site to Shioaji Forum **</p>"},{"location":"quickstart/","title":"Quick Start","text":"<p>Just import our API library like other popular python library and new the instance to start using our API. Login your account and activate the certification then you can start placing order.</p> <p>Note</p> <p>** Please complete the Prepare before starting, including Open Account, Terms of Service and Token. **</p>"},{"location":"quickstart/#login-and-activate-ca","title":"Login and Activate CA","text":"version&gt;=1.0version&lt;1.0 <pre><code>import shioaji as sj\n\napi = sj.Shioaji()\naccounts =  api.login(\"YOUR_API_KEY\", \"YOUR_SECRET_KEY\")\napi.activate_ca(\n    ca_path=\"/c/your/ca/path/Sinopac.pfx\",\n    ca_passwd=\"YOUR_CA_PASSWORD\",\n    person_id=\"Person of this Ca\",\n)\n</code></pre> <pre><code>import shioaji as sj\n\napi = sj.Shioaji()\naccounts = api.login(\"YOUR_PERSON_ID\", \"YOUR_PASSWORD\")\napi.activate_ca(\n    ca_path=\"/c/your/ca/path/Sinopac.pfx\",\n    ca_passwd=\"YOUR_CA_PASSWORD\",\n    person_id=\"Person of this Ca\",\n)\n</code></pre> <p>The Certification Path</p> <p>In Windows you copy the file path with <code>\\</code> to separate the file, you need to replace it with <code>/</code>.</p>"},{"location":"quickstart/#streaming-market-data","title":"Streaming Market Data","text":"<p>Subscribe the real time market data. Simplely pass contract into quote <code>subscribe</code> function and give the quote type will receive the streaming data.</p> <pre><code>api.quote.subscribe(api.Contracts.Stocks[\"2330\"], quote_type=\"tick\")\napi.quote.subscribe(api.Contracts.Stocks[\"2330\"], quote_type=\"bidask\")\napi.quote.subscribe(api.Contracts.Futures[\"TXFC0\"], quote_type=\"tick\")\n</code></pre> <p>Quote Type</p> <p>Currently we support two quote type you can see in <code>shioaji.constent.QuoteType</code>. The best way to use that is directly pass this enum into <code>subscribe</code> function. </p>"},{"location":"quickstart/#place-order","title":"Place Order","text":"<p>Like the above subscribing market data using the contract, then need to define the order. Pass them into <code>place_order</code> function, then it will return the trade that describe the status of your order.</p> <pre><code>contract = api.Contracts.Stocks[\"2890\"]\norder = api.Order(\n    price=12,\n    quantity=5,\n    action=sj.constant.Action.Buy,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n)\ntrade = api.place_order(contract, order)\n</code></pre>"},{"location":"quickstart/#conclusion","title":"Conclusion","text":"<p>This quickstart demonstrates how easy to use our package for native Python users. Unlike many other trading API is hard for Python developer. We focus on making more pythonic trading API for our users. </p>"},{"location":"release/","title":"Release Note","text":""},{"location":"release/#version-125-2024-10-01","title":"version: 1.2.5 (2024-10-01)","text":"<ul> <li>feat: refactor expire time of CA</li> </ul> <p> commit_id: 6621685a</p> <p> release_at: 2024-10-01 02:25:01.723</p>"},{"location":"release/#version-124-2024-08-28","title":"version: 1.2.4 (2024-08-28)","text":"<ul> <li>feat: support py3.12</li> </ul> <p> commit_id: a287f56c</p> <p> release_at: 2024-08-28 16:00:00.000</p>"},{"location":"release/#version-123-2024-03-06","title":"version: 1.2.3 (2024-03-06)","text":"<ul> <li>feat: change default site to bc</li> <li>feat: pysolace upgrade 0.9.40(solclient 7.28.0.4)</li> <li>feat: support apple silicon chip</li> </ul> <p> commit_id: 8096bbac</p> <p> release_at: 2024-03-06 16:00:00.000</p>"},{"location":"release/#version-122-2024-01-09","title":"version: 1.2.2 (2024-01-09)","text":"<ul> <li>fix: remove column of profitloss in future</li> </ul> <p> commit_id: ca973a81</p> <p> release_at: 2024-01-09 02:27:31.383</p>"},{"location":"release/#version-121-2023-12-22","title":"version: 1.2.1 (2023-12-22)","text":"<ul> <li>fix: windows inject dll issue</li> </ul> <p> commit_id: 2a413848</p> <p> release_at: 2023-12-22 01:19:17.043</p>"},{"location":"release/#version-120-2023-12-20","title":"version: 1.2.0 (2023-12-20)","text":"<ul> <li>feat: vpn </li> <li>feat: rust version ca</li> <li>refactor: test report flow</li> </ul> <p> commit_id: 856f39ea</p> <p> release_at: 2023-12-20 16:00:00.000</p>"},{"location":"release/#version-1113-2023-11-01","title":"version: 1.1.13 (2023-11-01)","text":"<p>feat: impl ca.get_sign on Darwin</p> <p> commit_id: 729f058e</p> <p> release_at: 2023-11-01 05:36:29.553</p>"},{"location":"release/#version-1112-2023-08-22","title":"version: 1.1.12 (2023-08-22)","text":"<ul> <li>feat: usage add limit and available byte info</li> </ul> <p> commit_id: cf5e4628</p> <p> release_at: 2023-08-22 16:00:00.000</p>"},{"location":"release/#version-1111-2023-08-04","title":"version: 1.1.11 (2023-08-04)","text":"<ul> <li>fix: custom_field in validator for only support number and alphabet</li> <li>fix: pydantic v2 trade issue</li> <li>fix: pydantic v2 contracts cache issue</li> </ul> <p> commit_id: cc1da47e</p> <p> release_at: 2023-08-04 08:00:37.000</p>"},{"location":"release/#version-1110-2023-07-23","title":"version: 1.1.10 (2023-07-23)","text":"<ul> <li>feat: profit loss detail support unit</li> </ul> <p> commit_id: a62d1f6a</p> <p> release_at: 2023-07-23 16:00:00.000</p>"},{"location":"release/#version-119-2023-07-20","title":"version: 1.1.9 (2023-07-20)","text":"<p>yanked</p> <p> commit_id: f9f03cff</p> <p> release_at: 2023-07-20 07:43:46.000</p>"},{"location":"release/#version-118-2023-07-18","title":"version: 1.1.8 (2023-07-18)","text":"<ul> <li>feat: query usage</li> <li>feat: profit_loss support unit</li> <li>feat: support pydantic v2</li> </ul> <p> commit_id: 3dc8568e</p> <p> release_at: 2023-07-18 09:08:42.000</p>"},{"location":"release/#version-117-2023-07-18","title":"version: 1.1.7 (2023-07-18)","text":"<p>yanked</p> <p> commit_id: fb490a9a</p> <p> release_at: 2023-07-18 07:02:20.000</p>"},{"location":"release/#version-116-2023-06-19","title":"version: 1.1.6 (2023-06-19)","text":"<ul> <li>feat: solace reconnect with sub 2500 user</li> </ul> <p> commit_id: eeaeeb5f</p> <p> release_at: 2023-06-19 16:00:00.000</p>"},{"location":"release/#version-115-2023-06-07","title":"version: 1.1.5 (2023-06-07)","text":"<ul> <li>fix: simulation sign check</li> <li>fix: handle pickle load error</li> </ul> <p> commit_id: 1def691c</p> <p> release_at: 2023-06-07 16:00:00.000</p>"},{"location":"upgrade/","title":"Upgrading to 1.0","text":"<p>Version 1.0 is a major release. This document assist users migrating to version 1.0.</p>"},{"location":"upgrade/#shioaji","title":"Shioaji","text":"<p>Remove argument <code>backend</code></p> <p>In</p> <pre><code>import shioaji as sj\nsj.Shioaji?\n</code></pre> <p>Out</p> version&gt;=1.0version&lt;1.0 <pre><code>Init signature:\nsj.Shioaji(\n    simulation: bool = False,\n    proxies: Dict[str, str] = {},\n    currency: str = 'NTD',\n)\nDocstring:     \nshioaji api\n\nFunctions:\n    login\n    logout\n    activate_ca\n    list_accounts\n    set_default_account\n    get_account_margin\n    get_account_openposition\n    get_account_settle_profitloss\n    get_stock_account_funds\n    get_stock_account_unreal_profitloss\n    get_stock_account_real_profitloss\n    place_order\n    update_order\n    update_status\n    list_trades\n\nObjects:\n    Quote\n    Contracts\n    Order\nInit docstring:\ninitialize Shioaji to start trading\n\nArgs:\n    simulation (bool):\n        - False: to trading on real market (just use your Sinopac account to start trading)\n        - True: become simulation account(need to contract as to open simulation account)\n    proxies (dict): specific the proxies of your https\n        ex: {'https': 'your-proxy-url'}\n    currency (str): {NTX, USX, NTD, USD, HKD, EUR, JPY, GBP}\n        set the default currency for display\n</code></pre> <pre><code>Init signature:\nsj.Shioaji(\n    backend: str = 'http',\n    simulation: bool = False,\n    proxies: Dict[str, str] = {},\n    currency: str = 'NTD',\n)\nDocstring:\nshioaji api\n\nFunctions:\n    login\n    activate_ca\n    list_accounts\n    set_default_account\n    get_account_margin\n    get_account_openposition\n    get_account_settle_profitloss\n    get_stock_account_funds\n    get_stock_account_unreal_profitloss\n    get_stock_account_real_profitloss\n    place_order\n    update_order\n    update_status\n    list_trades\n\nObjects:\n    Quote\n    Contracts\n    Order\nInit docstring:\ninitialize Shioaji to start trading\n\nArgs:\n    backend (str): {http, socket}\n        use http or socket as backend currently only support http, async socket backend coming soon.\n    simulation (bool):\n        - False: to trading on real market (just use your Sinopac account to start trading)\n        - True: become simulation account(need to contract as to open simulation account)\n    proxies (dict): specific the proxies of your https\n        ex: {'https': 'your-proxy-url'}\n    currency (str): {NTX, USX, NTD, USD, HKD, EUR, JPY, GBP}\n        set the default currency for display\n</code></pre>"},{"location":"upgrade/#login","title":"Login","text":"<p>Please update your login parameters from <code>person_id</code> and <code>passwd</code> to <code>api_key</code> and <code>secret_key</code> in order to use version 1.0. You can apply for an api_key on the Token page.</p> <p>In</p> version&gt;=1.0version&lt;1.0 <pre><code>import shioaji as sj\napi = sj.Shioaji()\napi.login(\n    api_key=\"YOUR_API_KEY\", \n    secret_key=\"YOUR_SECRET_KEY\"\n)\n</code></pre> <pre><code>import shioaji as sj\napi = sj.Shioaji()\napi.login(\n    person_id=\"YOUR_PERSON_ID\", \n    passwd=\"YOUR_PASSWORD\",\n)\n</code></pre> <p>Out</p> <pre><code>[\n    FutureAccount(person_id='', broker_id='', account_id='', signed=True, username=''),\n    StockAccount(person_id='', broker_id='', account_id='', signed=True, username='')\n]\n</code></pre>"},{"location":"upgrade/#stock-order","title":"Stock Order","text":"<p>Rename <code>TFTStockOrder</code> to <code>StockOrder</code></p> <p>StockOrder</p> verion&gt;=1.0verion&lt;1.0 <pre><code>&gt;&gt; sj.order.StockOrder?\n\nInit signature:\nsj.order.StockOrder(\n    *,\n    action: shioaji.constant.Action,\n    price: Union[pydantic.types.StrictInt, float],\n    quantity: shioaji.order.ConstrainedIntValue,\n    id: str = '',\n    seqno: str = '',\n    ordno: str = '',\n    account: shioaji.account.Account = None,\n    custom_field: shioaji.order.ConstrainedStrValue = '',\n    ca: str = '',\n    price_type: shioaji.constant.StockPriceType,\n    order_type: shioaji.constant.OrderType,\n    order_lot: shioaji.constant.StockOrderLot = &lt;StockOrderLot.Common: 'Common'&gt;,\n    order_cond: shioaji.constant.StockOrderCond = &lt;StockOrderCond.Cash: 'Cash'&gt;,\n    daytrade_short: bool = False,\n) -&gt; None\n</code></pre> <pre><code>&gt;&gt; sj.order.TFTStockOrder?\n\nInit signature:\nsj.order.TFTStockOrder(\n    *,\n    action: shioaji.constant.Action,\n    price: Union[pydantic.types.StrictInt, float],\n    quantity: shioaji.order.ConstrainedIntValue,\n    id: str = '',\n    seqno: str = '',\n    ordno: str = '',\n    account: shioaji.account.Account = None,\n    custom_field: shioaji.order.ConstrainedStrValue = '',\n    ca: str = '',\n    price_type: shioaji.constant.TFTStockPriceType,\n    order_type: shioaji.constant.TFTOrderType,\n    order_lot: shioaji.constant.TFTStockOrderLot = &lt;TFTStockOrderLot.Common: 'Common'&gt;,\n    order_cond: shioaji.constant.StockOrderCond = &lt;StockOrderCond.Cash: 'Cash'&gt;,\n    first_sell: shioaji.constant.StockFirstSell = &lt;StockFirstSell.No: 'false'&gt;,\n) -&gt; None\n</code></pre>"},{"location":"upgrade/#order","title":"Order","text":"<p>Rename  </p> <ul> <li><code>TFTStockPriceType</code> to <code>StockPriceType</code> </li> <li><code>TFTOrderType</code> to <code>OrderType</code> </li> <li><code>TFTStockOrderLot</code> to <code>StockOrderLot</code> </li> <li><code>first_sell</code> to <code>daytrade_short</code>, and type changed to <code>Bool</code>.</li> </ul> <p>Order</p> version&gt;=1.0version&lt;1.0 <pre><code>order = api.Order(\n    price=12, \n    quantity=1, \n    action=sj.constant.Action.Sell, \n    price_type=sj.constant.StockPriceType.LMT, \n    order_type=sj.constant.OrderType.ROD, \n    order_lot=sj.constant.StockOrderLot.Common, \n    daytrade_short=True,\n    custom_field=\"test\",\n    account=api.stock_account\n)\n</code></pre> <pre><code>order = api.Order(\n    price=12, \n    quantity=1, \n    action=sj.constant.Action.Sell, \n    price_type=sj.constant.TFTStockPriceType.LMT, \n    order_type=sj.constant.TFTOrderType.ROD, \n    order_lot=sj.constant.TFTStockOrderLot.Common, \n    first_sell=sj.constant.StockFirstSell.Yes,\n    custom_field=\"test\",\n    account=api.stock_account\n)\n</code></pre>"},{"location":"upgrade/#order-callback","title":"Order Callback","text":"<p>Rename <code>TFTOrder</code> to <code>StockOrder</code></p> <p>Order Callback</p> version&gt;=1.0version&lt;1.0 <pre><code>OrderState.StockOrder {\n    'operation': {\n        'op_type': 'New',\n        'op_code': '00',\n        'op_msg': ''\n    },\n    'order': {\n        'id': 'c21b876d',\n        'seqno': '429832',\n        'ordno': 'W2892',\n        'action': 'Buy',\n        'price': 12.0,\n        'quantity': 10,\n        'order_cond': 'Cash',\n        'order_lot': 'Common',\n        'custom_field': 'test',\n        'order_type': 'ROD',\n        'price_type': 'LMT'\n    },\n    'status': {\n        'id': 'c21b876d',\n        'exchange_ts': 1583828972,\n        'modified_price': 0,\n        'cancel_quantity': 0,\n        'web_id': '137'\n    },\n    'contract': {\n        'security_type': 'STK',\n        'exchange': 'TSE',\n        'code': '2890',\n        'symbol': '',\n        'name': '',\n        'currency': 'TWD'\n    }\n}\n</code></pre> <pre><code>OrderState.TFTOrder {\n    'operation': {\n        'op_type': 'New',\n        'op_code': '00',\n        'op_msg': ''\n    },\n    'order': {\n        'id': 'c21b876d',\n        'seqno': '429832',\n        'ordno': 'W2892',\n        'action': 'Buy',\n        'price': 12.0,\n        'quantity': 10,\n        'order_cond': 'Cash',\n        'order_lot': 'Common',\n        'custom_field': 'test',\n        'order_type': 'ROD',\n        'price_type': 'LMT'\n    },\n    'status': {\n        'id': 'c21b876d',\n        'exchange_ts': 1583828972,\n        'modified_price': 0,\n        'cancel_quantity': 0,\n        'web_id': '137'\n    },\n    'contract': {\n        'security_type': 'STK',\n        'exchange': 'TSE',\n        'code': '2890',\n        'symbol': '',\n        'name': '',\n        'currency': 'TWD'\n    }\n}\n</code></pre>"},{"location":"upgrade/#deal-callback","title":"Deal Callback","text":"<p>Rename <code>TFTDeal</code> to <code>StockDeal</code></p> <p>Deal Callback</p> version&gt;=1.0version&lt;1.0 <pre><code>OrderState.StockDeal {\n    'trade_id': '12ab3456', \n    'exchange_seq': '123456', \n    'broker_id': 'your_broker_id', \n    'account_id': 'your_account_id', \n    'action': &lt;Action.Buy: 'Buy'&gt;, \n    'code': '2890', \n    'order_cond': &lt;StockOrderCond.Cash: 'Cash'&gt;, \n    'order_lot': &lt;TFTStockOrderLot.Common: 'Common'&gt;,\n    'price': 12, \n    'quantity': 10,\n    'web_id': '137',\n    'custom_field': 'test',\n    'ts': 1583828972\n}\n</code></pre> <pre><code>OrderState.TFTDeal {\n    'trade_id': '12ab3456', \n    'exchange_seq': '123456', \n    'broker_id': 'your_broker_id', \n    'account_id': 'your_account_id', \n    'action': &lt;Action.Buy: 'Buy'&gt;, \n    'code': '2890', \n    'order_cond': &lt;StockOrderCond.Cash: 'Cash'&gt;, \n    'order_lot': &lt;TFTStockOrderLot.Common: 'Common'&gt;,\n    'price': 12, \n    'quantity': 10,\n    'web_id': '137',\n    'custom_field': 'test',\n    'ts': 1583828972\n}\n</code></pre>"},{"location":"upgrade/#futures-order","title":"Futures Order","text":"<p>FuturesOrder</p> verion&gt;=1.0verion&lt;1.0 <pre><code>&gt;&gt; sj.order.FuturesOrder?\n\nInit signature:\nsj.order.FuturesOrder(\n    *,\n    action: shioaji.constant.Action,\n    price: Union[pydantic.types.StrictInt, float],\n    quantity: shioaji.order.ConstrainedIntValue,\n    id: str = '',\n    seqno: str = '',\n    ordno: str = '',\n    account: shioaji.account.Account = None,\n    custom_field: shioaji.order.ConstrainedStrValue = '',\n    ca: str = '',\n    price_type: shioaji.constant.FuturesPriceType,\n    order_type: shioaji.constant.OrderType,\n    octype: shioaji.constant.FuturesOCType = &lt;FuturesOCType.Auto: 'Auto'&gt;,\n) -&gt; None\n</code></pre> <pre><code>&gt;&gt; sj.order.FuturesOrder?\n\nInit signature:\nsj.order.FuturesOrder(\n    *,\n    action: shioaji.constant.Action,\n    price: Union[pydantic.types.StrictInt, float],\n    quantity: shioaji.order.ConstrainedIntValue,\n    id: str = '',\n    seqno: str = '',\n    ordno: str = '',\n    account: shioaji.account.Account = None,\n    custom_field: shioaji.order.ConstrainedStrValue = '',\n    ca: str = '',\n    price_type: shioaji.constant.FuturesPriceType,\n    order_type: shioaji.constant.FuturesOrderType,\n    octype: shioaji.constant.FuturesOCType = &lt;FuturesOCType.Auto: 'Auto'&gt;,\n) -&gt; None\n</code></pre>"},{"location":"upgrade/#order_1","title":"Order","text":"<p>Rename <code>FuturesOrderType</code> to <code>OrderType</code></p> <p>Order</p> verion&gt;=1.0verion&lt;1.0 <pre><code>order = api.Order(\n    action=sj.constant.Action.Buy,\n    price=100,\n    quantity=1,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD, \n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\n</code></pre> <pre><code>order = api.Order(\n    action=sj.constant.Action.Buy,\n    price=100,\n    quantity=1,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.FuturesOrderType.ROD, \n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\n</code></pre>"},{"location":"upgrade/#order-callback_1","title":"Order Callback","text":"<p>Rename <code>FOrder</code> to <code>FuturesOrder</code></p> <p>Order Event</p> version&gt;=1.0version&lt;1.0 <pre><code>OrderState.FuturesOrder {\n    'operation': {\n        'op_type': 'New', \n        'op_code': '00', \n        'op_msg': ''\n    }, \n    'order': {\n        'id': '02c347f7', \n        'seqno': '956201', \n        'ordno': 'kY00H', \n        'action': 'Sell', \n        'price': 17760.0, \n        'quantity': 1, \n        'order_cond': None, \n        'order_type': 'ROD', \n        'price_type': 'LMT', \n        'market_type': 'Night', \n        'oc_type': 'New', \n        'subaccount': ''\n    }, \n    'status': {\n        'id': '02c347f7', \n        'exchange_ts': 1625729890, \n        'modified_price': 0.0, \n        'cancel_quantity': 0,\n        \"web_id\": \"P\"\n    }, \n    'contract': {\n        'security_type': 'FUT', \n        'code': 'TXF', \n        'exchange': 'TIM', \n        'delivery_month': '202107', \n        'strike_price': 0.0, \n        'option_right': 'Future'\n    }\n}\n</code></pre> <pre><code>OrderState.FOrder {\n    'operation': {\n        'op_type': 'New', \n        'op_code': '00', \n        'op_msg': ''\n    }, \n    'order': {\n        'id': '02c347f7', \n        'seqno': '956201', \n        'ordno': 'kY00H', \n        'action': 'Sell', \n        'price': 17760.0, \n        'quantity': 1, \n        'order_cond': None, \n        'order_type': 'ROD', \n        'price_type': 'LMT', \n        'market_type': 'Night', \n        'oc_type': 'New', \n        'subaccount': ''\n    }, \n    'status': {\n        'id': '02c347f7', \n        'exchange_ts': 1625729890, \n        'modified_price': 0.0, \n        'cancel_quantity': 0,\n        \"web_id\": \"P\"\n    }, \n    'contract': {\n        'security_type': 'FUT', \n        'code': 'TXF', \n        'exchange': 'TIM', \n        'delivery_month': '202107', \n        'strike_price': 0.0, \n        'option_right': 'Future'\n    }\n}\n</code></pre>"},{"location":"upgrade/#deal-callback_1","title":"Deal Callback","text":"<p>Rename <code>FDeal</code> to <code>FuturesDeal</code></p> <p>Deal Event</p> version&gt;=1.0version&lt;1.0 <pre><code>OrderState.FuturesDeal {\n    \"trade_id\":\"02c347f7\",\n    \"seqno\":\"956344\",\n    \"ordno\":\"ky00N11O\",\n    \"exchange_seq\":\"a0000060\",\n    \"broker_id\":\"F002000\",\n    \"account_id\":\"9104000\",\n    \"action\":\"Sell\",\n    \"code\":\"TXF\",\n    \"price\":17650.0,\n    \"quantity\":4,\n    \"subaccount\":\"\",\n    \"security_type\":\"FUT\",\n    \"delivery_month\":\"202107\",\n    \"strike_price\":0.0,\n    \"option_right\":\"Future\",\n    \"market_type\":\"Day\",\n    \"ts\":1625800369\n}\n</code></pre> <pre><code>OrderState.FDeal {\n    \"trade_id\":\"02c347f7\",\n    \"seqno\":\"956344\",\n    \"ordno\":\"ky00N11O\",\n    \"exchange_seq\":\"a0000060\",\n    \"broker_id\":\"F002000\",\n    \"account_id\":\"9104000\",\n    \"action\":\"Sell\",\n    \"code\":\"TXF\",\n    \"price\":17650.0,\n    \"quantity\":4,\n    \"subaccount\":\"\",\n    \"security_type\":\"FUT\",\n    \"delivery_month\":\"202107\",\n    \"strike_price\":0.0,\n    \"option_right\":\"Future\",\n    \"market_type\":\"Day\",\n    \"ts\":1625800369\n}\n</code></pre>"},{"location":"upgrade/#market-data","title":"Market Data","text":"<p>Warn</p> <p>version &gt;= 1.1 will no longer provide QuoteVersion.v0, please change to QuoteVersion.v1.</p>"},{"location":"upgrade/#callback","title":"Callback","text":""},{"location":"upgrade/#tick","title":"Tick","text":"<p>In: pythonic way by using decorator</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>from shioaji import TickSTKv1, Exchange\n\n@api.on_tick_stk_v1()\ndef quote_callback(exchange: Exchange, tick:TickSTKv1):\n    print(f\"Exchange: {exchange}, Tick: {tick}\")\n</code></pre> <pre><code>@api.quote.on_quote\ndef quote_callback(topic: str, quote: dict):\n    print(f\"Topic: {topic}, Quote: {quote}\")\n</code></pre> <p>In: traditional way</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>from shioaji import TickSTKv1, Exchange\n\ndef quote_callback(exchange: Exchange, tick:TickSTKv1):\n    print(f\"Exchange: {exchange}, Tick: {tick}\")\n\napi.quote.set_on_tick_stk_v1_callback(quote_callback)\n</code></pre> <pre><code>def quote_callback(topic: str, quote: dict):\n    print(f\"Topic: {topic}, Quote: {quote}\")\n\napi.quote.set_quote_callback(quote_callback)\n</code></pre> <p>Out</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>Exchange: Exchange.TSE, Tick: Tick(code='2330', datetime=datetime.datetime(2021, 7, 2, 13, 16, 35, 92970), open=Decimal('590'), avg_price=Decimal('589.05'), close=Decimal('590'), high=Decimal('593'), low=Decimal('587'), amount=Decimal('590000'), total_amount=Decimal('8540101000'), volume=1, total_volume=14498, tick_type=1, chg_type=4, price_chg=Decimal('-3'), pct_chg=Decimal('-0.505902'), trade_bid_volume=6638, ask_side_total_vol=7860, bid_side_total_cnt=2694, ask_side_total_cnt=2705, closing_oddlot_shares=0, fixed_trade_vol=0, suspend=0, simtrade=0, intraday_odd=0)\n</code></pre> <pre><code>Topic: MKT/*/TSE/2330, Quote: {'AmountSum': [4739351000.0], 'Close': [596.0], 'Date': '2021/03/30', 'TickType': [2], 'Time': '10:01:33.349431', 'VolSum': [7932], 'Volume': [1]}\n</code></pre>"},{"location":"upgrade/#bidask","title":"BidAsk","text":"<p>In: pythonic way by using decorator</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>from shioaji import BidAskSTKv1, Exchange\n\n@api.on_bidask_stk_v1()\ndef quote_callback(exchange: Exchange, bidask:BidAskSTKv1):\n    print(f\"Exchange: {exchange}, BidAsk: {bidask}\")\n</code></pre> <pre><code>@api.quote.on_quote\ndef quote_callback(topic: str, quote: dict):\n    print(f\"Topic: {topic}, Quote: {quote}\")\n</code></pre> <p>In: traditional way</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>from shioaji import BidAskSTKv1, Exchange\n\ndef quote_callback(exchange: Exchange, bidask:BidAskSTKv1):\n    print(f\"Exchange: {exchange}, BidAsk: {bidask}\")\n\napi.quote.set_on_bidask_stk_v1_callback(quote_callback)\n</code></pre> <pre><code>def quote_callback(topic: str, quote: dict):\n    print(f\"Topic: {topic}, Quote: {quote}\")\n\napi.quote.set_quote_callback(quote_callback)\n</code></pre> <p>Out</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>Exchange: Exchange.TSE, BidAsk: BidAsk(code='2330', datetime=datetime.datetime(2021, 7, 2, 13, 17, 29, 726428), bid_price=[Decimal('589'), Decimal('588'), Decimal('587'), Decimal('586'), Decimal('585')], bid_volume=[223, 761, 1003, 809, 1274], diff_bid_vol=[0, 0, 0, 0, 0], ask_price=[Decimal('590'), Decimal('591'), Decimal('592'), Decimal('593'), Decimal('594')], ask_volume=[304, 232, 183, 242, 131], diff_ask_vol=[1, 0, 0, 0, 0], suspend=0, simtrade=0, intraday_odd=0)\n</code></pre> <pre><code>Topic: QUT/idcdmzpcr01/TSE/2330, Quote: {'AskPrice': [590.0, 591.0, 592.0, 593.0, 594.0], 'AskVolume': [303, 232, 183, 242, 131], 'BidPrice': [589.0, 588.0, 587.0, 586.0, 585.0], 'BidVolume': [224, 762, 1003, 809, 1274], 'Date': '2021/07/02', 'Time': '13:17:26.391840'}\n</code></pre>"},{"location":"upgrade/#future-account-info","title":"Future Account Info.","text":"<p>Remove functions</p> <pre><code>1. get_account_margin\n2. get_account_openposition\n3. get_account_settle_profitloss\n</code></pre> <p>Instead, you should use  </p> <pre><code>1. margin\n2. list_positions( api.futopt_account )\n3. list_profit_loss( api.futopt_account )\n4. list_profit_loss_detail( api.futopt_account )\n5. list_profit_loss_summary( api.futopt_account )\n</code></pre> <p>For more information, please refer to Account Data section.</p> <p>Finally, give us support and encouragement on GITHUB </p>"},{"location":"tutor/contract/","title":"Contract","text":"<p>Contract object will be used by a lot of place like place order, subscribe quote, etc.</p>"},{"location":"tutor/contract/#get-contracts","title":"Get Contracts","text":"<p>The following provides two methods to get contracts:</p> <ul> <li>method 1:   After Login success we will start to fetch all kind of contract but fetching will not block other action. So how to know the fetch action is done ? We have status of contracts download that you can use <code>Contracts.status</code>. If you set contracts_timeout inside <code>login</code> set to 10000, it will block the fetch and wait 10 second until the contract is back.</li> </ul> <p>In</p> version&gt;=1.0version&lt;1.0 <pre><code>import shioaji as sj\napi = sj.Shioaji()\napi.login(\n    api_key=\"YOUR_API_KEY\", \n    secret_key=\"YOUR_SECRET_KEY\",\n    contracts_timeout=10000,\n)\n</code></pre> <pre><code>import shioaji as sj\napi = sj.Shioaji()\napi.login(\n    person_id=\"YOUR_PERSON_ID\", \n    passwd=\"YOUR_PASSWORD\",\n    contracts_timeout=10000,\n)\n</code></pre> <ul> <li>method 2:   If <code>fetch_contract</code> inside <code>login</code> is set to False, it will not download contract. You can use <code>fetch_contracts</code> to download.</li> </ul> <p>In</p> version&gt;=1.0version&lt;1.0 <pre><code>import shioaji as sj\napi = sj.Shioaji()\napi.login(\n    api_key=\"YOUR_API_KEY\", \n    secret_key=\"YOUR_SECRET_KEY\",\n    fetch_contract=False,\n)\napi.fetch_contracts(contract_download=True)\n</code></pre> <pre><code>import shioaji as sj\napi = sj.Shioaji()\napi.login(\n    person_id=\"YOUR_PERSON_ID\", \n    passwd=\"YOUR_PASSWORD\",\n    fetch_contract=False,\n)\napi.fetch_contracts(contract_download=True)\n</code></pre>"},{"location":"tutor/contract/#contracts-information","title":"Contracts Information","text":"<p>The contracts we currently offer include: stocks, futures, options and indices. The products we provide can get more detailed information through the following ways.</p> <p>In</p> <pre><code>api.Contracts\n</code></pre> <p>Out</p> <pre><code>Contracts(Indexs=(OTC, TSE), Stocks=(OES, OTC, TSE), Futures=(BRF, CAF, CBF, CCF, CDF, CEF, CFF, CGF, CHF, CJF, CK1, CKF, CLF, CM1, CMF, CNF, CQF, CRF, CSF, CU1, CUF, CWF, CXF, CYF, CZ1, CZF, DCF, DD1, DDF, DEF, DFF, DGF, DHF, DIF, DJF, DKF, DLF, DNF, DOF, DPF, DQF, DSF, DUF, DVF, DWF, DXF, DYF, DZF, EEF, EGF, EHF, EMF, EPF, ERF, EXF, EY1, EYF, FEF, FFF, FGF, FKF, FQF, FRF, FTF, FVF, FWF, FXF, FYF, FZF, G2F, GAF, GCF, GDF, GHF, GIF, GJF, GLF, GMF, GNF, GOF, GRF, GTF, GUF, GWF, GXF, GZF, HAF, HBF, HCF, HHF, HIF, HLF, HOF, HS1, HSF, HY1, HYF, IA1, IAF, IHF, IIF, IJF, IMF, IOF, IPF, IQF, IRF, ITF, IXF, IYF, IZF, JBF, JFF, JNF, JPF, JSF, JWF, JZF, KAF, KB1, KBF, KCF, KDF, KFF, KGF, KIF, KKF, KLF, KOF, KPF, KSF, KWF, LBF, LCF, LE1, LEF, LIF, LMF, LOF, LQF, LRF, LTF, LUF, LVF, LWF, LXF, LYF, MAF, MBF, MCF, MJF, MKF, MPF, MQF, MVF, MX1, MXF, MYF, NAF, NBF, NCF, NDF, NEF, NGF, NHF, NIF, NJF, NLF, NMF, NNF, NOF, NQF, NSF, NUF, NVF, NWF, NXF, NYF, NZF, OAF, OBF, OCF, ODF, OEF, OGF, OHF, OJF, OKF, OLF, OMF, OOF, OPF, OQF, ORF, OS1, OSF, OTF, OUF, OVF, OWF, OXF, OYF, OZF, PAF, PBF, PCF, PDF, PEF, PFF, PGF, PHF, PIF, PJF, PKF, PLF, PMF, PNF, POF, PPF, PQF, RHF, RTF, SPF, T5F, TGF, TJF, TXF, UDF, UNF, XAF, XBF, XEF, XIF, XJF), Options=(CAO, CBO, CCO, CDO, CEO, CFO, CGO, CHO, CJO, CKO, CLO, CMO, CNO, CQO, CRO, CSO, CXO, CZO, DCO, DEO, DFO, DGO, DHO, DJO, DKO, DLO, DNO, DOO, DPO, DQO, DSO, DUO, DVO, DWO, DXO, GIO, GXO, HCO, IJO, LOO, NYA, NYO, NZO, OAO, OBO, OCO, OJO, OKO, OOO, OZO, RHO, RTO, TEO, TFO, TGO, TX1, TXO))\n</code></pre>"},{"location":"tutor/contract/#stock","title":"Stock","text":"<p>In</p> <pre><code>api.Contracts.Stocks[\"2890\"]\n# or api.Contracts.Stocks.TSE.TSE2890\n</code></pre> <p>Out</p> <pre><code>Stock(\n    exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n    code='2890', \n    symbol='TSE2890', \n    name='\u6c38\u8c50\u91d1', \n    category='17', \n    unit=1000, \n    limit_up=19.1, \n    limit_down=15.7, \n    reference=17.4, \n    update_date='2023/01/17', \n    day_trade=&lt;DayTrade.Yes: 'Yes'&gt;\n)\n</code></pre> <p>Stock</p> <pre><code>exchange (Exchange): Attributes of industry\n    {OES, OTC, TSE ...etc}\ncode (str): Id\nsymbol (str): Symbol\nname (str): Name\ncategory (str): Category\nunit (int): Unit\nlimit_up (float): Limit up\nlimit_down (float): Limit down\nreference (float): Reference price\nupdate_date (str): Update date\nmargin_trading_balance (int): Margin trading balance\nshort_selling_balance (int): Short selling balance\nday_trade (DayTrade): Day trade\n    {Yes, No, OnlyBuy}\n</code></pre> <p>Out</p> <pre><code>Stock(\n    exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n    code='2890', \n    symbol='TSE2890', \n    name='\u6c38\u8c50\u91d1', \n    category='17', \n    unit=1000, \n    limit_up=19.1, \n    limit_down=15.7, \n    reference=17.4, \n    update_date='2023/01/17', \n    day_trade=&lt;DayTrade.Yes: 'Yes'&gt;\n)\n</code></pre>"},{"location":"tutor/contract/#futures","title":"Futures","text":"<p>In</p> <pre><code>api.Contracts.Futures[\"TXFA3\"]\n# or api.Contracts.Futures.TXF.TXF202301\n</code></pre> <p>Out</p> <pre><code>Future(\n    code='TXFA3', \n    symbol='TXF202301', \n    name='\u81fa\u80a1\u671f\u8ca801', \n    category='TXF', \n    delivery_month='202301', \n    delivery_date='2023/01/30', \n    underlying_kind='I', \n    unit=1, \n    limit_up=16417.0, \n    limit_down=13433.0, \n    reference=14925.0, \n    update_date='2023/01/18'\n)\n</code></pre> <p>Future</p> <pre><code>code (str): Id\nsymbol (str): Symbol\nname (str): Name\ncategory (str): Category\ndelivery_month (str): Delivery Month\ndelivery_date (str): Delivery Date\nunderlying_kind (str): Underlying Kind\nunit (int): Unit\nlimit_up (float): Limit up\nlimit_down (float): Limit down\nreference (float): Reference price\nupdate_date (str): Update date\n</code></pre>"},{"location":"tutor/contract/#options","title":"Options","text":"<p>In</p> <pre><code>api.Contracts.Options[\"TXO18000R3\"]\n# or api.Contracts.Options.TXO.TXO20230618000P\n</code></pre> <p>Out</p> <pre><code>Option(\n    code='TXO18000R3', \n    symbol='TXO20230618000P', \n    name='\u81fa\u6307\u9078\u64c7\u6b0a06\u6708 18000P', \n    category='TXO', \n    delivery_month='202306', \n    delivery_date='2023/06/21', \n    strike_price=18000, \n    option_right=&lt;OptionRight.Put: 'P'&gt;, \n    underlying_kind='I', \n    unit=1, \n    limit_up=4720.0, \n    limit_down=1740.0, \n    reference=3230.0, \n    update_date='2023/01/18'\n)\n</code></pre> <p>Option</p> <pre><code>code (str): Id\nsymbol (str): Symbol\nname (str): Name\ncategory (str): Category\ndelivery_month (str): Delivery Month\ndelivery_date (str): Delivery Date\nstrike_price (int or float): Strike Price\noption_right (OptionRight): Option Right\nunderlying_kind (str): Underlying Kind\nunit (int): Unit\nlimit_up (float): Limit up\nlimit_down (float): Limit down\nreference (float): Reference price\nupdate_date (str): Update date\n</code></pre>"},{"location":"tutor/contract/#index","title":"Index","text":"<p>The <code>Indexs</code> object shows all supported index contracts, among other categories. Index contracts do not support place_order, but allow subscribing to market quotes. This will be discussed in the next topic.</p> <p>In</p> <pre><code>api.Contracts.Indexs.TSE\n</code></pre> <p>Out</p> <pre><code>TSE(TSE001, TSE015, TSE016, TSE017, TSE018, TSE019, TSE020, TSE022, TSE023, TSE024, TSE025, TSE026, TSE028, TSE029, TSE030, TSE031, TSE032, TSE033, TSE035, TSE036, TSE037, TSE038, TSE039, TSE040, TSE041, TSE042, TSE043, TSE004, TSE005)\n</code></pre> <p>In</p> <pre><code>api.Contracts.Indexs.TSE[\"001\"]\n# or api.Contracts.Indexs.TSE.TSE001\n</code></pre> <p>Out</p> <pre><code>Index(\n    exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n    code='001', \n    symbol='TSE001', \n    name='\u52a0\u6b0a\u6307\u6578'\n)\n</code></pre> <p>Index</p> <pre><code>exchange (Exchange): exchange\n    {OES, OTC, TSE ...etc}\ncode (str): Code\nsymbol (str): Symbol\nname (str): Name\n</code></pre>"},{"location":"tutor/limit/","title":"Use Restrictions","text":"<p>In order to avoid affecting other users' connections, please follow the following usage rules. </p> <p>Traffic</p> <ul> <li> <p>Stock :</p> Trading volume by API in the past 30 days Daily Traffic Limit 0 500MB 1 - 1E 2GB &gt;   1E 10GB </li> <li> <p>Future :</p> Trading volume by API in the past 30 days Daily Traffic Limit 0 500MB 1 - TXF 1000 contracts / MXF 4000 contracts 2GB &gt;   TXF 1000 contracts / MXF 4000 contracts 10GB </li> </ul> <p>Traffic query</p> <pre><code>api.usage()\n</code></pre> <p>Out</p> <pre><code>UsageStatus(connections=1, bytes=41343260, limit_bytes=2147483648, remaining_bytes=2106140388)\n</code></pre> <pre><code>connection: connection count.\nbytes: traffic.\nlimit_bytes: limit bytes of daily.\nremaining_bytes: remaining bytes of daily.\n</code></pre> <p>Counts</p> <ul> <li> <p>Data : </p> <p><code>credit_enquire</code>, <code>short_stock_sources</code>, <code>snapshots</code>, <code>ticks</code>, <code>kbars</code></p> <ul> <li>The total amount of inquiries above is limited to 50 times within 5 seconds.</li> <li>During trading hours, it is prohibited to query <code>ticks</code> more than 10 times.</li> <li>During trading hours, it is prohibited to query <code>kbars</code> more than 270 times.</li> </ul> </li> <li> <p>Portfolio :</p> <p><code>list_profit_loss_detail</code>,<code>account_balance</code>, <code>list_settlements</code>, <code>list_profit_loss</code>, <code>list_positions</code>, <code>margin</code></p> <p>The total amount of inquiries above is limited to 25 times within 5 seconds.</p> </li> <li> <p>Order :</p> <p><code>place_order</code>, <code>update_status</code>, <code>update_qty</code>, <code>update_price</code>, <code>cancel_order</code></p> <p>The total amount of inquiries above is limited to 250 times within 10 seconds.</p> </li> <li> <p>Subscribe : </p> <p>Number of <code>api.subscribe()</code> is 200.</p> </li> <li> <p>Connect : </p> <p>The same SinoPac Securities <code>person_id</code> can only use up to 5 connections.</p> <p>note. <code>api.login()</code>create a connection.</p> </li> <li> <p>Login : </p> <p>Up to 1000 times per day.</p> </li> </ul> <p>Warn</p> <ul> <li>If the traffic exceeds the limit, query requests for market data such as ticks, snapshots, and kbars will return empty values, while other functionalities remain unaffected.</li> <li>If the usage exceeds the limit, the service will be suspended for one minute.</li> <li>If the limit is exceeded multiple times in a row on the same day, the company will suspend the right to use the IP and ID.</li> <li>If the ID is suspended, please contact Shioaji management staff</li> </ul>"},{"location":"tutor/login/","title":"Login","text":"<p>Login must have a SinoPac Securities account. If you do not have a SinoPac Securities account yet. See the document for details.</p>"},{"location":"tutor/login/#login","title":"Login","text":"<p>Token login</p> <p>After version 1.0, we are using token as our <code>login</code> method. You can be found in Token. Before version 1.0, using person id and password.</p> <p>In</p> version&gt;=1.0version&lt;1.0 <pre><code>import shioaji as sj\napi = sj.Shioaji()\napi.login(\n    api_key=\"YOUR_API_KEY\", \n    secret_key=\"YOUR_SECRET_KEY\"\n)\n</code></pre> <pre><code>import shioaji as sj\napi = sj.Shioaji()\napi.login(\n    person_id=\"YOUR_PERSON_ID\", \n    passwd=\"YOUR_PASSWORD\",\n)\n</code></pre> <p>Out</p> <pre><code>[FutureAccount(person_id='', broker_id='', account_id='', signed=True, username=''),\nStockAccount(person_id='', broker_id='', account_id='', signed=True, username='')]\n</code></pre> <ul> <li>If you cannot find <code>signed</code> in your accounts, please refer to terms of service first.</li> </ul> <p>Login Arguments</p> version&gt;=1.0version&lt;1.0 <pre><code>api_key (str): API Key\nsecret_key (str): Secret Key\nfetch_contract (bool): whether to load contracts from cache or server (Default: True)\ncontracts_timeout (int): fetch contract timeout (Default: 0 ms)\ncontracts_cb (typing.Callable): fetch contract callback (Default: None)\nsubscribe_trade (bool): whether to subscribe Order/Deal event callback (Default: True)\nreceive_window (int): valid duration for login execution. (Default: 30,000 ms)\n</code></pre> <pre><code>person_id (str): person_id\npasswd (str): password\nhashed (bool): whether password has been hashed (Default: False)\nfetch_contract (bool): whether to load contracts from cache or server (Default: True)\ncontracts_timeout (int): fetch contract timeout (Default: 0 ms)\ncontracts_cb (typing.Callable): fetch contract callback (Default: None)\nsubscribe_trade (bool): whether to subscribe Order/Deal event callback (Default: True)\n</code></pre> <p>Warning</p> <p>When the version is greater than 1.0, you may receive Sign data is timeout when login. That is, login has exceeded the effective execution time. It may be that the time difference between your computer and server is too large, you need to calibrate your computer time. Or login execution time exceeds valid time, you can increase <code>receive_window</code>.</p>"},{"location":"tutor/login/#fetch-contracts-callback","title":"Fetch Contracts Callback","text":"<p>You can use <code>contracts_cb</code> as print to check contract download status.</p> <p>In</p> version&gt;=1.0version&lt;1.0 <pre><code>import shioaji as sj\napi = sj.Shioaji()\napi.login(\n    api_key=\"YOUR_API_KEY\", \n    secret_key=\"YOUR_SECRET_KEY\", \n    contracts_cb=lambda security_type: print(f\"{repr(security_type)} fetch done.\")\n)\n</code></pre> <pre><code>import shioaji as sj\napi = sj.Shioaji()\napi.login(\n    person_id=\"YOUR_PERSON_ID\", \n    passwd=\"YOUR_PASSWORD\", \n    contracts_cb=lambda security_type: print(f\"{repr(security_type)} fetch done.\")\n)\n</code></pre> <p>Out</p> <pre><code>[\n    FutureAccount(person_id='', broker_id='', account_id='', signed=True, username=''),\n    StockAccount(person_id='', broker_id='', account_id='', signed=True, username='')\n]\n&lt;SecurityType.Index: 'IND'&gt; fetch done.\n&lt;SecurityType.Future: 'FUT'&gt; fetch done.\n&lt;SecurityType.Option: 'OPT'&gt; fetch done.\n&lt;SecurityType.Stock: 'STK'&gt; fetch done.\n</code></pre>"},{"location":"tutor/login/#subscribe-trade","title":"Subscribe Trade","text":"<p>There are 2 options that you can adjust whether to subscribe trade (Order/Deal Event Callback). The first is <code>subscribe_trade</code> in login aruguments. Default value of <code>subscribe_trade</code> is <code>True</code>, and it will automatically subscribe trade from all accounts. You don't need to make any adjustments, if you would like to receive Order/Deal Events.</p> <p>In</p> version&gt;=1.0version&lt;1.0 <pre><code>import shioaji as sj\napi = sj.Shioaji()\napi.login(\n    api_key=\"YOUR_API_KEY\", \n    secret_key=\"YOUR_SECRET_KEY\", \n    subscribe_trade=True\n)\n</code></pre> <pre><code>import shioaji as sj\napi = sj.Shioaji()\napi.login(\n    person_id=\"YOUR_PERSON_ID\", \n    passwd=\"YOUR_PASSWORD\", \n    subscribe_trade=True\n)\n</code></pre> <p>The second one is to manually use the API <code>subscribe_trade</code> and <code>unsubscribe_trade</code> for specific account.</p> <p>subscribe trade</p> <pre><code>api.subscribe_trade(account)\n</code></pre> <p>unsubscribe trade</p> <pre><code>api.unsubscribe_trade(account)\n</code></pre>"},{"location":"tutor/login/#account","title":"Account","text":""},{"location":"tutor/login/#list-accounts","title":"List Accounts","text":"<p>In:</p> <pre><code>accounts = api.list_accounts()\n</code></pre> <p>Out</p> <pre><code># print(accounts)\n[\n    FutureAccount(person_id='PERSON_ID_1', broker_id='BROKER_ID_1', account_id='ACCOUNT_ID_1', signed=True, username='USERNAME_1'), \n    FutureAccount(person_id='PERSON_ID_2', broker_id='BROKER_ID_2', account_id='ACCOUNT_ID_2', username='USERNAME_2'), \n    StockAccount(person_id='PERSON_ID_3', broker_id='BROKER_ID_3', account_id='ACCOUNT_ID_3', username='USERNAME_3'), \n    StockAccount(person_id='PERSON_ID_4', broker_id='BROKER_ID_4', account_id='ACCOUNT_ID_4', signed=True, username='USERNAME_4')\n]\n</code></pre> <ul> <li>If <code>signed</code> does not appear in the account list, like ACCOUNT_ID_2 and ACCOUNT_ID_3, it means that the account has not signed or completed the test report in the simulation mode. Please refer to Terms of service.</li> </ul>"},{"location":"tutor/login/#default-account","title":"Default Account","text":"<p>In</p> <pre><code># Futures default account\nprint(api.futopt_account)\n</code></pre> <p>Out</p> <pre><code>FutureAccount(person_id='PERSON_ID_1', broker_id='BROKER_ID_1', account_id='ACCOUNT_ID_1', signed=True, username='USERNAME_1')\n</code></pre> <p>Set default account</p> <p>In</p> <pre><code># Default futures account switch to ACCOUNT_ID_2 from ACCOUNT_ID_1. \napi.set_default_account(accounts[1])\nprint(api.futopt_account)\n</code></pre> <p>Out</p> <pre><code>FutureAccount(person_id='PERSON_ID_2', broker_id='BROKER_ID_2', account_id='ACCOUNT_ID_2', username='USERNAME_2')\n</code></pre> <p> In Order object, you need to specify which account you want to place order. For more information about Order, please refer to Stock Order and Futures Order.</p> <pre><code>order = api.Order(\n    price=12, \n    quantity=1, \n    action=sj.constant.Action.Buy, \n    price_type=sj.constant.StockPriceType.LMT, \n    order_type=sj.constant.OrderType.ROD, \n    order_lot=sj.constant.StockOrderLot.Common, \n    account=api.stock_account\n)\n</code></pre>"},{"location":"tutor/login/#logout","title":"Logout","text":"<p>Logout funciton will close the connection between the client and the server. In order to provide high quality services, starting from 2021/08/06,  we've limit the number of connections used. It's a good practice  to logout or to terminate the program when it is not in use.</p> <p>logout</p> <pre><code>api.logout()\n# True\n</code></pre>"},{"location":"tutor/simulation/","title":"Simulation Mode","text":"<p>Users can first familiarize themselves with the API services in the simulation mode, which can avoid the loss of property caused by operational errors in the production environment. </p> <p>Simulation</p> <pre><code>import shioaji as sj\napi = sj.Shioaji(simulation=True)\n</code></pre>"},{"location":"tutor/simulation/#available-apis","title":"Available APIs","text":"<p>Data</p> <pre><code>1. quote.subscribe\n2. quote.unsubscribe\n3. ticks\n4. kbars\n5. snapshots\n6. short_stock_sources\n7. credit_enquires\n8. scanners\n</code></pre> <p>Order</p> <pre><code>1. place_order\n2. update_order\n3. cancel_order\n4. update_status\n5. list_trades\n</code></pre> <p>Account</p> <pre><code>1. list_positions\n2. list_profit_loss\n</code></pre>"},{"location":"tutor/accounting/account_balance/","title":"Account Balance","text":"<p>The feature of account_balance is used to query account balance  of stock account and you need to login first.</p> <p>In</p> <pre><code>api.account_balance?\n</code></pre> <p>Out</p> <pre><code>Signature:\n    api.account_balance(\n        timeout: int = 5000,\n        cb: Callable[[shioaji.position.AccountBalance], NoneType] = None,\n    )\nDocstring: query stock account balance \n</code></pre> <p>In</p> <pre><code>api.account_balance()\n</code></pre> <p>Out</p> <pre><code>AccountBalance(\n    status=&lt;FetchStatus.Fetched: 'Fetched'&gt;, \n    acc_balance=100000.0, \n    date='2023-01-06 13:30:00.000000', \n    errmsg=''\n)\n</code></pre> <p>AccountBalance</p> <pre><code>status (FetchStatus): fetch status\nacc_balance (float): account balance\ndate (str): query date\nerrmsg (str): error message    \n</code></pre>"},{"location":"tutor/accounting/account_portfolio/","title":"Account portfolio","text":"<p> Warning: The features of this page will be removed in the future.</p>"},{"location":"tutor/accounting/account_portfolio/#account-margin","title":"Account Margin","text":"<p>In</p> <pre><code>api.get_account_margin?\n</code></pre> <p>Out</p> <pre><code>Signature: api.get_account_margin(currency='NTD', margin_type='1', account={})\nDocstring:\nquery margin    currency: {NTX, USX, NTD, USD, HKD, EUR, JPY, GBP}\nthe margin calculate in which currency\n    - NTX: \u7d04\u7576\u53f0\u5e63\n    - USX: \u7d04\u7576\u7f8e\u91d1\n    - NTD: \u65b0\u53f0\u5e63\n    - USD: \u7f8e\u5143\n    - HKD: \u6e2f\u5e63\n    - EUR: \u6b50\u5143\n    - JPY: \u65e5\u5e63\n    - GBP: \u82f1\u938a\nmargin_type: {'1', '2'}\n    query margin type\n    - 1 : \u5373\u6642\n    - 2 : \u98a8\u96aa\n</code></pre> <p>In</p> <pre><code>account_margin = api.get_account_margin()\naccount_margin\n</code></pre> <p>Out</p> <pre><code>AccountMargin(person_id='PERSON_ID' broker_id='BROKER_ID' account_id='ACC_ID' signed=SIGNED username='USERNAME')\n</code></pre> <p>directly pass our AccountMargin object to pandas to using your model</p> <p>In</p> <pre><code>df_margin = pd.DataFrame(account_margin.data())\ndf_margin\n</code></pre> OrderPSecurity ProfitAccCount FProfit FMissConProfit OMissConProfit ... Bapamt Sapamt Adps Adamt Ybaln 0 50000.0 50000.0 0.0 0.0 0.0 ... 0.0 0.0 0.0 0.0 50000.0"},{"location":"tutor/accounting/account_portfolio/#get-open-position","title":"Get Open Position","text":"<p>In</p> <pre><code>api.get_account_openposition?\n</code></pre> <p>Out</p> <pre><code>Signature: api.get_account_openposition(product_type='0', query_type='0', account={})\nDocstring:\nquery open position\nproduct_type: {0, 1, 2, 3}\n    filter product type of open position\n    - 0: all\n    - 1: future\n    - 2: option\n    - 3: usd base\nquery_type: {0, 1}\n    query return with detail or summary\n    - 0: detail\n    - 1: summary\n</code></pre> <p>In</p> <pre><code>positions = api.get_account_openposition(query_type='1', account=api.futopt_account)\npositions\n</code></pre> <p>Out</p> <pre><code>AccountOpenPosition(person_id='PERSON_ID' broker_id='BROKER_ID' account_id='ACC_ID' signed=SIGNED username='USERNAME')\n</code></pre>"},{"location":"tutor/accounting/account_portfolio/#accountopenposition","title":"AccountOpenPosition","text":"<p>In</p> <pre><code>df_positions = pd.DataFrame(positions.data())\ndf_positions\n</code></pre> Account Code CodeName ContractAverPrice Currency Date FlowProfitLoss MTAMT OTAMT OrderBS OrderNum OrderType RealPrice SettlePrice SettleProfitLoss StartSecurity UpKeepSecurity Volume paddingByte 0 FF0020009104000 TXFA9 \u53f0\u6307\u671f\u8ca8 01 9508.4137 NTD 00000000 4795201.620000 6438000.000000 8352000.000000 B 9784.0 9784.00 4795201.620000 8352000.000000 6438000.000000 87.000000"},{"location":"tutor/accounting/account_portfolio/#get-settle-profitloss","title":"Get Settle ProfitLoss","text":"<p>In</p> <pre><code>api.get_account_settle_profitloss?\n</code></pre> <p>Out</p> <pre><code>Signature: api.get_account_settle_profitloss(product_type='0', summary='Y', start_date='', end_date='', currency='', account={})\nDocstring:\nquery settlement profit loss\nproduct_type: {0, 1, 2}\n    filter product type of open position\n    - 0: all\n    - 1: future\n    - 2: option\nsummary: {Y, N}\n    query return with detail or summary\n    - Y: summary\n    - N: detail\nstart_date: str\n    the start date of query range format with %Y%m%d\n    ex: 20180101\nend_date: str\n    the end date of query range format with %Y%m%d\n    ex: 20180201\ncurrency: {NTD, USD, HKD, EUR, CAD, BAS}\n    the profit loss calculate in which currency\n    - NTD: \u65b0\u53f0\u5e63\n    - USD: \u7f8e\u5143\n    - HKD: \u6e2f\u5e63\n    - EUR: \u6b50\u5143\n    - CAD: \u52a0\u5e63 \n    - BAS: \u57fa\u5e63\n</code></pre>"},{"location":"tutor/accounting/account_portfolio/#accountsettleprofitloss","title":"AccountSettleProfitLoss","text":"<p>In</p> <pre><code>st_date = (date.today() - timedelta(days=60)).strftime('%Y%m%d')\nsettle_profitloss = api.get_account_settle_profitloss(summary='Y', start_date=st_date)\nsettle_profitloss\n</code></pre> <pre><code>df_profitloss = pd.DataFrame(settle_profitloss.data())\ndf_profitloss\n</code></pre> account averagePrice code codeName currency floatProfitLoss handCharge ord_bs ord_type ordno ordno_b settleAvgPrc settleDate settleVolume tFlag tdate tradeProfitLoss tradeTax unVolume volume 0 F0020009104000 9900.0 TXFK8 \u53f0\u6307\u671f\u8ca8 11 NTD 460.000000 60.000000 S 00 kY002 kY003 9897.0 20181022 1.000000 1 20181022 600.000000 80.000000 0.000000 1.000000"},{"location":"tutor/accounting/margin/","title":"Margin","text":"<p>The feature of margin is used to query margin of futures account and you need to login first.</p> <p>In</p> <pre><code>api.margin?\n</code></pre> <p>Out</p> <pre><code>Signature:\napi.margin(\n    account: shioaji.account.Account = None,\n    timeout: int = 5000,\n    cb: Callable[[shioaji.position.Margin], NoneType] = None,\n) -&gt; shioaji.position.Margin\nDocstring: query future account of margin\n</code></pre> <p>In</p> <pre><code>api.margin(api.futopt_account)\n</code></pre> <p>Out</p> <pre><code>Margin(\n    status=&lt;FetchStatus.Fetched: 'Fetched'&gt;, \n    yesterday_balance=6000.0, \n    today_balance=6000.0, \n    deposit_withdrawal=0.0, \n    fee=0.0, \n    tax=0.0, \n    initial_margin=0.0, \n    maintenance_margin=0.0, \n    margin_call=0.0, \n    risk_indicator=999.0, \n    royalty_revenue_expenditure=0.0, \n    equity=6000.0, \n    equity_amount=6000.0, \n    option_openbuy_market_value=0.0, \n    option_opensell_market_value=0.0, \n    option_open_position=0.0, \n    option_settle_profitloss=0.0, \n    future_open_position=0.0, \n    today_future_open_position=0.0, \n    future_settle_profitloss=0.0, \n    available_margin=6000.0, \n    plus_margin=0.0, \n    plus_margin_indicator=0.0, \n    security_collateral_amount=0.0, \n    order_margin_premium=0.0, \n    collateral_amount=0.0\n)\n</code></pre> <p>Margin</p> <pre><code>status (FetchStatus): fetch status\nyesterday_balance (float): balance of yesterday\ntoday_balance (float): balance of today\ndeposit_withdrawal (float): deposit and withdrawal\nfee (float): fee\ntax (float): tax\ninitial_margin (float): margin of origin\nmaintenance_margin (float):  margin of maintenance\nmargin_call (float):  margin of call\nrisk_indicator (float): risk indicator\nroyalty_revenue_expenditure (float): revenue and expenditure of royalty\nequity (float): equity\nequity_amount (float): amount of equity\noption_openbuy_market_value (float): value of option openbuy market\noption_opensell_market_value (float): value of option opensell market\noption_open_position (float): profit loss of open option \noption_settle_profitloss (float): profit loss of settle option\nfuture_open_position (float): profit loss of open future\ntoday_future_open_position (float): profit loss of today open future\nfuture_settle_profitloss (float): profit loss of settle future\navailable_margin (float): available margin\nplus_margin (float): plus margin\nplus_margin_indicator (float): indicator of plus margin\nsecurity_collateral_amount (float): amount of security collateral\norder_margin_premium (float): order margin and order premium \ncollateral_amount (float): amount of collateral\n</code></pre>"},{"location":"tutor/accounting/position/","title":"Position","text":"<p>The feature of list_positions is used to query unrealized gain or loss of account and you need to login first.</p>"},{"location":"tutor/accounting/position/#position","title":"Position","text":"<p>In</p> <pre><code>api.list_positions?\n</code></pre> <p>Out</p> <pre><code>Signature:\napi.list_positions(\n    account: shioaji.account.Account = None,\n    unit: shioaji.constant.Unit = &lt;Unit.Common: 'Common'&gt;,\n    timeout: int = 5000,\n    cb: Callable[[List[Union[shioaji.position.StockPosition, shioaji.position.FuturePosition]]], NoneType] = None,\n) -&gt; List[Union[shioaji.position.StockPosition, shioaji.position.FuturePosition]]\nDocstring:\nquery account of unrealized gain or loss\nArgs:\n    account (:obj:Account):\n        choice the account from listing account (Default: stock account)\n</code></pre>"},{"location":"tutor/accounting/position/#stocks","title":"Stocks","text":""},{"location":"tutor/accounting/position/#common-stocks","title":"Common Stocks","text":"<p>In</p> <pre><code>api.list_positions(api.stock_account)\n</code></pre> <p>Out</p> <pre><code>[\n    StockPosition(\n        id=0, \n        code='2890', \n        direction=&lt;Action.Buy: 'Buy'&gt;, \n        quantity=12, \n        price=2.79, \n        last_price=16.95, \n        pnl=169171.0, \n        yd_quantity=12, \n        margin_purchase_amount=0, \n        collateral=0, \n        short_sale_margin=0, \n        interest=0\n    )\n]\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>positions = api.list_positions(api.stock_account)\ndf = pd.DataFrame(s.__dict__ for s in positions)\ndf\n</code></pre> <p>Out</p> id code direction quantity price last_price pnl yd_quantity cond margin_purchase_amount collateral short_sale_margin interest 0 0 2890 Buy 12 2.79 16.95 169172 12 Cash 0 0 0 <p>StockPosition</p> <pre><code>id (int): position id\ncode (str): contract id\ndirection (Action): action\n    {Buy, Sell}\nquantity (int): quantity\nprice (float): the average price\nlast_price (float): last price\npnl (float): unrealized profit\nyd_quantity (int): yesterday\ncond (StockOrderCond): Default Cash\n    {Cash(\u73fe\u80a1), Netting(\u9918\u984d\u4ea4\u5272), MarginTrading(\u878d\u8cc7),ShortSelling(\u878d\u5238), Emerging(\u8208\u6ac3)}\nmargin_purchase_amount (int): margin_purchase_amount\ncollateral (int): collateral\nshort_sale_margin (int): short_sale_margin\ninterest (int): interest\n</code></pre>"},{"location":"tutor/accounting/position/#odd-stocks","title":"Odd Stocks","text":"<p>The unit is the number of shares.</p> <p>In</p> <pre><code>api.list_positions(\n    api.stock_account, \n    unit=sj.constant.Unit.Share\n)\n</code></pre> <p>Out</p> <pre><code>[\n    StockPosition(\n        id=0, \n        code='2890', \n        direction=&lt;Action.Buy: 'Buy'&gt;, \n        quantity=10000, \n        price=10.1, \n        last_price=12.0, \n        pnl=1234.0, \n        yd_quantity=10000, \n        margin_purchase_amount=0, \n        collateral=0, \n        short_sale_margin=0, \n        interest=0\n    )\n]\n</code></pre>"},{"location":"tutor/accounting/position/#futures-and-options","title":"Futures and Options","text":"<p><code>account</code> is defaulted as a Stock account, and if you want to query the Futures or Options content, you need to bring in the <code>futopt_account</code>.</p> <p>In</p> <pre><code>api.list_positions(api.futopt_account)\n</code></pre> <p>Out</p> <pre><code>[\n    FuturePosition(\n        id=0,\n        code='TX201370J2', \n        direction=&lt;Action.Buy: 'Buy'&gt;, \n        quantity=3, \n        price=131.0000, \n        last_price=126.0, \n        pnl=-750.00\n    )\n]\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>positions = api.list_positions(api.futopt_account)\ndf = pd.DataFrame(p.__dict__ for p in positions)\ndf\n</code></pre> <p>Out</p> id code direction quantity price last_price pnl 0 TXFA3 Buy 4 14181 14375 155200 <p>FuturePosition</p> <pre><code>id (int): position id\ncode (str): contract id\ndirection (Action): action\n    {Buy, Sell}\nquantity (int): quantity\nprice (float): the average price\nlast_price (float): last price\npnl (float): unrealized profit\n</code></pre>"},{"location":"tutor/accounting/position/#position-detail","title":"Position Detail","text":"<p>Using the result obtained from <code>list_positions</code>, bring the <code>id</code> into <code>detail_id</code> to query the details of that position.</p>"},{"location":"tutor/accounting/position/#stocks_1","title":"Stocks","text":"<p>In</p> <pre><code>api.list_position_detail?\n</code></pre> <p>Out</p> <pre><code>Signature:\n    api.list_position_detail(\n    account: shioaji.account.Account = None,\n    detail_id: int = 0,\n    timeout: int = 5000,\n    cb: Callable[[List[Union[shioaji.position.StockPositionDetail, shioaji.position.    FuturePositionDetail]]], NoneType] = None,\n) -&gt; List[Union[shioaji.position.StockPositionDetail, shioaji.position.FuturePositionDetail]]\nDocstring:\nquery account of position detail\n\nArgs:\n    account (:obj:Account):\n        choice the account from listing account (Default: stock account)\n    detail_id (int): the id is from Position object, Position is from list_positions\n</code></pre> <p>In</p> <pre><code>position_detail = api.list_position_detail(api.stock_account, 1)\nposition_detail\n</code></pre> <p>Out</p> <pre><code>[\n    StockPositionDetail(\n        date='2023-02-22', \n        code='3558', \n        quantity=0, \n        price=1461.0, \n        last_price=1470.0, \n        dseq='WA371', \n        direction=&lt;Action.Buy: 'Buy'&gt;, \n        pnl=9.0, \n        currency=&lt;Currency.TWD: 'TWD'&gt;, \n        fee=1.0\n    )\n]\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>df = pd.DataFrame(pnl.__dict__ for pnl in position_detail)\ndf\n</code></pre> <p>Out</p> date code quantity price last_price direction pnl currency fee cond ex_dividends interest margintrading_amt collateral 2023-02-22 3558 0 1461.0 WA371 Action.Buy 11.0 Currency.TWD 1.0 StockOrderCond.Cash 0 0 0 0 <p>\u5c6c\u6027</p> <pre><code>date (str): trade date\ncode (str): contract id    \nquantity (int): quantity\nprice (float): price\nlast_price (float): last price\ndseq (str): detail seqno no\ndirection (Action): {Buy, Sell}\npnl (decimal): unrealized profit\ncurrency (string): {NTD, USD, HKD, EUR, CAD, BAS}\nfee (decimal): fee\ncond (StockOrderCond): Default Cash\n    {Cash, Netting, MarginTrading,ShortSelling, Emerging}\nex_dividends(int): ex-dividend amount\ninterest (int): interest\nmargintrading_amt(int): margin trading amount\ncollateral (int): collateral \n</code></pre>"},{"location":"tutor/accounting/position/#futures-and-options_1","title":"Futures and Options","text":"<p>In</p> <pre><code>position_detail = api.list_position_detail(api.futopt_account, 0)\nposition_detail\n</code></pre> <p>Out</p> <pre><code>[\n    FuturePositionDetail(\n        date='2023-02-14', \n        code='MXFC3', \n        quantity=1, \n        price=15611.0, \n        last_price=15541.0, \n        dseq='tA0n8', \n        direction=&lt;Action.Buy: 'Buy'&gt;, \n        pnl=-3500.0, \n        currency=&lt;Currency.TWD: 'TWD'&gt;, \n        entry_quantity=1\n    )\n]\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>df = pd.DataFrame(pnl.__dict__ for pnl in position_detail)\ndf\n</code></pre> <p>Out</p> date code quantity price last_price dseq direction pnl currency entry_quantity 2023-02-14 MXFC3 1 15611.0 15541.0 tA0n8 Action.Buy -3500.0 Currency.TWD 1 <p>\u5c6c\u6027</p> <pre><code>code (str): contract id\ndate (str): trade date\nquantity (int): quantity\nprice (float): price\nlast_price (float): last price    \ndseq (str): detail seqno no\ndirection (Action): {Buy, Sell}\npnl (float): unrealized profit\ncurrency (str): {NTD, USD, HKD, EUR, CAD, BAS}\nfee (float or int): fee\nentry_quantity(int): entry quantity\n</code></pre>"},{"location":"tutor/accounting/profit_loss/","title":"Profit Loss","text":"<p>You need to login first.</p>"},{"location":"tutor/accounting/profit_loss/#profit-loss","title":"Profit Loss","text":"<p>The feature of list_profit_loss is used to query realized profit loss of account.</p> <p>In</p> <pre><code>api.list_profit_loss?\n</code></pre> <p>Out</p> <pre><code>Signature:\n    api.list_profit_loss(\n        account: shioaji.account.Account = None,\n        begin_date: str = '',\n        end_date: str = '',\n        unit: shioaji.constant.Unit = &lt;Unit.Common: 'Common'&gt;,\n        timeout: int = 5000,\n        cb: Callable[[List[shioaji.position.ProfitLoss]], NoneType] = None,\n    ) -&gt; List[shioaji.position.ProfitLoss]\nDocstring:\n    query account of profit loss\n\n    Args:\n        account (:obj:Account): \n            choice the account from listing account (Default: stock account)\n        begin_date (str): the start date of query profit loss (Default: today)\n        end_date (str): the end date of query profit loss (Default: today)\n</code></pre> <p>Enter the time interval you want to query. <code>begin_date</code> is the start time, and <code>end_date</code> is the end time. <code>unit</code> is the quantity unit, where <code>Common</code> represents whole shares and <code>Share</code> represents fractional shares.</p> <p>In</p> <pre><code>profitloss = api.list_profit_loss(api.stock_account,'2020-05-05','2020-05-30')\nprofitloss\n</code></pre> <p>Out</p> <pre><code>[\n    StockProfitLoss(\n        id=0, \n        code='2890', \n        seqno='14816', \n        dseq='ID111', \n        quantity=1, \n        price=10.1, \n        pnl=1234.0, \n        pr_ratio=0.1237, \n        cond='Cash', \n        date='2020-05-22'\n    )\n]\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>df = pd.DataFrame(pnl.__dict__ for pnl in profitloss)\ndf\n</code></pre> <p>Out</p> id code cond date pnl pr_ratio price quantity seqno dseq 0 2890 StockOrderCond.Cash 2020-05-22 1000.0 0.1237 10.1 1 14816 ID111 <p>StockProfitLoss</p> <pre><code>id (int): use to find detail\ncode (str): contract id\nseqno (str): seqno no\ndseq (str): seqno no\nquantity (int): quantity\nprice (float): price\npnl (float): profit and loss\npr_ratio (float): profit rate\ncond (StockOrderCond): {Cash, Netting, MarginTrading, ShortSelling}\ndate (str): trade date\n</code></pre> <p>FutureProfitLoss</p> <pre><code>id (int): use to find detail\ncode (str): contract id\nquantity (int): quantity\npnl (float): profit and loss\ndate (str): trade date\nentry_price (int): entry price\ncover_price (int): cover price\ntax (int): tax\nfee (int): transaction fee\n</code></pre>"},{"location":"tutor/accounting/profit_loss/#profit-loss-detail","title":"Profit Loss Detail","text":"<p>The feature of list_profit_loss_detail is used to query profit loss detail of account. <code>unit</code> is the quantity unit, where <code>Common</code> represents whole shares and <code>Share</code> represents fractional shares.</p> <p>In</p> <pre><code>api.list_profit_loss_detail?\n</code></pre> <p>Out</p> <pre><code>Signature:\napi.list_profit_loss_detail(\n    account: shioaji.account.Account = None,\n    detail_id: int = 0,\n    unit: shioaji.constant.Unit = &lt;Unit.Common: 'Common'&gt;,\n    timeout: int = 5000,\n    cb: Callable[[List[Union[shioaji.position.StockProfitDetail, shioaji.position.FutureProfitDetail]]], NoneType] = None,\n) -&gt; List[Union[shioaji.position.StockProfitDetail, shioaji.position.FutureProfitDetail]]\nDocstring:\nquery account of profit loss detail\n\nArgs:\n    account (:obj:Account):\n        choice the account from listing account (Default: stock account)\n    detail_id (int): the id is from ProfitLoss object, ProfitLoss is from list_profit_loss\n</code></pre> <p>In</p> <pre><code>profitloss_detail = api.list_profit_loss_detail(api.stock_account, 2)\nprofitloss_detail\n</code></pre> <p>Out</p> <pre><code>[\n    StockProfitDetail(\n        date='2020-01-01', \n        code='2890', \n        quantity=1, \n        dseq='IX000', \n        fee=20, \n        tax=0, \n        currency='TWD', \n        price=10.8, \n        cost=10820, \n        rep_margintrading_amt=0, \n        rep_collateral=0, \n        rep_margin=0, \n        shortselling_fee=0, \n        ex_dividend_amt=0, \n        interest=0\n    )\n]\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>df = pd.DataFrame(pnl.__dict__ for pnl in profitloss_detail)\ndf\n</code></pre> <p>Out</p> date code quantity dseq fee tax currency price cost rep_margintrading_amt rep_collateral rep_margin shortselling_fee ex_dividend_amt interest trade_type cond 2020-01-01 2890 1 IX000 20 0 TWD 10.8 10820 0 0 0 0 0 0 Common Cash <p>StockProfitDetail</p> <pre><code>date (str): trade date\ncode (str): contract id\nquantity (int): quantity\ndseq (str): detail seqno no\nfee (int): fee\ntax (int): trading tax\ncurrency (str): {NTD, USD, HKD, EUR, CAD, BAS}\nprice (float): price\ncost (int): cost of price\nrep_margintrading_amt (int): repay amount of margin trading\nrep_collateral (int): repay collateral\nrep_margin (int): repay margin\nshortselling_fee (int): fee of short selling\nex_dividend_amt: ex-dividend amount\ninterest (int): interest\ntrade_type (TradeType): {Common, DayTrade}\ncond (StockOrderCond): {Cash, Netting, MarginTrading, ShortSelling}\n</code></pre> <p>FutureProfitDetail</p> <pre><code>date (str): trade date\ncode (str): contract id\nquantity (int): quantity\ndseq (str): detail seqno no\nfee (int): fee\ntax (int): trading tax\ncurrency (str): {NTD, USD, HKD, EUR, CAD, BAS}\ndirection (Action): {Buy, Sell}\nentry_price (int): entry price\ncover_price (int): cover price\npnl (int): profit and loss\n</code></pre>"},{"location":"tutor/accounting/profit_loss/#profit-loss-summary","title":"Profit Loss Summary","text":"<p>The feature of list_profit_loss_summary is used to query summary of profit loss for a period of time.</p> <p>In</p> <pre><code>api.list_profit_loss_summary?\n</code></pre> <p>Out</p> <pre><code>Signature:\napi.list_profit_loss_summary(\n    account: shioaji.account.Account = None,\n    begin_date: str = '',\n    end_date: str = '',\n    timeout: int = 5000,\n    cb: Callable[[ProfitLossSummaryTotal], NoneType] = None,\n) -&gt; ProfitLossSummaryTotal\nDocstring:\nquery summary profit loss of a period time\n\nArgs:\n    account (:obj:Account):\n        choice the account from listing account (Default: stock account)\n    begin_date (str): the start date of query profit loss (Default: today)\n    end_date (str): the end date of query profit loss (Default: today)\n</code></pre> <p>Enter the time interval you want to query. <code>begin_date</code> is the start time, and <code>end_date</code> is the end time.</p> <p>In</p> <pre><code>profitloss_summary = api.list_profit_loss_summary(api.stock_account,'2020-05-05','2020-05-30')\nprofitloss_summary\n</code></pre> <p>Out</p> <pre><code>ProfitLossSummaryTotal(\n    status=&lt;FetchStatus.Fetched: 'Fetched'&gt;, \n    profitloss_summary=[\n        StockProfitLossSummary(\n            code='2890', \n            quantity=2000, \n            entry_price=17, \n            cover_price=10, \n            pnl=-11585.0, \n            currency='NTD', \n            entry_cost=34550, \n            cover_cost=21600, \n            buy_cost=33112, \n            sell_cost=21527, \n            pr_ratio=-34.99\n        )\n    ], \n    total=ProfitLossTotal(\n        quantity=2000, \n        buy_cost=33112, \n        sell_cost=21527, \n        pnl=-11585.0, \n        pr_ratio=-34.99\n    )\n)\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>df = pd.DataFrame(pnl.__dict__ for pnl in profitloss_summary.profitloss_summary) \ndf\n</code></pre> <p>Out</p> code quantity entry_price cover_price pnl currency entry_cost cover_cost buy_cost sell_cost pr_ratio cond 2890 2000 17 10 -11585 NTD 34550 21600 33112 21527 -34.99 Cash <p>StockProfitLossSummary</p> <pre><code>code (str): contract id\nquantity (int): quantity\nentry_price (int): price of entry\ncover_price (int): price of cover\npnl (float): profit and loss\ncurrency (str): currency\nentry_cost (int): cost of entry\ncover_cost (int): cost of cover\nbuy_cost (int): cost of buy\nsell_cost (int): cost of sell\npr_ratio (float): profit rate\ncond (StockOrderCond): {Cash, Netting, MarginTrading, ShortSelling}\n</code></pre> <p>FutureProfitLossSummary</p> <pre><code>code (str): contract id\nquantity (int): quantity\nentry_price (int): price of entry\ncover_price (int): price of cover\npnl (float): profit and loss\ncurrency (str): currency\ndirection (Action): {Buy, Sell}\ntax (int): tax\nfee (int): fee\n</code></pre>"},{"location":"tutor/accounting/settlements/","title":"Settlements","text":"<p>The feature of settlements is used to query settlements of stock account and you need to login first.</p>"},{"location":"tutor/accounting/settlements/#settlements","title":"Settlements","text":"<p>In</p> <pre><code>api.settlements?\n</code></pre> <p>Out</p> <pre><code>Signature:\napi.settlements(\n    account: shioaji.account.Account = None,\n    timeout: int = 5000,\n    cb: Callable[[List[shioaji.position.SettlementV1]], NoneType] = None,\n) -&gt; List[shioaji.position.SettlementV1]\nDocstring: query stock account of settlements\n</code></pre> <p>In</p> <pre><code>settlements = api.settlements(api.stock_account)   \nsettlements\n</code></pre> <p>Out</p> <pre><code>[\n    SettlementV1(date=datetime.date(2022, 10, 13), amount=0.0, T=0),\n    SettlementV1(date=datetime.date(2022, 10, 14), amount=0.0, T=1),\n    SettlementV1(date=datetime.date(2022, 10, 17), amount=0.0, T=2)\n]\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>df = pd.DataFrame([s.__dict__ for s in settlements]).set_index(\"T\")\ndf\n</code></pre> <p>out</p> T date amount 0 2022-10-13 0 1 2022-10-14 0 2 2022-10-17 0 <p>SettlementV1</p> <pre><code>date (datetime.date): date of Tday\namount (float): settlement amount\nT (int): Tday\n</code></pre>"},{"location":"tutor/advanced/nonblock/","title":"Non-blocking Mode","text":"<p>Blocking is a pattern where a function must wait for something to complete. Every function is waiting, whether it is doing I/O or doing CPU tasks. For example, if the function tries to get data from the database, it needs to stop and wait for the return result, and then continue processing the next task after receiving the return result. In contrast, non-blocking mode does not wait for operations to complete. Non-blocking mode is useful if you are trying to send batch operation in a short period of time. We provide the following examples to give you a better understanding of the difference.</p> <p>To switch blocking/non-blocking mode use parameter <code>timeout</code>. Set the API parameter <code>timeout</code> to <code>0</code> for non-blocking mode. The default value of <code>timeout</code> is 5000 (milliseconds), which means the function waits for up to 5 seconds.</p>"},{"location":"tutor/advanced/nonblock/#non-blocking-place-order","title":"Non-Blocking Place Order","text":"<p>Set <code>timeout = 0</code> in <code>place_order</code> function.</p> <p>In</p> <pre><code>contract = api.Contracts.Futures.TXF['TXF202301']\norder = api.Order(\n    action=sj.constant.Action.Sell,\n    price=14000,\n    quantity=1,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\ntrade = api.place_order(contract, order, timeout=0)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Future(\n        code='TXFA3', \n        symbol='TXF202301', \n        name='\u81fa\u80a1\u671f\u8ca801', \n        category='TXF', \n        delivery_month='202301', \n        delivery_date='2023/01/30', \n        underlying_kind='I', \n        unit=1, \n        limit_up=16241.0, \n        limit_down=13289.0, \n        reference=14765.0, \n        update_date='2023/01/10'\n    ), \n    order=Order(\n        action=&lt;Action.Sell: 'Sell'&gt;, \n        price=14000, \n        quantity=1, \n        account=FutureAccount(\n            person_id='F123456789', \n            broker_id='F002000', \n            account_id='1234567', \n            signed=True, \n            username='PAPIUSER'\n        ), \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;\n    ), \n    status=OrderStatus(status=&lt;Status.Inactive: 'Inactive'&gt;)\n)\n</code></pre> <p>The <code>Trade</code> object obtained in non-blocking mode will lack some information because the order is still in transit and has not been sent to the exchange. There are no <code>id</code> and <code>seqno</code> in the <code>Order</code> object, <code>id</code>, <code>status_code</code>, <code>order_datetime</code> and <code>deals</code> are missing in the <code>OrderStatus</code> object, and <code>status</code> is displayed as <code>Inactive</code>. In the non-blocking mode, there are two ways to obtain the above-mentioned information: <code>`order event callback</code> and <code>non-blocking place order callback</code>.</p>"},{"location":"tutor/advanced/nonblock/#order-event-callback","title":"Order event callback","text":"<p>Out</p> <pre><code>OrderState.FuturesOrder {\n    'operation': {\n        'op_type': 'New', \n        'op_code': '00', \n        'op_msg': ''\n    }, \n    'order': {\n        'id': 'de616839', \n        'seqno': '500009', \n        'ordno': '000009', \n        'action': 'Sell', \n        'price': 14000, \n        'quantity': 1, \n        'order_type': 'ROD', \n        'price_type': 'LMT', \n        'oc_type': 'Auto', \n        'custom_field': ''\n    }, \n    'status': {\n        'id': 'de616839', \n        'exchange_ts': 1673334371.492948, \n        'order_quantity': 1, \n        'modified_price': 0, \n        'cancel_quantity': 0, \n        'web_id': 'Z'\n    }, \n    'contract': {\n        'security_type': 'FUT', \n        'exchange': 'TAIFEX', \n        'code': 'TXFA3'\n    }\n}\n</code></pre>"},{"location":"tutor/advanced/nonblock/#non-blocking-place-order-callback","title":"Non-blocking place order callback","text":"<p>In</p> <pre><code>from shioaji.order import Trade\n\ndef non_blocking_cb(trade:Trade):\n    print('__my_callback__')\n    print(trade)\n\ntrade = api.place_order(\n    contract, \n    order, \n    timeout=0, \n    cb=non_blocking_cb # only work in non-blocking mode\n)\n</code></pre> <p>Out: place order callback</p> <pre><code>__my_callback__\ncontract=Future(\n    code='TXFA3', \n    symbol='TXF202301', \n    name='\u81fa\u80a1\u671f\u8ca801', \n    category='TXF', \n    delivery_month='202301', \n    delivery_date='2023/01/30', \n    underlying_kind='I', \n    unit=1, \n    limit_up=16241.0, \n    limit_down=13289.0, \n    reference=14765.0, \n    update_date='2023/01/10'\n), \norder=Order(\n    action=&lt;Action.Sell: 'Sell'&gt;, \n    price=14000, \n    quantity=1, \n    id='40fd85d6', \n    seqno='958433', \n    ordno='kY01g', \n    account=FutureAccount(\n        person_id='F123456789', \n        broker_id='F002000', \n        account_id='1234567', \n        signed=True, \n        username='PAPIUSER'\n    ), \n    price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n    order_type=&lt;OrderType.ROD: 'ROD'&gt;\n), \nstatus=OrderStatus(\n    id='40fd85d6', \n    status=&lt;Status.Submitted: 'Submitted'&gt;, \n    status_code='    ', \n    order_datetime=datetime.datetime(2023, 01, 10, 15, 14, 32), \n    deals=[]\n)\n</code></pre> <p></p>"},{"location":"tutor/advanced/nonblock/#compare-both-modes","title":"Compare both modes","text":"<p>In non-wait mode, executing <code>place_order</code> takes about 0.01 seconds, which is 12 times faster than the execution time in blocking mode. Although it is more efficient to place order in the non-blocking mode, the order will not take effect until the exchange receives the order.  </p> <p>contract and order</p> <pre><code>contract = api.Contracts.Futures.TXF['TXF202301']\norder = api.Order(\n    action='Sell',\n    price=14000,\n    quantity=1,\n    price_type='LMT',\n    order_type='ROD', \n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\n</code></pre> <p>Blocking</p> <pre><code>start_time = time.time()\napi.place_order(contract, order) # block and wait for the order response\nprint(time.time() - start_time)\n# 0.136578369140625 &lt;- may be different\n</code></pre> <p>Non-Blocking</p> <pre><code>start_time = time.time()\napi.place_order(contract, order, timeout=0) # non-block, the order is in transmition (inactive).\nprint(time.time() - start_time)\n# 0.011670351028442383 &lt;- may be different\n</code></pre> <p>Non-Blocking mode Supported Function</p> <pre><code>- place_order\n- update_order\n- cancel_order\n- update_status\n- list_positions\n- list_position_detail\n- list_profit_loss\n- list_profit_loss_detail\n- list_profit_loss_summary\n- settlements\n- margin\n- ticks\n- kbars\n</code></pre>"},{"location":"tutor/advanced/quote_binding/","title":"Quote-Binding Mode","text":"<p>Shioaji provides quote-binding mode which you can store tick/bidask in queue, push them to redis, or submit a stop order inside quote callback function. We show examples to make you more understand how to use quote-binding mode.</p>"},{"location":"tutor/advanced/quote_binding/#examples","title":"Examples","text":""},{"location":"tutor/advanced/quote_binding/#bind-quote-to-message-queue","title":"Bind quote to message queue","text":"<p>In: pythonic way by using decorator</p> <pre><code>from collections import defaultdict, deque\nfrom shioaji import TickFOPv1, Exchange\n\n# set context\nmsg_queue = defaultdict(deque)\napi.set_context(msg_queue)\n\n# In order to use context, set bind=True\n@api.on_tick_fop_v1(bind=True)\ndef quote_callback(self, exchange:Exchange, tick:TickFOPv1):\n    # append quote to message queue\n    self[tick.code].append(tick)\n\n# subscribe\napi.quote.subscribe(\n    api.Contracts.Futures.TXF['TXF202107'],\n    quote_type = sj.constant.QuoteType.Tick, \n    version = sj.constant.QuoteVersion.v1\n)\n</code></pre> <p>In: traditional way</p> <pre><code>def quote_callback(self, exchange:Exchange, tick:TickFOPv1):\n    # append tick to context\n    self[tick.code].append(tick)\n\n# In order to use context, set bind=True\napi.quote.set_on_tick_fop_v1_callback(quote_callback, bind=True)\n</code></pre> <p>Out</p> <pre><code># after subscribe and wait for a few seconds ...\n# print(msg_queue)\ndefaultdict(collections.deque, \n    {\n        'TXFG1': [\n            Tick(code='TXFG1', datetime=datetime.datetime(2021, 7, 5, 10, 0, 21, 220000), open=Decimal('17755'), underlying_price=Decimal('17851.88'), bid_side_total_vol=34824, ask_side_total_vol=36212, avg_price=Decimal('17837.053112'), close=Decimal('17833'), high=Decimal('17900'), low=Decimal('17742'), amount=Decimal('17833'), total_amount=Decimal('981323314'), volume=1, total_volume=55016, tick_type=1, chg_type=2, price_chg=Decimal('184'), pct_chg=Decimal('1.042552'), simtrade=0),\n            Tick(code='TXFG1', datetime=datetime.datetime(2021, 7, 5, 10, 0, 21, 781000), open=Decimal('17755'), underlying_price=Decimal('17851.88'), bid_side_total_vol=34825, ask_side_total_vol=36213, avg_price=Decimal('17837.053056'), close=Decimal('17834'), high=Decimal('17900'), low=Decimal('17742'), amount=Decimal('17834'), total_amount=Decimal('981341148'), volume=1, total_volume=55017, tick_type=1, chg_type=2, price_chg=Decimal('185'), pct_chg=Decimal('1.048218'), simtrade=0)\n        ]\n    }\n)\n</code></pre>"},{"location":"tutor/advanced/quote_binding/#push-quote-to-redis-stream","title":"Push quote to redis stream","text":"<p>Before start, please install redis first. Below example shows how to push quote massages to redis stream.</p> <p>In</p> <pre><code>import redis\nimport json\nfrom shioaji import TickFOPv1, Exchange\n\n# redis setting\nr = redis.Redis(host='localhost', port=6379, db=0, decode_responses=True)\n\n# set up context\napi.set_context(r)\n\n# In order to use context, set bind=True\n@api.on_tick_fop_v1(bind=True)\ndef quote_callback(self, exchange:Exchange, tick:TickFOPv1):\n    # push them to redis stream\n    channel = 'Q:' + tick.code # ='Q:TXFG1' in this example\n    self.xadd(channel, {'tick':json.dumps(tick.to_dict(raw=True))})\n</code></pre> <p>Out</p> <pre><code># after subscribe and wait for a few seconds ...\n# r.xread({'Q:TXFG1':'0-0'})\n[\n    ['Q:TXFG1',\n        [\n            ('1625454940107-0',\n                {'tick': \n                    '{\"code\": \"TXFG1\", \"datetime\": \"2021-07-05T11:15:49.066000\", \"open\": \"17755\", \"underlying_price\": \"17904.03\", \"bid_side_total_vol\": 49698, \"ask_side_total_vol\": 51490, \"avg_price\": \"17851.312322\", \"close\": \"17889\", \"high\": \"17918\", \"low\": \"17742\", \"amount\": \"268335\", \"total_amount\": \"1399310819\", \"volume\": 15, \"total_volume\": 78387, \"tick_type\": 2, \"chg_type\": 2, \"price_chg\": \"240\", \"pct_chg\": \"1.35985\", \"simtrade\": 0}'\n                }\n            ),\n            ('1625454941854-0',\n                {'tick': \n                    '{\"code\": \"TXFG1\", \"datetime\": \"2021-07-05T11:15:50.815000\", \"open\": \"17755\", \"underlying_price\": \"17902.58\", \"bid_side_total_vol\": 49702, \"ask_side_total_vol\": 51478, \"avg_price\": \"17851.313258\", \"close\": \"17888\", \"high\": \"17918\", \"low\": \"17742\", \"amount\": \"35776\", \"total_amount\": \"1399346595\", \"volume\": 2, \"total_volume\": 78389, \"tick_type\": 2, \"chg_type\": 2, \"price_chg\": \"239\", \"pct_chg\": \"1.354184\", \"simtrade\": 0}'\n                }\n            )\n        ]\n    ]\n]\n\n\n# parse redis stream\n# [json.loads(x[-1]['tick']) for x in r.xread({'Q:TXFG1':'0-0'})[0][-1]]\n[\n    {\n        'code': 'TXFG1',\n        'datetime': '2021-07-05T11:15:49.066000',\n        'open': '17755',\n        'underlying_price': '17904.03',\n        'bid_side_total_vol': 49698,\n        'ask_side_total_vol': 51490,\n        'avg_price': '17851.312322',\n        'close': '17889',\n        'high': '17918',\n        'low': '17742',\n        'amount': '268335',\n        'total_amount': '1399310819',\n        'volume': 15,\n        'total_volume': 78387,\n        'tick_type': 2,\n        'chg_type': 2,\n        'price_chg': '240',\n        'pct_chg': '1.35985',\n        'simtrade': 0\n    },\n    {\n        'code': 'TXFG1',\n        'datetime': '2021-07-05T11:15:50.815000',\n        'open': '17755',\n        'underlying_price': '17902.58',\n        'bid_side_total_vol': 49702,\n        'ask_side_total_vol': 51478,\n        'avg_price': '17851.313258',\n        'close': '17888',\n        'high': '17918',\n        'low': '17742',\n        'amount': '35776',\n        'total_amount': '1399346595',\n        'volume': 2,\n        'total_volume': 78389,\n        'tick_type': 2,\n        'chg_type': 2,\n        'price_chg': '239',\n        'pct_chg': '1.354184',\n        'simtrade': 0\n    },\n]\n</code></pre>"},{"location":"tutor/advanced/quote_binding/#stop-order-implementation","title":"Stop Order Implementation","text":"<p>A stop order is an order to buy or sell a security when its price moves past a particular point, ensuring a higher probability of achieving a predetermined entry or exit price, limiting the investor's loss, or locking in a profit. Once the price crosses the predefined entry/exit point, the stop order becomes a market order.  </p> <p>We provide an example of stop order below. Please use at your own risk.</p> <p>Example: stop order</p> <pre><code>import time\nfrom typing import Union\n\nimport shioaji as sj\n\nclass StopOrderExcecutor:\n    def __init__(self, api: sj.Shioaji) -&gt; None:\n        self.api = api\n        self._stop_orders = {}\n\n    def on_quote(\n        self, quote: Union[sj.BidAskFOPv1, sj.BidAskSTKv1, sj.TickFOPv1, sj.TickSTKv1]\n    ) -&gt; None:\n        code = quote.code\n        if code in self._stop_orders:\n            for stop_order in self._stop_orders[code]:\n                if stop_order['executed']:\n                    continue\n                if hasattr(quote, \"ask_price\"):\n                    price = 0.5 * float(\n                        quote.bid_price[0] + quote.ask_price[0]\n                    )  # mid price\n                else:\n                    price = float(quote.close)  # Tick\n\n                is_execute = False\n                if stop_order[\"stop_price\"] &gt;= stop_order[\"ref_price\"]:\n                    if price &gt;= stop_order[\"stop_price\"]:\n                        is_execute = True\n\n                elif stop_order[\"stop_price\"] &lt; stop_order[\"ref_price\"]:\n                    if price &lt;= stop_order[\"stop_price\"]:\n                        is_execute = True\n\n                if is_execute:\n                    self.api.place_order(stop_order[\"contract\"], stop_order[\"pending_order\"])\n                    stop_order['executed'] = True\n                    stop_order['ts_executed'] = time.time()\n                    print(f\"execute stop order: {stop_order}\")\n                else:\n                    self._stop_orders[code]\n\n    def add_stop_order(\n        self,\n        contract: sj.contracts.Contract,\n        stop_price: float,\n        order: sj.order.Order,\n    ) -&gt; None:\n        code = contract.code\n        snap = self.api.snapshots([contract])[0]\n        # use mid price as current price to avoid illiquidity\n        ref_price = 0.5 * (snap.buy_price + snap.sell_price)\n        stop_order = {\n            \"code\": contract.code,\n            \"stop_price\": stop_price,\n            \"ref_price\": ref_price,\n            \"contract\": contract,\n            \"pending_order\": order,\n            \"ts_create\": time.time(),\n            \"executed\": False,\n            \"ts_executed\": 0.0\n        }\n\n        if code not in self._stop_orders:\n            self._stop_orders[code] = []\n        self._stop_orders[code].append(stop_order)\n        print(f\"add stop order: {stop_order}\")\n\n    def get_stop_orders(self) -&gt; dict:\n        return self._stop_orders\n\n    def cancel_stop_order_by_code(self, code: str) -&gt; None:\n        if code in self._stop_orders:\n            _ = self._stop_orders.pop(code)\n\n    def cancel_stop_order(self, stop_order: dict) -&gt; None:\n        code = stop_order[\"code\"]\n        if code in self._stop_orders:\n            self._stop_orders[code].remove(stop_order)\n            if len(self._stop_orders[code]) == 0:\n                self._stop_orders.pop(code)\n\n    def cancel_all_stop_orders(self) -&gt; None:\n        self._stop_orders.clear()\n</code></pre> <ul> <li>We use mid price of snapshots as our reference price to differentiate the direction of stop order.</li> </ul> <p>Basically, order will be pending at your computer. The order won't be submitted to exchange until close/mid price hit the stop price. Below example shows how to submit a stop-limit order. </p> <p>Set up a stop order</p> <pre><code># shioaji order\ncontract = api.Contracts.Futures.TXF['TXF202301']\norder = api.Order(\n    action='Buy',\n    price=14800,\n    quantity=1,\n    price_type='LMT',\n    order_type='ROD', \n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\n\n# Stop Order Excecutor\nsoe = StopOrderExcecutor(api)\nsoe.add_stop_order(contract=contract, stop_price=14805, order=order)\n</code></pre> <p>Out</p> <pre><code>add stop order: {\n    'code': 'TXFA3', \n    'stop_price': 14805, \n    'ref_price': 14790,\n    'contract': Future(\n        code='TXFA3', \n        symbol='TXF202301', \n        name='\u81fa\u80a1\u671f\u8ca801', \n        category='TXF', \n        delivery_month='202301', \n        delivery_date='2023/01/30', \n        underlying_kind='I', \n        unit=1, \n        limit_up=16241.0, \n        limit_down=13289.0, \n        reference=14765.0, \n        update_date='2023/01/10'\n    ), \n    'pending_order': Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=14800, \n        quantity=1, \n        account=FutureAccount(person_id='A123456789', broker_id='F002000', account_id='1234567', signed=True, username='PAIUSER'),\n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;\n    ), \n    'ts_create': 1673329115.1056178, \n    'executed': False, \n    'ts_executed': 0.0\n}\n</code></pre> <ul> <li>Stop-Market Order: <code>price_type = 'MKT'</code></li> </ul> <p>Finally, we bind <code>StopOrderExcecutor</code> to quote callback function. Note that you have to subscribe quote, so that stop order will be executed.</p> <p>Set up context and callback function</p> <pre><code>from shioaji import TickFOPv1, Exchange\n\n# set up context\napi.set_context(soe)\n\n# In order to use context, set bind=True\n@api.on_tick_fop_v1(bind=True)\ndef quote_callback(self, exchange:Exchange, tick:TickFOPv1):\n    # pass tick object to Stop Order Excecutor\n    self.on_quote(tick)\n\n# subscribe\napi.quote.subscribe(\n    contract,\n    quote_type = sj.constant.QuoteType.Tick, \n    version = sj.constant.QuoteVersion.v1\n)\n</code></pre> <p>Out: Once close/mid price hit stop price</p> <pre><code>execute stop order: {\n    'code': 'TXFA3', \n    'stop_price': 14805, \n    'ref_price': 14790, \n    'contract': Future(\n        code='TXFA3', \n        symbol='TXF202301', \n        name='\u81fa\u80a1\u671f\u8ca801', \n        category='TXF', \n        delivery_month='202301', \n        delivery_date='2023/01/30', \n        underlying_kind='I', \n        unit=1, \n        limit_up=16241.0, \n        limit_down=13289.0, \n        reference=14765.0, \n        update_date='2023/01/10'\n    ), \n    'pending_order': Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=14800, \n        quantity=1, \n        account=FutureAccount(person_id='A123456789', broker_id='F002000', account_id='1234567', signed=True, username='PAIUSER'),\n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;\n    ), \n    'ts_create': 1673329115.1056178, \n    'executed': True, \n    'ts_executed': 1673329161.3224185\n}\n</code></pre>"},{"location":"tutor/advanced/quote_manager_basic/","title":"Quote Manager Basic","text":"<p>the whole project code can be found in sj-trading, the whole example jupyter notebook can be found in quote_manager_usage.</p> <p>this project is created by using <code>uv</code>, if you are not familiar with how to use <code>uv</code> to create a project and manage dependencies, it is recommended to learn from the environment setup chapter.</p> <p>before start writing the quote manager, we will use the Polars package to process the quote data, so we need to add it to the project dependencies, at the same time, this tutorial will have an example of how to use Polars to quickly calculate technical indicators for multiple commodities, so we also need to add the polars_talib package to the project dependencies.</p> <p>add Polars dependencies</p> <pre><code>uv add polars polars_talib\n</code></pre> <p>if you are not familiar with Polars, you can refer to the Polars official documentation to learn how to use it.</p> <p>polars_talib is a Polars extension package that provides the complete functionality of the ta-lib library in the polars expression version, allowing us to easily calculate technical indicators using Polars. It is developed by the shioaji author, and detailed usage can be found in polars_ta_extension.</p> <p>Polars is an efficient DataFrame package that is suitable for processing large amounts of data and can use multiple cores without any additional configuration. In this example, we can see how to use the Shioaji quote manager to obtain quote data, and use Polars for parallel computation, while converting the ticks of the commodity into K lines, and performing parallel multi-commodity technical indicator calculations.</p> <p>add quote.py</p> <p>add <code>quote.py</code> file in <code>src/sj_trading/</code>, and add the following code</p> <pre><code>import shioaji as sj\nfrom typing import List\n\nclass QuoteManager:\n    def __init__(self, api: sj.Shioaji):\n        self.api = api\n        self.api.quote.set_on_tick_stk_v1_callback(self.on_stk_v1_tick_handler)\n        self.api.quote.set_on_tick_fop_v1_callback(self.on_fop_v1_tick_handler)\n        self.ticks_stk_v1: List[sj.TickSTKv1] = []\n        self.ticks_fop_v1: List[sj.TickFOPv1] = []\n\n    def on_stk_v1_tick_handler(self, _exchange: sj.Exchange, tick: sj.TickSTKv1):\n        self.ticks_stk_v1.append(tick)\n\n    def on_fop_v1_tick_handler(self, _exchange: sj.Exchange, tick: sj.TickFOPv1):\n        self.ticks_fop_v1.append(tick)\n</code></pre> <p>this part is relatively simple, let the handle func of receiving the quote data do as little as possible, we define a <code>QuoteManager</code> class, and register two callback functions in the initialization, respectively <code>on_stk_v1_tick_handler</code> and <code>on_fop_v1_tick_handler</code>, these two functions will be called when receiving the quote data, and the quote data will be stored in <code>ticks_stk_v1</code> and <code>ticks_fop_v1</code>.</p> <p>add <code>QuoteManager</code> subscribe and unsubscribe methods</p> <pre><code>def __init__(self, api: sj.Shioaji):\n    # skip\n    self.subscribed_stk_tick: Set[str] = set()\n\ndef subscribe_stk_tick(self, codes: List[str], recover: bool = False):\n    for code in codes:\n        contract = self.api.Contracts.Stocks[code]\n        if contract is not None and code not in self.subscribed_stk_tick:\n            self.api.quote.subscribe(contract, \"tick\")\n            self.subscribed_stk_tick.add(code)\n\ndef unsubscribe_stk_tick(self, codes: List[str]):\n    for code in codes:\n        contract = self.api.Contracts.Stocks[code]\n        if contract is not None and code in self.subscribed_stk_tick:\n            self.api.quote.unsubscribe(contract, \"tick\")\n            self.subscribed_stk_tick.remove(code)\n\ndef unsubscribe_all_stk_tick(self):\n    for code in self.subscribed_stk_tick:\n        contract = self.api.Contracts.Stocks[code]\n        if contract is not None:\n            self.api.quote.unsubscribe(contract, \"tick\")\n    self.subscribed_stk_tick.clear()\n</code></pre> <p>in the above code, we have added the <code>subscribe_stk_tick</code> method, this method will add the commodity codes in the incoming commodity code list to the <code>subscribed_stk_tick</code>, and call the <code>subscribe</code> method of Shioaji to subscribe to the market, <code>subscribed_stk_tick</code> is a <code>Set</code>, used to store the commodity codes that have been subscribed to avoid duplicate subscriptions and facilitate subsequent unsubscribing all subscribed commodities.</p> <p>add <code>QuoteManager</code> get ticks method</p> <pre><code>def __init__(self, api: sj.Shioaji):\n    # skip\n    self.df_stk: pl.DataFrame = pl.DataFrame(\n        [],\n        schema=[\n            (\"datetime\", pl.Datetime),\n            (\"code\", pl.Utf8),\n            (\"price\", pl.Float64),\n            (\"volume\", pl.Int64),\n            (\"tick_type\", pl.Int8),\n        ],\n    )\n\ndef get_df_stk(self) -&gt; pl.DataFrame:\n    poped_ticks, self.ticks_stk_v1 = self.ticks_stk_v1, []\n    if poped_ticks:\n        df = pl.DataFrame([tick.to_dict() for tick in poped_ticks]).select(\n            pl.col(\"datetime\", \"code\"),\n            pl.col(\"close\").cast(pl.Float64).alias(\"price\"),\n            pl.col(\"volume\").cast(pl.Int64),\n            pl.col(\"tick_type\").cast(pl.Int8),\n        )\n        self.df_stk = self.df_stk.vstack(df)\n    return self.df_stk\n</code></pre> <p>in <code>__init__</code> we define a <code>df_stk</code> Polars DataFrame, used to store all subscribed stock tick data, <code>get_df_stk</code> method will convert the <code>ticks_stk_v1</code> list to a Polars DataFrame, and return it, at this point, we have already got a DataFrame that can be used to calculate technical indicators.</p> <p> </p> <p>add <code>QuoteManager</code> get kbar method</p> <pre><code>def get_df_stk_kbar(\n    self, unit: str = \"1m\", exprs: List[pl.Expr] = []\n) -&gt; pl.DataFrame:\n    df = self.get_df_stk()\n    df = df.group_by(\n        pl.col(\"datetime\").dt.truncate(unit),\n        pl.col(\"code\"),\n        maintain_order=True,\n    ).agg(\n        pl.col(\"price\").first().alias(\"open\"),\n        pl.col(\"price\").max().alias(\"high\"),\n        pl.col(\"price\").min().alias(\"low\"),\n        pl.col(\"price\").last().alias(\"close\"),\n        pl.col(\"volume\").sum().alias(\"volume\"),\n    )\n    if exprs:\n        df = df.with_columns(exprs)\n    return df\n</code></pre> <p>in <code>get_df_stk_kbar</code> method, we will use <code>get_df_stk</code> method to get the Ticks DataFrame and then group the data by truncated <code>datetime</code> and <code>code</code>, and then aggregate the data in each group to get the K line data, finally, we will return the K line DataFrame. Here we remain the <code>exprs</code> parameter, allowing users to pass in additional expressions for more calculations.</p> <p>In this part, we use <code>1m</code> to represent 1 minute, if you want to get 5 minutes K line, you can change the unit to <code>5m</code>, 1 hour K line can be changed to <code>1h</code>, if you want more different units, you can refer to the  truncate API documentation.</p> <p>add custom technical indicator calculation method</p> <pre><code>import polars as pl\nimport polars_talib as plta\n\nquote_manager.get_df_stk_kbar(\"5m\", [\n    pl.col(\"close\").ta.ema(5).over(\"code\").fill_nan(None).alias(\"ema5\"),\n    plta.macd(pl.col(\"close\"), 12, 26, 9).over(\"code\").struct.field(\"macd\").fill_nan(None),\n])\n</code></pre> <p>in this part, we use polars_ta to calculate technical indicators and add them to the K line data, here we calculate <code>ema</code> and <code>macd</code> two indicators, more indicators can refer to polars_ta_extension supported indicators list.</p> <p>in this polars_ta expression, we use <code>over(\"code\")</code> to group the data by commodity code for independent calculation of each commodity, so even if all commodities are in the same DataFrame, the calculation results are independent of each other, and this <code>over</code> partition is automatically parallel computing, so even if there are a large number of commodities, the calculation can be very fast and then using <code>alias</code> to set the field name of the calculation result as <code>ema5</code>, in the <code>macd</code> indicator, the return is a struct with multiple fields, and this part gets the <code>macd</code> field.</p> <p>because this part only passes in expressions and is very lightweight, you can pass in any expressions you need according to your needs, and you can also make your own indicators using polars expression, this part just provides an interface for calculation and a simple usage example.</p> <p>add <code>QuoteManager</code> backfill missed ticks method</p> <pre><code>def fetch_ticks(self, contract: BaseContract) -&gt; pl.DataFrame:\n    code = contract.code\n    ticks = self.api.ticks(contract)\n    df = pl.DataFrame(ticks.dict()).select(\n        pl.from_epoch(\"ts\", time_unit=\"ns\").dt.cast_time_unit(\"us\").alias(\"datetime\"),\n        pl.lit(code).alias(\"code\"),\n        pl.col(\"close\").alias(\"price\"),\n        pl.col(\"volume\").cast(pl.Int64),\n        pl.col(\"tick_type\").cast(pl.Int8),\n    )\n    return df\n\ndef subscribe_stk_tick(self, codes: List[str], recover: bool = False):\n    for code in codes:\n        # skop\n        if recover:\n            df = self.fetch_ticks(contract)\n            if not df.is_empty():\n                code_ticks = [t for t in self.ticks_stk_v1 if t.code == code]\n                if code_ticks:\n                    t_first = code_ticks[0].datetime\n                    df = df.filter(pl.col(\"datetime\") &lt; t_first)\n                    self.df_stk = self.df_stk.vstack(df)\n                else:\n                    self.df_stk = self.df_stk.vstack(df)\n</code></pre> <p>in <code>subscribe_stk_tick</code> method, we will check if the <code>recover</code> parameter is true, if it is, we will call <code>fetch_ticks</code> method to get the historical ticks data, and then use <code>filter</code> method to filter out the ticks data that have been received, and use <code>vstack</code> method to add the historical ticks data to the <code>df_stk</code> DataFrame.</p> <p>In above we have completed a quote manager that can subscribe to market data, backfill missed ticks, and calculate technical indicators. Next, we will integrate all the code and use it in a jupyter lab environment.</p> <p>The complete QuoteManager can be found in quote.py.</p> <p>The complete example jupyter notebook can be found in quote_manager_usage.</p>"},{"location":"tutor/advanced/touchorder/","title":"Touch Price Order","text":""},{"location":"tutor/advanced/touchorder/#touch-price-order","title":"Touch Price Order","text":"<p>Here is a simple example that how to build your price monitor and when price touches the condition will place the order.</p> <pre><code>from pydantic import BaseModel\n\nclass TouchOrderCond(BaseModel):\n    contract: Contract\n    order: Order\n    order: Order\n    touch_price: float\n\nclass TouchOrder:\n   def __init__(self, api: sj.Shioaji, condition: TouchOrderCond\n    ):\n       self.flag = False\n       self.api = api\n       self.order = condition.order\n       self.contract = condition.contract\n       self.touch_price = condition.touch_price\n       self.api.quote.subscribe(self.contract)\n       self.api.quote.set_quote_callback(self.touch)\n\n   def touch(self, topic, quote):\n       price = quote[\"Close\"][0]\n       if price == self.touch_price and not self.flag:\n           self.flag = True\n           self.api.place_order(self.contract, self.order)\n           self.api.quote.unsubscribe(self.contract)\n</code></pre> <p>Complete TouchPrice Order Extention can be found here.</p>"},{"location":"tutor/callback/event_cb/","title":"Event Callback","text":"<p>In this api, we use solace as mesh broker. This event mean the status for your client with solace connection situation. If you have no experience with networking, please skip this part, In defalut, we help you reconnect solace broker 50 times without any setting. Best way is keep your network connection alive.</p> <p>In</p> <pre><code>@api.quote.on_event\ndef event_callback(resp_code: int, event_code: int, info: str, event: str):\n    print(f'Event code: {event_code} | Event: {event}')\n</code></pre> <p>Out</p> <pre><code>Event code: 16 | Event: Subscribe or Unsubscribe ok\n</code></pre> <p>Like the quote callback, your can also set event cllback with two way.</p> <p>In</p> <pre><code>api.quote.set_event_callback?\n</code></pre> <p>Out</p> <pre><code>Signature: api.quote.set_event_callback(func:Callable[[int, int, str, str], NoneType]) -&gt; None\nDocstring: &lt;no docstring&gt;\nType:      method\n</code></pre>"},{"location":"tutor/callback/event_cb/#event-code","title":"Event Code","text":"Event Code Event Code Enumerator Description 0 SOLCLIENT_SESSION_EVENT_UP_NOTICE The Session is established. 1 SOLCLIENT_SESSION_EVENT_DOWN_ERROR The Session was established and then went down. 2 SOLCLIENT_SESSION_EVENT_CONNECT_FAILED_ERROR The Session attempted to connect but was unsuccessful. 3 SOLCLIENT_SESSION_EVENT_REJECTED_MSG_ERROR The appliance rejected a published message. 4 SOLCLIENT_SESSION_EVENT_SUBSCRIPTION_ERROR The appliance rejected a subscription (add or remove). 5 SOLCLIENT_SESSION_EVENT_RX_MSG_TOO_BIG_ERROR The API discarded a received message that exceeded the Session buffer size. 6 SOLCLIENT_SESSION_EVENT_ACKNOWLEDGEMENT The oldest transmitted Persistent/Non-Persistent message that has been acknowledged. 7 SOLCLIENT_SESSION_EVENT_ASSURED_PUBLISHING_UP Deprecated -- see notes in solClient_session_startAssuredPublishing.The AD Handshake (that is, Guaranteed Delivery handshake) has completed for the publisher and Guaranteed messages can be sent. 8 SOLCLIENT_SESSION_EVENT_ASSURED_CONNECT_FAILED Deprecated -- see notes in solClient_session_startAssuredPublishing.The appliance rejected the AD Handshake to start Guaranteed publishing. Use SOLCLIENT_SESSION_EVENT_ASSURED_DELIVERY_DOWN instead. 8 SOLCLIENT_SESSION_EVENT_ASSURED_DELIVERY_DOWN Guaranteed Delivery publishing is not available.The guaranteed delivery capability on the session has been disabled by some action on the appliance. 9 SOLCLIENT_SESSION_EVENT_TE_UNSUBSCRIBE_ERROR The Topic Endpoint unsubscribe command failed. 9 SOLCLIENT_SESSION_EVENT_DTE_UNSUBSCRIBE_ERROR Deprecated name; SOLCLIENT_SESSION_EVENT_TE_UNSUBSCRIBE_ERROR is preferred. 10 SOLCLIENT_SESSION_EVENT_TE_UNSUBSCRIBE_OK The Topic Endpoint unsubscribe completed. 10 SOLCLIENT_SESSION_EVENT_DTE_UNSUBSCRIBE_OK Deprecated name; SOLCLIENT_SESSION_EVENT_TE_UNSUBSCRIBE_OK is preferred. 11 SOLCLIENT_SESSION_EVENT_CAN_SEND The send is no longer blocked. 12 SOLCLIENT_SESSION_EVENT_RECONNECTING_NOTICE The Session has gone down, and an automatic reconnect attempt is in progress. 13 SOLCLIENT_SESSION_EVENT_RECONNECTED_NOTICE The automatic reconnect of the Session was successful, and the Session was established again. 14 SOLCLIENT_SESSION_EVENT_PROVISION_ERROR The endpoint create/delete command failed. 15 SOLCLIENT_SESSION_EVENT_PROVISION_OK The endpoint create/delete command completed. 16 SOLCLIENT_SESSION_EVENT_SUBSCRIPTION_OK The subscribe or unsubscribe operation has succeeded. 17 SOLCLIENT_SESSION_EVENT_VIRTUAL_ROUTER_NAME_CHANGED The appliance's Virtual Router Name changed during a reconnect operation.This could render existing queues or temporary topics invalid. 18 SOLCLIENT_SESSION_EVENT_MODIFYPROP_OK The session property modification completed. 19 SOLCLIENT_SESSION_EVENT_MODIFYPROP_FAIL The session property modification failed. 20 SOLCLIENT_SESSION_EVENT_REPUBLISH_UNACKED_MESSAGES After successfully reconnecting a disconnected session, the SDK received an unknown publisher flow name response when reconnecting the GD publisher flow."},{"location":"tutor/callback/orderdeal_event/","title":"Order Event","text":"<p>Each time you <code>place_order</code>, <code>update_order</code> or <code>cancel_order</code>, by default, you will recieve an order event (or deal event) from exchange. If you don't want recieve both events, please refer to Subscribe Trade. We also provide interface to handle order and deal events. It's extremely helpful if you are implementing your custom trading system.</p>"},{"location":"tutor/callback/orderdeal_event/#handle-order-callback","title":"Handle Order Callback","text":"<p>You can use <code>set_order_callback</code> to handle order/deal events. The example below shows custom order callback function (<code>order_cb</code>), which will print <code>my_order_callback</code> first and then print the order/deal event. </p> <p>Set Order Callback</p> <pre><code>def order_cb(stat, msg):\n    print('my_order_callback')\n    print(stat, msg)\n\napi.set_order_callback(order_cb)\n</code></pre> <p>Place Order</p> version&gt;=1.0version&lt;1.0 <pre><code>contract = api.Contracts.Stocks.TSE.TSE2890\norder = api.Order(\n    price=16, \n    quantity=1, \n    action=sj.constant.Action.Buy, \n    price_type=sj.constant.StockPriceType.LMT, \n    order_type=sj.constant.OrderType.ROD, \n    order_lot=sj.constant.StockOrderLot.Common, \n    custom_field=\"test\",\n    account=api.stock_account\n)\ntrade = api.place_order(contract, order)\n</code></pre> <pre><code>contract = api.Contracts.Stocks.TSE.TSE2890\norder = api.Order(\n    price=16, \n    quantity=1, \n    action=sj.constant.Action.Buy, \n    price_type=sj.constant.TFTStockPriceType.LMT, \n    order_type=sj.constant.TFTOrderType.ROD, \n    order_lot=sj.constant.TFTStockOrderLot.Common, \n    custom_field=\"test\",\n    account=api.stock_account\n)\ntrade = api.place_order(contract, order)\n</code></pre>"},{"location":"tutor/callback/orderdeal_event/#order-event","title":"Order Event","text":"<p>Order Event</p> version&gt;=1.0version&lt;1.0 <pre><code>my_order_callback\nOrderState.StockOrder {\n    'operation': {\n        'op_type': 'New', \n        'op_code': '00', \n        'op_msg': ''\n    }, \n    'order': {\n        'id': '97b63e2f', \n        'seqno': '267677', \n        'ordno': 'IM394', \n        'account': {\n            'account_type': 'S', \n            'person_id': '', \n            'broker_id': '9A95', \n            'account_id': '1234567', \n            'signed': True\n        }, \n        'action': 'Buy', \n        'price': 16.0, \n        'quantity': 1, \n        'order_type': 'ROD', \n        'price_type': 'LMT', \n        'order_cond': 'Cash', \n        'order_lot': 'Common', \n        'custom_field': 'test'\n    }, \n    'status': {\n        'id': '97b63e2f', \n        'exchange_ts': 1673576134.038, \n        'modified_price': 0.0, \n        'cancel_quantity': 0, \n        'order_quantity': 1, \n        'web_id': '137'\n    }, \n    'contract': {\n        'security_type': 'STK', \n        'exchange': 'TSE', \n        'code': '2890', \n        'symbol': '', \n        'name': '', \n        'currency': 'TWD'\n    }\n}\n</code></pre> <pre><code>my_order_callback\nOrderState.TFTOrder {\n    'operation': {\n        'op_type': 'New', \n        'op_code': '00', \n        'op_msg': ''\n    }, \n    'order': {\n        'id': '97b63e2f', \n        'seqno': '267677', \n        'ordno': 'IM394', \n        'account': {\n            'account_type': 'S', \n            'person_id': '', \n            'broker_id': '9A95', \n            'account_id': '1234567', \n            'signed': True\n        }, \n        'action': 'Buy', \n        'price': 16.0, \n        'quantity': 1, \n        'order_type': 'ROD', \n        'price_type': 'LMT', \n        'order_cond': 'Cash', \n        'order_lot': 'Common', \n        'custom_field': 'test'\n    }, \n    'status': {\n        'id': '97b63e2f', \n        'exchange_ts': 1673576134.038, \n        'modified_price': 0.0, \n        'cancel_quantity': 0, \n        'order_quantity': 1, \n        'web_id': '137'\n    }, \n    'contract': {\n        'security_type': 'STK', \n        'exchange': 'TSE', \n        'code': '2890', \n        'symbol': '', \n        'name': '', \n        'currency': 'TWD'\n    }\n}\n</code></pre>"},{"location":"tutor/callback/orderdeal_event/#deal-event","title":"Deal Event","text":"<p>Deal Event</p> version&gt;=1.0version&lt;1.0 <pre><code>my_order_callback\nOrderState.StockDeal {\n    'trade_id': '9c6ae2eb', \n    'seqno': '269866', \n    'ordno': 'IN497', \n    'exchange_seq': '669915', \n    'broker_id': '9A95', \n    'account_id': '1234567', \n    'action': 'Buy', \n    'code': '2890', \n    'order_cond': 'Cash', \n    'order_lot': 'IntradayOdd', \n    'price': 267.5, \n    'quantity': 3, \n    'web_id': '137', \n    'custom_field': 'test', \n    'ts': 1673577256.354\n}\n</code></pre> <pre><code>my_order_callback\nOrderState.TFTDeal {\n    'trade_id': '9c6ae2eb', \n    'seqno': '269866', \n    'ordno': 'IN497', \n    'exchange_seq': '669915', \n    'broker_id': '9A95', \n    'account_id': '1234567', \n    'action': 'Buy', \n    'code': '2890', \n    'order_cond': 'Cash', \n    'order_lot': 'IntradayOdd', \n    'price': 267.5, \n    'quantity': 3, \n    'web_id': '137', \n    'custom_field': 'test', \n    'ts': 1673577256.354\n}\n</code></pre>"},{"location":"tutor/market_data/credit_enquires/","title":"Credit Enquires","text":"<p>Credit Enquires</p> <pre><code>&gt;&gt; api.credit_enquires?\n\nSignature:\napi.credit_enquires(\n    contracts: List[shioaji.contracts.Stock],\n    timeout: int = 30000,\n    cb: Callable[[shioaji.data.CreditEnquire], NoneType] = None,\n) -&gt; List[shioaji.data.CreditEnquire]\n</code></pre>"},{"location":"tutor/market_data/credit_enquires/#example","title":"Example","text":"<p>In</p> <pre><code>contracts = [\n    api.Contracts.Stocks['2330'],\n    api.Contracts.Stocks['2890']\n]\ncredit_enquires = api.credit_enquires(contracts)\ncredit_enquires\n</code></pre> <p>Out</p> <pre><code>[\n    CreditEnquire(update_time='2020-12-11 13:30:13', system='HE', stock_id='2330', margin_unit=1381), \n    CreditEnquire(update_time='2020-12-11 13:30:02', system='HC', stock_id='2330', margin_unit=1371), \n    CreditEnquire(update_time='2020-12-11 13:30:05', system='HN', stock_id='2330', margin_unit=1357), \n    CreditEnquire(update_time='2020-12-11 13:30:03', system='HF', stock_id='2330', margin_unit=1314), \n    CreditEnquire(update_time='2020-12-09 10:56:05', system='HE', stock_id='2890'), \n    CreditEnquire(update_time='2020-12-11 09:33:04', system='HN', stock_id='2890'), \n    CreditEnquire(update_time='2020-12-02 09:01:03', system='HF', stock_id='2890')\n]\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>df = pd.DataFrame(c.__dict__ for c in credit_enquires)\ndf.update_time = pd.to_datetime(df.update_time)\ndf\n</code></pre> <p>Out</p> margin_unit short_unit stock_id system update_time 0 1381 0 2330 HE 2020-12-11 13:30:13 1 1371 0 2330 HC 2020-12-11 13:30:02 2 1357 0 2330 HN 2020-12-11 14:31:19 3 1314 0 2330 HF 2020-12-11 14:31:19 4 0 0 2890 HE 2020-12-09 10:56:05 5 0 0 2890 HN 2020-12-11 09:33:04 6 0 0 2890 HF 2020-12-02 09:01:03"},{"location":"tutor/market_data/credit_enquires/#attributes","title":"Attributes","text":"<p>CreditEnquire</p> <pre><code>update_time (str): update time\nsystem (str): system\nstock_id (str): stock id\nmargin_unit (int): margin unit\nshort_unit (int): short unit\n</code></pre>"},{"location":"tutor/market_data/historical/","title":"Historical Market Data","text":""},{"location":"tutor/market_data/historical/#ticks","title":"Ticks","text":"<p>Ticks can get all day, period of time or last counts of the day. The default is get ticks of last trade day . </p> <p>Ticks</p> <pre><code>api.ticks?\n\nSignature:\n    api.ticks(\n        contract: shioaji.contracts.BaseContract,\n        date: str = '2022-12-26',\n        query_type: shioaji.constant.TicksQueryType = &lt;TicksQueryType.AllDay: 'AllDay'&gt;,\n        time_start: Union[str, datetime.time] = None,\n        time_end: Union[str, datetime.time] = None,\n        last_cnt: int = 0,\n        timeout: int = 30000,\n        cb: Callable[[shioaji.data.Ticks], NoneType] = None,\n    ) -&gt; shioaji.data.Ticks\nDocstring:\n    get contract tick volumn\n</code></pre>"},{"location":"tutor/market_data/historical/#by-date","title":"By Date","text":"<p>In</p> <pre><code>ticks = api.ticks(\n    contract=api.Contracts.Stocks[\"2330\"], \n    date=\"2023-01-16\"\n)\nticks\n</code></pre> <p>Out</p> <pre><code>Ticks(\n    ts=[1673859600113699000, 1673859600228800000, 1673859600244294000, 1673859600308595000], \n    close=[506.0, 505.0, 506.0, 506.0],\n    volume=[3340, 1, 17, 2],\n    bid_price=[505.0, 505.0, 506.0, 506.0],\n    bid_volume=[122, 320, 60, 58],\n    ask_price=[506.0, 506.0, 507.0, 507.0],\n    ask_volume=[13, 22, 702, 702]\n    tick_type=[1, 2, 1, 2]\n)\n</code></pre> <p>Ticks</p> <pre><code>ts (int): timestamp\nclose (float): close\nvolume (int): volume\nbid_price (float): bid price\nbid_volume (int): bid volume\nask_price (float): ask price\nask_volume (int): ask volume\ntick_type (int): \u5167\u5916\u76e4\u5225{1: \u5916\u76e4, 2: \u5167\u76e4, 0: \u7121\u6cd5\u5224\u5b9a}\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>import pandas as pd\ndf = pd.DataFrame({**ticks})\ndf.ts = pd.to_datetime(df.ts)\ndf.head()\n</code></pre> <p>Out</p> ts ask_price close bid_volume volume ask_volume tick_type bid_price 2023-01-16 09:00:00.113699 506 506 122 3340 13 1 505 2023-01-16 09:00:00.228800 506 505 320 1 22 2 505 2023-01-16 09:00:00.244294 507 506 60 17 702 1 506 2023-01-16 09:00:00.308595 507 506 58 2 702 2 506"},{"location":"tutor/market_data/historical/#range-time","title":"Range Time","text":"<p>In</p> <pre><code>ticks = api.ticks(\n    contract=api.Contracts.Stocks[\"2330\"], \n    date=\"2023-01-16\",\n    query_type=sj.constant.TicksQueryType.RangeTime,\n    time_start=\"09:00:00\",\n    time_end=\"09:20:01\"\n)\nticks\n</code></pre> <p>Out</p> <pre><code>Ticks(\n    ts=[1673859600113699000, 1673859600228800000, 1673859600244294000, 1673859600308595000], \n    close=[506.0, 505.0, 506.0, 506.0],\n    volume=[3340, 1, 17, 2],\n    bid_price=[505.0, 505.0, 506.0, 506.0],\n    bid_volume=[122, 320, 60, 58],\n    ask_price=[506.0, 506.0, 507.0, 507.0],\n    ask_volume=[13, 22, 702, 702]\n    tick_type=[1, 2, 1, 2]\n)\n</code></pre>"},{"location":"tutor/market_data/historical/#last-count","title":"Last Count","text":"<p>In</p> <pre><code>ticks = api.ticks(\n    contract=api.Contracts.Stocks[\"2330\"], \n    date=\"2023-01-16\",\n    query_type=sj.constant.TicksQueryType.LastCount,\n    last_cnt=4,\n)\nticks\n</code></pre> <p>Out</p> <pre><code>Ticks(\n    ts=[1673859600113699000, 1673859600228800000, 1673859600244294000, 1673859600308595000], \n    close=[506.0, 505.0, 506.0, 506.0],\n    volume=[3340, 1, 17, 2],\n    bid_price=[505.0, 505.0, 506.0, 506.0],\n    bid_volume=[122, 320, 60, 58],\n    ask_price=[506.0, 506.0, 507.0, 507.0],\n    ask_volume=[13, 22, 702, 702]\n    tick_type=[1, 2, 1, 2]\n)\n</code></pre>"},{"location":"tutor/market_data/historical/#kbar","title":"KBar","text":"<p>Kbars</p> <pre><code>api.kbars?\n\nSignature:\napi.kbars(\n    contract: shioaji.contracts.BaseContract,\n    start: str = '2023-01-15',\n    end: str = '2023-01-16',\n    timeout: int = 30000,\n    cb: Callable[[shioaji.data.Kbars], NoneType] = None,\n) -&gt; shioaji.data.Kbars\nDocstring:\nget Kbar\n</code></pre> <p>In</p> <pre><code>kbars = api.kbars(\n    contract=api.Contracts.Stocks[\"2330\"], \n    start=\"2023-01-15\", \n    end=\"2023-01-16\", \n)\nkbars\n</code></pre> <p>Out</p> <pre><code>Kbars(\n    ts=[1673859660000000000, 1673859720000000000, 1673859780000000000, 1673859840000000000],\n    Open=[506.0, 505.0, 505.0, 504.0],\n    High=[508.0, 506.0, 506.0, 505.0],\n    Low=[505.0, 505.0, 504.0, 504.0],\n    Close=[505.0, 505.0, 504.0, 504.0],\n    Volume=[5308, 1018, 543, 209]\n)\n</code></pre> <p>Kbars</p> <pre><code>ts (int): timestamp\nOpen (float): open price\nHigh (float): the highest price\nLow: (float): the lowest price\nClose (float): close price\nVolume (int): volume\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>import pandas as pd\ndf = pd.DataFrame({**kbars})\ndf.ts = pd.to_datetime(df.ts)\ndf.head()\n</code></pre> <p>Out</p> Close Amount Low Volume ts Open High 505 2.68731e+09 505 5308 2023-01-16 09:01:00 506 508 505 5.14132e+08 505 1018 2023-01-16 09:02:00 505 506 504 2.74112e+08 504 543 2023-01-16 09:03:00 505 506 504 1.0542e+08 504 209 2023-01-16 09:04:00 504 505"},{"location":"tutor/market_data/historical/#historical-periods","title":"Historical Periods","text":"<p>Historical Periods</p> Start Date End Date Index 2020-03-02 Today Stock 2020-03-02 Today Futures 2020-03-22 Today"},{"location":"tutor/market_data/historical/#continuous-futures","title":"Continuous Futures","text":"<p>Once a futures contract passes its expiration date, the contract is invalid, and it will not exist in your <code>api.Contracts</code>.  In order to get historical data for expired futures contract, we provide continuous futures contracts. <code>R1</code>, <code>R2</code> are continuous near-month and next-to-near-month futures contracts respectively. They will automatically roll contracts on delivery date. You can get historical data by using <code>R1</code>, <code>R2</code> contracts, ex <code>api.Contracts.Futures.TXF.TXFR1</code>. We show examples below.</p> <p>Ticks </p> <p>Ticks</p> <pre><code>ticks = api.ticks(\n    contract=api.Contracts.Futures.TXF.TXFR1, \n    date=\"2020-03-22\"\n)\nticks\n</code></pre> <p>Out</p> <pre><code>Ticks(\n    ts=[1616166000030000000, 1616166000140000000, 1616166000140000000, 1616166000190000000], \n    close=[16011.0, 16013.0, 16014.0, 16011.0],\n    volume=[49, 2, 2, 1],\n    bid_price=[0.0, 16011.0, 16011.0, 16011.0],\n    bid_volume=[0, 1, 1, 1],\n    ask_price=[0.0, 16013.0, 16013.0, 16013.0],\n    ask_volume=[0, 1, 1, 1]\n    tick_type=[1, 1, 1, 2]\n)\n</code></pre> <p>Kbars </p> <p>Kbars</p> <pre><code>kbars = api.kbars(\n    contract=api.Contracts.Futures.TXF.TXFR1,\n    start=\"2023-01-15\", \n    end=\"2023-01-16\", \n)\nkbars\n</code></pre> <p>Out</p> <pre><code>Kbars(\n    ts=[1616402760000000000, 1616402820000000000, 1616402880000000000, 1616402940000000000],\n    Open=[16018.0, 16018.0, 16000.0, 15992.0],\n    High=[16022.0, 16020.0, 16005.0, 15999.0],\n    Low=[16004.0, 16000.0, 15975.0, 15989.0],\n    Close=[16019.0, 16002.0, 15992.0, 15994.0],\n    Volume=[1791, 864, 1183, 342]\n)\n</code></pre>"},{"location":"tutor/market_data/scanners/","title":"Scanners","text":"<p>Scanners can use parameter of scannertype to get the rank of ChangePercent, ChangePrice, DayRange, Volume and Amount. </p> <p>Scanners</p> <pre><code>&gt;&gt; api.scanners?\n\nSignature:\napi.scanners(\n    scanner_type: shioaji.constant.ScannerType, \n    ascending: bool = True,\n    date: str = None,\n    count: shioaji.shioaji.ConstrainedIntValue = 100, # 0 &lt;= count &lt;= 200\n    timeout: int = 30000,\n    cb: Callable[[List[shioaji.data.ChangePercentRank]], NoneType] = None,\n) -&gt; List[shioaji.data.ChangePercentRank]\n</code></pre> <p>Ascending is sorted from largest to smallest by default, and the value of ascending is True. Set ascending to False to sort in descending order, and the other ranking methods are the same. <code>count</code> is how many ranks you get.</p> <p>Supported Scanner Type</p> <pre><code>ChangePercentRank: rank by price percentage change\nChangePriceRank: rank by price change\nDayRangeRank: rank by day range\nVolumeRank: rank by volume\nAmountRank: rank by amount\n</code></pre>"},{"location":"tutor/market_data/scanners/#example","title":"Example","text":"<p>ChangePercentRank</p> <pre><code>scanners = api.scanners(\n    scanner_type=sj.constant.ScannerType.ChangePercentRank,\n    count=1\n)\nscanners\n</code></pre> <p>Out</p> <pre><code>[\n    ChangePercentRank(\n        date='2021-04-09', \n        code='5211', \n        name='\u8499\u606c', \n        ts=1617978600000000000, \n        open=16.4, \n        high=17.6, \n        low=16.35, \n        close=17.6, \n        price_range=1.25, \n        tick_type=1, \n        change_price=1.6, \n        change_type=1, \n        average_price=17.45, \n        volume=7, \n        total_volume=1742, \n        amount=123200, \n        total_amount=30397496, \n        yesterday_volume=514, \n        volume_ratio=3.39, \n        buy_price=17.6, \n        buy_volume=723, \n        sell_price=0.0, \n        sell_volume=0, \n        bid_orders=237, \n        bid_volumes=82, \n        ask_orders=33, \n        ask_volumes=64\n    )\n]\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>scanners = api.scanners(\n    scanner_type=sj.constant.ScannerType.ChangePercentRank, \n    count=5\n)\ndf = pd.DataFrame(s.__dict__ for s in scanners)\ndf.ts = pd.to_datetime(df.ts)\ndf\n</code></pre> <p>Out</p> date code name ts open high low close price_range tick_type change_price change_type average_price volume total_volume amount total_amount yesterday_volume volume_ratio buy_price buy_volume sell_price sell_volume bid_orders bid_volumes ask_orders ask_volumes 2023-01-17 6259 \u767e\u5fbd 2023-01-17 11:11:41.030000 22.8 23.75 22.45 23.75 1.3 1 2.15 1 23.58 4 137 95000 3230900 26 5.27 0 8 0 0 65 211 5 11 2023-01-17 6788 \u83ef\u666f\u96fb 2023-01-17 11:19:01.924000 107 116 107 116 9 1 10.5 1 113.61 1 4292 116000 487606000 682 6.29 0 1053 0 0 1044 3786 501 1579 2023-01-17 2540 \u611b\u5c71\u6797 2023-01-17 11:17:39.435000 85.2 85.2 83 85.2 2.2 1 7.7 1 85.04 1 1226 85200 104253800 702 1.75 0 142 0 0 362 5779 121 1831 2023-01-17 8478 \u6771\u54e5\u904a\u8247 2023-01-17 11:18:33.702000 350.5 378 347 378 31 1 34 1 363.39 1 12115 378000 4402427500 8639 1.4 0 3307 0 0 3754 235724 1906 29843 2023-01-17 6612 \u5948\u7c73\u91ab\u6750 2023-01-17 11:15:32.752000 102 109 102 109 7 1 9.7 1 106.95 1 1329 109000 142134500 1022 1.3 0 298 0 0 467 22718 162 1016"},{"location":"tutor/market_data/scanners/#attributes","title":"Attributes","text":"<p>ChangePercentRank</p> <pre><code>date (str): date \ncode (str): code\nname (str): name\nts (int): timestamp\nopen (float): open price\nhigh (float): high price\nlow (float): low price\nclose (float): close price\nprice_range (float): range of price\ntick_type (int): \u5167\u5916\u76e4\u5225{1: \u5916\u76e4, 2: \u5167\u76e4, 0: \u7121\u6cd5\u5224\u5b9a}\nchange_price (float): change in price\nchange_type (int): \n    {LimitUp, Up, Unchanged, Down, LimitDown}\naverage_price (float): average price\nvolume (int): volume\ntotal_volume (int): total volume since market open\namount (int): amount\ntotal_amount (int): total amount since market open\nyesterday_volume (int): yesterday volume\nvolume_ratio (float): total_volume/yestoday_volume\nbuy_price (float): bid\nbuy_volume (int): bid volume\nsell_price (float): ask\nsell_volume (int): ask volume\nbid_orders (int): number of orders that deal at bid\nbid_volumes (int): total volume that deal at bid\nask_orders (int): number of orders that deal at ask\nask_volumes (int): total volume that deal at ask\n</code></pre>"},{"location":"tutor/market_data/short_stock_source/","title":"Short Stock Source","text":"<p>Short Stock Sources</p> <pre><code>&gt;&gt; api.short_stock_sources?\n\nSignature:\napi.short_stock_sources(\n    contracts: List[shioaji.contracts.Stock],\n    timeout: int = 5000,\n    cb: Callable[[shioaji.data.ShortStockSource], NoneType] = None,\n) -&gt; List[shioaji.data.ShortStockSource]\n</code></pre>"},{"location":"tutor/market_data/short_stock_source/#example","title":"Example","text":"<p>In</p> <pre><code>contracts = [\n    api.Contracts.Stocks['2330'], \n    api.Contracts.Stocks['2317']\n]\nshort_stock_sources = api.short_stock_sources(contracts)\nshort_stock_sources\n</code></pre> <p>Out</p> <pre><code>[\n    ShortStockSource(code='2330', short_stock_source=58260, ts=1673943433000000000),\n    ShortStockSource(code='2317', short_stock_source=75049, ts=1673943433000000000)\n]\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>df = pd.DataFrame(s.__dict__ for s in short_stock_sources)\ndf.ts = pd.to_datetime(df.ts)\ndf\n</code></pre> <p>Out</p> code short_stock_source ts 2330 58260 2023-01-17 08:17:13 2317 75049 2023-01-17 08:17:13"},{"location":"tutor/market_data/short_stock_source/#attributes","title":"Attributes","text":"<p>ShortStockSource</p> <pre><code>code (str): contract id\nshort_stock_source (float): short stock source\nts (int): timeStamp\n</code></pre>"},{"location":"tutor/market_data/snapshot/","title":"Snapshot","text":"<p>Snapshot is a present stock, future, option info. It contain open, high, low, close, change price, average price, volume, total volume, buy price, buy volume, sell price, sell volume and yesterday volume.</p> <p>Reminder </p> <p>Each snapshot can contain up to 500 contracts.</p> <p>Snapshots</p> <pre><code>&gt;&gt; api.snapshots?\n\nSignature:\napi.snapshots(\n    contracts: List[Union[shioaji.contracts.Option, shioaji.contracts.Future, shioaji.contracts.Stock, shioaji.contracts.Index]],\n    timeout: int = 30000,\n    cb: Callable[[shioaji.data.Snapshot], NoneType] = None,\n) -&gt; List[shioaji.data.Snapshot]\nDocstring:\nget contract snapshot info\n</code></pre>"},{"location":"tutor/market_data/snapshot/#example","title":"Example","text":"<p>In</p> <pre><code>contracts = [\n    api.Contracts.Stocks['2330'], \n    api.Contracts.Stocks['2317']\n]\nsnapshots = api.snapshots(contracts)\nsnapshots\n</code></pre> <p>Out</p> <pre><code>[\n    Snapshot(\n        ts=1673620200000000000, \n        code='2330', \n        exchange='TSE', \n        open=507.0, \n        high=509.0, \n        low=499.0, \n        close=500.0, \n        tick_type=&lt;TickType.Sell: 'Sell'&gt;, \n        change_price=13.5, \n        change_rate=2.77,\n        change_type=&lt;ChangeType.Up: 'Up'&gt;, \n        average_price=502.42, \n        volume=48, \n        total_volume=77606, \n        amount=24000000, \n        total_amount=38990557755, \n        yesterday_volume=20963.0, \n        buy_price=500.0,\n        buy_volume=122.0, \n        sell_price=501.0, \n        sell_volume=1067, \n        volume_ratio=3.7\n    ),\n    Snapshot(\n        ts=1673620200000000000, \n        code='2317', \n        exchange='TSE', \n        open=99.0, \n        high=99.5, \n        low=98.6, \n        close=98.6, \n        tick_type=&lt;TickType.Sell: 'Sell'&gt;, \n        change_price=0.0, \n        change_rate=0.0, \n        change_type=&lt;ChangeType.Unchanged: 'Unchanged'&gt;, \n        average_price=98.96, \n        volume=63, \n        total_volume=17809, \n        amount=6211800, \n        total_amount=1762344817, \n        yesterday_volume=18537.0, \n        buy_price=98.6, \n        buy_volume=607.0, \n        sell_price=98.7, \n        sell_volume=4, \n        volume_ratio=0.96\n    )\n]\n</code></pre> <p>To DataFrame</p> <p>In</p> <pre><code>df = pd.DataFrame(s.__dict__ for s in snapshots)\ndf.ts = pd.to_datetime(df.ts)\ndf\n</code></pre> <p>Out</p> ts code exchange open high low close tick_type change_price change_rate change_type average_price volume total_volume amount total_amount yesterday_volume buy_price buy_volume sell_price sell_volume volume_ratio 2023-01-13 14:30:00 2330 TSE 507 509 499 500 Sell 13.5 2.77 Up 502.42 48 77606 24000000 38990557755 20963 500 122 501 1067 3.7 2023-01-13 14:30:00 2317 TSE 99 99.5 98.6 98.6 Sell 0 0 Unchanged 98.96 63 17809 6211800 1762344817 18537 98.6 607 98.7 4 0.96"},{"location":"tutor/market_data/snapshot/#attributes","title":"Attributes","text":"<p>Snapshot</p> <pre><code>ts (int): TimeStamp\ncode (str): Contract id\nexchange (Exchange): exchange\nopen (float): open\nhigh (float): high\nlow (float): low\nclose (float): close\ntick_type (TickType): Close is buy or sell price\n    {None, Buy, Sell}\nchange_price (float): change price\nchange_rate (float): change rate\nchange_type (ChangeType):\n    {LimitUp, Up, Unchanged, Down, LimitDown}\navgerage_price (float): avgerage of price\nvolume (int): volume\ntotal_volume (int): total volume\namount (int): Deal amount\ntotal_amount (int): Total deal amount\nyestoday_volume (float): Volume of yestoday\nbuy_price (float): Price of buy\nbuy_volume (float): Volume of sell\nsell_price (float): Price of sell\nsell_volume (int): Volume of sell\nvolume_ratio (float): total_volume/yestoday_volume\n</code></pre>"},{"location":"tutor/market_data/streaming/futures/","title":"Futures","text":"<p>To subscribe quotes is very easy, just call <code>subscribe</code> function with contract which we've discussed in previous topic.</p> <p>Subscribe</p> <pre><code>api.quote.subscribe?\n\n    Signature:\n        api.quote.subscribe(\n            contract:shioaji.contracts.Contract,\n            quote_type:shioaji.constant.QuoteType=&lt;QuoteType.Tick: 'tick'&gt;,\n            intraday_odd:bool=False,\n            version: shioaji.constant.QuoteVersion=&lt;QuoteVersion.v0: 'v0'&gt;,\n        )\n    Docstring: &lt;no docstring&gt;\n    Type:      method\n</code></pre> <p>Quote Parameters:</p> <pre><code>quote_type: tick price or bid/ask price to subscribe\n    {'tick', 'bidask'}\nintraday_odd: \u76e4\u4e2d\u96f6\u80a1\n    {True, False}\nversion: version of quote format\n    {'v1', 'v0'}\n</code></pre>"},{"location":"tutor/market_data/streaming/futures/#tick","title":"Tick","text":""},{"location":"tutor/market_data/streaming/futures/#example","title":"Example","text":"<p>In</p> <pre><code>api.quote.subscribe(\n    api.Contracts.Futures.TXF['TXF202107'],\n    quote_type = sj.constant.QuoteType.Tick,\n    version = sj.constant.QuoteVersion.v1,\n)\n</code></pre> <p>Out</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>Response Code: 200 | Event Code: 16 | Info: TIC/v1/FOP/*/TFE/TXFG1 | Event: Subscribe or Unsubscribe ok\n\nExchange.TAIFEX \nTick(\n    code = 'TXFG1', \n    datetime = datetime.datetime(2021, 7, 1, 10, 42, 29, 757000), \n    open = Decimal('17678'), \n    underlying_price = Decimal('17849.57'), \n    bid_side_total_vol= 32210, \n    ask_side_total_vol= 33218, \n    avg_price = Decimal('17704.663999'), \n    close = Decimal('17753'), \n    high = Decimal('17774'), \n    low = Decimal('17655'), \n    amount = Decimal('17753'), \n    total_amount = Decimal('913790823'), \n    volume = 1, \n    total_volume = 51613, \n    tick_type = 0, \n    chg_type = 2, \n    price_chg = Decimal('41'), \n    pct_chg = Decimal('0.231481'), \n    simtrade = 0\n)\n</code></pre> <pre><code>Response Code: 200 | Event Code: 16 | Info: L/*/TXFG1 | Event: Subscribe or Unsubscribe ok\n\nL/TFE/TXFG1 \n{\n    'Amount': [17754.0], \n    'AmountSum': [913027415.0], \n    'AvgPrice': [17704.623134], \n    'Close': [17754.0], \n    'Code': 'TXFG1', \n    'Date': '2021/07/01', \n    'DiffPrice': [42.0], \n    'DiffRate': [0.237127], \n    'DiffType': [2], \n    'High': [17774.0], \n    'Low': [17655.0], \n    'Open': 17678.0, \n    'TargetKindPrice': 17849.57, \n    'TickType': [2], \n    'Time': '10:42:25.552000', \n    'TradeAskVolSum': 33198, \n    'TradeBidVolSum': 32180, \n    'VolSum': [51570], \n    'Volume': [1]\n}\n</code></pre>"},{"location":"tutor/market_data/streaming/futures/#attributes","title":"Attributes","text":"<p>Tick</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>code (str): \u5546\u54c1\u4ee3\u78bc\ndatetime (datetime.datetime): \u65e5\u671f\nopen (Decimal): \u958b\u76e4\u50f9\nunderlying_price (Decimal): \u6a19\u7684\u7269\u50f9\u683c\nbid_side_total_vol(int): \u8cb7\u76e4\u6210\u4ea4\u7e3d\u91cf (lot)\nask_side_total_vol(int): \u8ce3\u76e4\u6210\u4ea4\u7e3d\u91cf (lot)\navg_price (Decimal): \u5747\u50f9\nclose (Decimal): \u6210\u4ea4\u50f9\nhigh (Decimal): \u6700\u9ad8\u50f9(\u81ea\u958b\u76e4)\nlow (Decimal): \u6700\u4f4e\u50f9(\u81ea\u958b\u76e4)\namount (Decimal): \u6210\u4ea4\u984d (NTD)\ntotal_amount (Decimal): \u7e3d\u6210\u4ea4\u984d (NTD)\nvolume (int): \u6210\u4ea4\u91cf (lot)\ntotal_volume (int): \u7e3d\u6210\u4ea4\u91cf (lot)\ntick_type (int): \u5167\u5916\u76e4\u5225{1: \u5916\u76e4, 2: \u5167\u76e4, 0: \u7121\u6cd5\u5224\u5b9a}\nchg_type (int): \u6f32\u8dcc\u8a3b\u8a18{1: \u6f32\u505c, 2: \u6f32, 3: \u5e73\u76e4, 4: \u8dcc, 5: \u8dcc\u505c}\nprice_chg (Decimal): \u6f32\u8dcc\npct_chg (Decimal): \u6f32\u8dcc\u5e45 (%)\nsimtrade (int): \u8a66\u64ae\n</code></pre> <pre><code>Amount (list of float): \u6210\u4ea4\u984d (\u6210\u4ea4\u50f9)\nAmountSum (list of float): \u7e3d\u6210\u4ea4\u984d (\u7e3d\u6210\u4ea4\u50f9)\nAvgPrice (list of float): \u5747\u50f9\nClose (list of float): \u6210\u4ea4\u50f9\nCode (str): \u5546\u54c1\u4ee3\u78bc\nDate (str): \u65e5\u671f (yyyy/MM/dd)\nDiffPrice (list of float): \u6f32\u8dcc\nDiffRate (list of float): \u6f32\u8dcc\u5e45 (%)\nDiffType (list of int): \u6f32\u8dcc\u8a3b\u8a18{1: \u6f32\u505c, 2: \u6f32, 3: \u5e73\u76e4, 4: \u8dcc, 5: \u8dcc\u505c}\nHigh (list of float): \u6700\u9ad8\u50f9(\u81ea\u958b\u76e4)\nLow (list of float): \u6700\u4f4e\u50f9(\u81ea\u958b\u76e4)\nOpen (float): \u958b\u76e4\u50f9\nTargetKindPrice float: \u6a19\u7684\u7269\u50f9\u683c\nTickType (:list:int): \u5167\u5916\u76e4\u5225{1: \u5916\u76e4, 2: \u5167\u76e4, 0: \u7121\u6cd5\u5224\u5b9a}\nTime (str): \u6642\u9593 (HH:mm:ss.ffffff)\nTradeAskVolSum (int): \u8ce3\u76e4\u6210\u4ea4\u7e3d\u91cf (lot)\nTradeBidVolSum (int): \u8cb7\u76e4\u6210\u4ea4\u7e3d\u91cf (lot)\nVolSum (list of int): \u7e3d\u6210\u4ea4\u91cf (lot)\nVolume (list of int): \u6210\u4ea4\u91cf (lot)\n</code></pre>"},{"location":"tutor/market_data/streaming/futures/#bidask","title":"BidAsk","text":""},{"location":"tutor/market_data/streaming/futures/#example_1","title":"Example","text":"<p>In</p> <pre><code>api.quote.subscribe(\n    api.Contracts.Futures.TXF['TXF202107'],\n    quote_type = sj.constant.QuoteType.BidAsk,\n    version = sj.constant.QuoteVersion.v1\n)\n</code></pre> <p>Out</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>Response Code: 200 | Event Code: 16 | Info: QUO/v1/FOP/*/TFE/TXFG1 | Event: Subscribe or Unsubscribe ok\n\nExchange.TAIFEX \nBidAsk(\n    code = 'TXFG1', \n    datetime = datetime.datetime(2021, 7, 1, 10, 51, 31, 999000), \n    bid_total_vol = 66, \n    ask_total_vol = 101, \n    bid_price = [Decimal('17746'), Decimal('17745'), Decimal('17744'), Decimal('17743'), Decimal('17742')], \n    bid_volume = [1, 14, 19, 17, 15], \n    diff_bid_vol = [0, 1, 0, 0, 0], \n    ask_price = [Decimal('17747'), Decimal('17748'), Decimal('17749'), Decimal('17750'), Decimal('17751')], \n    ask_volume = [6, 22, 25, 32, 16], \n    diff_ask_vol = [0, 0, 0, 0, 0], \n    first_derived_bid_price = Decimal('17743'), \n    first_derived_ask_price = Decimal('17751'), \n    first_derived_bid_vol = 1, \n    first_derived_ask_vol = 1, \n    underlying_price = Decimal('17827.94'), \n    simtrade = 0\n)\n</code></pre> <pre><code>Response Code: 200 | Event Code: 16 | Info: Q/*/TXFG1 | Event: Subscribe or Unsubscribe ok\n\nQ/TFE/TXFG1 \n{\n    'AskPrice': [17747.0, 17748.0, 17749.0, 17750.0, 17751.0], \n    'AskVolSum': 99, \n    'AskVolume': [6, 22, 25, 31, 15], \n    'BidPrice': [17746.0, 17745.0, 17744.0, 17743.0, 17742.0], \n    'BidVolSum': 81, \n    'BidVolume': [1, 12, 23, 25, 20], \n    'Code': 'TXFG1', \n    'Date': '2021/07/01', \n    'DiffAskVol': [0, 0, 0, 0, 0], \n    'DiffAskVolSum': 0, \n    'DiffBidVol': [0, 0, 2, 0, 0], \n    'DiffBidVolSum': 0, \n    'FirstDerivedAskPrice': 17751.0, \n    'FirstDerivedAskVolume': 1, \n    'FirstDerivedBidPrice': 17743.0, \n    'FirstDerivedBidVolume': 1, \n    'TargetKindPrice': 17828.46, \n    'Time': '10:51:29.999000'\n}\n</code></pre>"},{"location":"tutor/market_data/streaming/futures/#attributes_1","title":"Attributes","text":"<p>BidAsk</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>code (str): \u5546\u54c1\u4ee3\u78bc\ndatetime (datetime.datetime): \u6642\u9593\nbid_total_vol (int): \u59d4\u8cb7\u91cf\u7e3d\u8a08 (lot)\nask_total_vol (int): \u59d4\u8ce3\u91cf\u7e3d\u8a08 (lot)\nbid_price (:List:decimal): \u59d4\u8cb7\u50f9\nbid_volume (:List:int): \u59d4\u8cb7\u91cf (lot)\ndiff_bid_vol (:List:int): \u59d4\u8cb7\u50f9\u589e\u6e1b\u91cf (lot)\nask_price (:List:decimal): \u59d4\u8ce3\u50f9\nask_volume (:List:int): \u59d4\u8ce3\u91cf (lot)\ndiff_ask_vol (:List:int): \u59d4\u8ce3\u50f9\u589e\u6e1b\u91cf (lot)\nfirst_derived_bid_price (decimal): \u884d\u751f\u4e00\u6a94\u59d4\u8cb7\u50f9\nfirst_derived_ask_price (decimal): \u884d\u751f\u4e00\u6a94\u59d4\u8ce3\u50f9\nfirst_derived_bid_vol (int): \u884d\u751f\u4e00\u6a94\u59d4\u8cb7\u91cf\nfirst_derived_ask_vol (int): \u884d\u751f\u4e00\u6a94\u59d4\u8ce3\u91cf\nunderlying_price (decimal): \u6a19\u7684\u7269\u50f9\u683c\nsimtrade (int): \u8a66\u64ae\n</code></pre> <pre><code>AskPrice (:List:float): \u59d4\u8ce3\u50f9\nAskVolSum (int): \u59d4\u8ce3\u91cf\u7e3d\u8a08(lot)\nAskVolume (:List:int): \u59d4\u8ce3\u91cf\nBidPrice (:List:float): \u59d4\u8cb7\u50f9\nBidVolSum (int): \u59d4\u8cb7\u91cf\u7e3d\u8a08(lot)\nBidVolume (:List:int): \u59d4\u8cb7\u91cf\nCode (str): \u5546\u54c1\u4ee3\u78bc\nDate (str): \u65e5\u671f (yyyy/MM/dd)\nDiffAskVol (:List:int): \u8ce3\u50f9\u589e\u6e1b\u91cf(lot)\nDiffAskVolSum (int): \nDiffBidVol (:List:int): \u8cb7\u50f9\u589e\u6e1b\u91cf(lot)\nDiffBidVolSum (int): \nFirstDerivedAskPrice (float): \u884d\u751f\u4e00\u6a94\u59d4\u8ce3\u50f9\nFirstDerivedAskVolume (int): \u884d\u751f\u4e00\u6a94\u59d4\u8ce3\u91cf\nFirstDerivedBidPrice (float): \u884d\u751f\u4e00\u6a94\u59d4\u8cb7\u50f9\nFirstDerivedBidVolume (int): \u884d\u751f\u4e00\u6a94\u59d4\u8cb7\u91cf\nTargetKindPrice (float): \u6a19\u7684\u7269\u50f9\u683c\nTime (str): \u6642\u9593 (HH:mm:ss.ffffff)\n</code></pre>"},{"location":"tutor/market_data/streaming/futures/#callback","title":"Callback","text":"<p>In default, we set quote callback as print function. You can modify callback function as you wish. Just remember, always avoid making calulations inside the callback function.</p>"},{"location":"tutor/market_data/streaming/futures/#tick_1","title":"Tick","text":"<p>In: pythonic way by using decorator</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>from shioaji import TickFOPv1, Exchange\n\n@api.on_tick_fop_v1()\ndef quote_callback(exchange:Exchange, tick:TickFOPv1):\n    print(f\"Exchange: {exchange}, Tick: {tick}\")\n</code></pre> <pre><code>@api.quote.on_quote\ndef quote_callback(topic: str, quote: dict):\n    print(f\"Topic: {topic}, Quote: {quote}\")\n</code></pre> <p>In: traditional way</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>from shioaji import TickFOPv1, Exchange\n\ndef quote_callback(exchange:Exchange, tick:TickFOPv1):\n    print(f\"Exchange: {exchange}, Tick: {tick}\")\n\napi.quote.set_on_tick_fop_v1_callback(quote_callback)\n</code></pre> <pre><code>def quote_callback(topic: str, tick: dict):\n    print(f\"Topic: {topic}, Tick: {tick}\")\n\napi.quote.set_quote_callback(quote_callback)\n</code></pre> <p>Out</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>Exchange: Exchange.TAIFEX, Tick: Tick(code='TXFG1', datetime=datetime.datetime(2021, 7, 2, 13, 17, 22, 784000), open=Decimal('17651'), underlying_price=Decimal('17727.12'), trade_bid_total_vol=61550, trade_ask_volume=60914, avg_price=Decimal('17657.959752'), close=Decimal('17653'), high=Decimal('17724'), low=Decimal('17588'), amount=Decimal('35306'), total_amount=Decimal('1683421593'), volume=2, total_volume=95335, tick_type=1, chg_type=2, price_chg=Decimal('7'), pct_chg=Decimal('0.039669'), simtrade=0)\n</code></pre> <pre><code>Topic: L/TFE/TXFG1, Quote: {'Amount': [17654.0], 'AmountSum': [1682856730.0], 'AvgPrice': [17657.961764], 'Close': [17654.0], 'Code': 'TXFG1', 'Date': '2021/07/02', 'DiffPrice': [8.0], 'DiffRate': [0.045336], 'DiffType': [2], 'High': [17724.0], 'Low': [17588.0], 'Open': 17651.0, 'TargetKindPrice': 17725.14, 'TickType': [1], 'Time': '13:17:16.533000', 'TradeAskVolSum': 60890, 'TradeBidVolSum': 61520, 'VolSum': [95303], 'Volume': [1]}\n</code></pre>"},{"location":"tutor/market_data/streaming/futures/#bidask_1","title":"BidAsk","text":"<p>In: pythonic way by using decorator</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>from shioaji import BidAskFOPv1, Exchange\n\n@api.on_bidask_fop_v1()\ndef quote_callback(exchange:Exchange, bidask:BidAskFOPv1):\n    print(f\"Exchange: {exchange}, BidAsk: {bidask}\")\n</code></pre> <pre><code>@api.quote.on_quote\ndef quote_callback(topic: str, quote: dict):\n    print(f\"Topic: {topic}, Quote: {quote}\")\n</code></pre> <p>In: traditional way</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>from shioaji import BidAskFOPv1, Exchange\n\ndef quote_callback(exchange:Exchange, bidask:BidAskFOPv1):\n    print(f\"Exchange: {exchange}, BidAsk: {bidask}\")\n\napi.quote.set_on_bidask_fop_v1_callback(quote_callback)\n</code></pre> <pre><code>def quote_callback(topic: str, quote: dict):\n    print(f\"Topic: {topic}, Quote: {quote}\")\n\napi.quote.set_quote_callback(quote_callback)\n</code></pre> <p>Out</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>Exchange: Exchange.TAIFEX, BidAsk: BidAsk(code='TXFG1', datetime=datetime.datetime(2021, 7, 2, 13, 18, 0, 684000), bid_total_vol=69, ask_total_vol=94, bid_price=[Decimal('17651'), Decimal('17650'), Decimal('17649'), Decimal('17648'), Decimal('17647')], bid_volume=[10, 12, 18, 18, 11], diff_bid_vol=[0, 0, 0, 0, 0], ask_price=[Decimal('17653'), Decimal('17654'), Decimal('17655'), Decimal('17656'), Decimal('17657')], ask_volume=[6, 17, 29, 22, 20], diff_ask_vol=[0, 0, 0, 0, 0], first_derived_bid_price=Decimal('17647'), first_derived_ask_price=Decimal('17657'), first_derived_bid_vol=2, first_derived_ask_vol=3, underlying_price=Decimal('17725.5'), simtrade=0)\n</code></pre> <pre><code>Topic: Q/TFE/TXFG1, Quote: {'AskPrice': [17653.0, 17654.0, 17655.0, 17656.0, 17657.0], 'AskVolSum': 85, 'AskVolume': [3, 16, 24, 22, 20], 'BidPrice': [17651.0, 17650.0, 17649.0, 17648.0, 17647.0], 'BidVolSum': 67, 'BidVolume': [10, 10, 18, 18, 11], 'Code': 'TXFG1', 'Date': '2021/07/02', 'DiffAskVol': [-4, -2, 0, 0, 0], 'DiffAskVolSum': 0, 'DiffBidVol': [1, 0, 2, 0, 0], 'DiffBidVolSum': 0, 'FirstDerivedAskPrice': 17657.0, 'FirstDerivedAskVolume': 3, 'FirstDerivedBidPrice': 17647.0, 'FirstDerivedBidVolume': 2, 'TargetKindPrice': 17716.19, 'Time': '13:17:57.809000'}\n</code></pre> <ul> <li>Advanced quote callback settings please refer to Quote-Binding Mode.</li> </ul>"},{"location":"tutor/market_data/streaming/stocks/","title":"Stocks","text":"<p>To subscribe quotes is very easy, just call <code>subscribe</code> function with contract which we've discussed in previous topic.</p> <p>Subscribe</p> <pre><code>&gt;&gt; api.quote.subscribe?\n\nSignature:\n    api.quote.subscribe(\n        contract:shioaji.contracts.Contract,\n        quote_type:shioaji.constant.QuoteType=&lt;QuoteType.Tick: 'tick'&gt;,\n        intraday_odd:bool=False,\n        version: shioaji.constant.QuoteVersion=&lt;QuoteVersion.v0: 'v0'&gt;,\n    )\n</code></pre> <p>Quote Parameters</p> <pre><code>quote_type: tick price or bid/ask price to subscribe\n    {'tick', 'bidask'}\nintraday_odd: \u76e4\u4e2d\u96f6\u80a1\n    {True, False}\nversion: version of quote format\n    {'v1', 'v0'}\n</code></pre>"},{"location":"tutor/market_data/streaming/stocks/#tick","title":"Tick","text":""},{"location":"tutor/market_data/streaming/stocks/#common-stock","title":"Common Stock","text":"<p>In</p> <pre><code>api.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"], \n    quote_type = sj.constant.QuoteType.Tick,\n    version = sj.constant.QuoteVersion.v1\n)\n</code></pre> <p>Out</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>Response Code: 200 | Event Code: 16 | Info: TIC/v1/STK/*/TSE/2330 | Event: Subscribe or Unsubscribe ok\n\nExchange.TSE \nTick(\n    code = '2330', \n    datetime = datetime.datetime(2021, 7, 2, 13, 16, 35, 92970), \n    open = Decimal('590'), \n    avg_price = Decimal('589.05'), \n    close = Decimal('590'), \n    high = Decimal('593'), \n    low = Decimal('587'), \n    amount = Decimal('590000'), \n    total_amount = Decimal('8540101000'), \n    volume = 1, \n    total_volume = 14498, \n    tick_type = 1, \n    chg_type = 4, \n    price_chg = Decimal('-3'), \n    pct_chg = Decimal('-0.505902'), \n    bid_side_total_vol= 6638, \n    ask_side_total_vol = 7860, \n    bid_side_total_cnt = 2694, \n    ask_side_total_cnt = 2705, \n    closing_oddlot_shares = 0, \n    fixed_trade_vol = 0, \n    suspend = 0, \n    simtrade = 0, \n    intraday_odd = 0\n)\n</code></pre> <pre><code>Response Code: 200 | Event Code: 16 | Info: MKT/*/TSE/2330 | Event: Subscribe or Unsubscribe ok\n\nMKT/idcdmzpcr01/TSE/2330 \n{\n    'AmountSum': [1688787000.0], \n    'Close': [593.0], \n    'Date': '2021/07/01', \n    'TickType': [2], \n    'Time': '09:10:20.628620', \n    'VolSum': [2837], \n    'Volume': [1]\n}\n</code></pre>"},{"location":"tutor/market_data/streaming/stocks/#intraday-odd","title":"Intraday odd","text":"<p>In</p> <pre><code>api.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"], \n    quote_type = sj.constant.QuoteType.Tick,\n    version = sj.constant.QuoteVersion.v1,\n    intraday_odd = True\n)\n</code></pre> <p>Out</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>Response Code: 200 | Event Code: 16 | Info: TIC/v1/ODD/*/TSE/2330 | Event: Subscribe or Unsubscribe ok\n\nExchange.TSE \nTick(\n    code = '2330', \n    datetime = datetime.datetime(2021, 7, 2, 13, 16, 55, 544646), \n    open = Decimal('591'), \n    avg_price = Decimal('590.24415'), \n    close = Decimal('590'), \n    high = Decimal('591'), \n    low = Decimal('589'), \n    amount = Decimal('276120'), \n    total_amount = Decimal('204995925'), \n    volume = 468, \n    total_volume = 347307, \n    tick_type = 1, \n    chg_type = 4, \n    price_chg = Decimal('-3'), \n    pct_chg = Decimal('-0.505902'), \n    bid_side_total_vol= 68209, \n    ask_side_total_vol = 279566, \n    bid_side_total_cnt = 28, \n    ask_side_total_cnt = 56, \n    closing_oddlot_shares = 0, \n    fixed_trade_vol = 0, \n    suspend = 0, \n    simtrade = 1, \n    intraday_odd = 1\n)\n</code></pre> <pre><code>Response Code: 200 | Event Code: 16 | Info: TIC/v2/*/TSE/2330/ODDLOT | Event: Subscribe or Unsubscribe ok\n\nTIC/v2/replay/TSE/2330/ODDLOT \n{\n    'Date': '2021/07/01', \n    'Time': '09:23:36.880878', \n    'Close': '593', \n    'TickType': 1, \n    'Shares': 1860, \n    'SharesSum': 33152, \n    'Simtrade': 1\n}\n</code></pre>"},{"location":"tutor/market_data/streaming/stocks/#attributes","title":"Attributes","text":"<p>Tick</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>code (str): \u5546\u54c1\u4ee3\u78bc\ndatetime (datetime): \u6642\u9593\nopen (decimal): \u958b\u76e4\u50f9\navg_price (decimal): \u5747\u50f9\nclose (decimal): \u6210\u4ea4\u50f9\nhigh (decimal): \u6700\u9ad8\u50f9(\u81ea\u958b\u76e4)\nlow (decimal): \u6700\u4f4e\u50f9(\u81ea\u958b\u76e4)\namount (decimal): \u6210\u4ea4\u984d (NTD)\ntotal_amount (decimal): \u7e3d\u6210\u4ea4\u984d (NTD)\nvolume (int): \u6210\u4ea4\u91cf (\u6574\u80a1:\u5f35, \u76e4\u4e2d\u96f6\u80a1: \u80a1)\ntotal_volume (int): \u7e3d\u6210\u4ea4\u91cf (\u6574\u80a1:\u5f35, \u76e4\u4e2d\u96f6\u80a1: \u80a1)\ntick_type (int): \u5167\u5916\u76e4\u5225{1: \u5916\u76e4, 2: \u5167\u76e4, 0: \u7121\u6cd5\u5224\u5b9a}\nchg_type (int): \u6f32\u8dcc\u8a3b\u8a18{1: \u6f32\u505c, 2: \u6f32, 3: \u5e73\u76e4, 4: \u8dcc, 5: \u8dcc\u505c}\nprice_chg (decimal): \u6f32\u8dcc\npct_chg (decimal):  \u6f32\u8dcc\u5e45\nbid_side_total_vol (int): \u8cb7\u76e4\u6210\u4ea4\u7e3d\u91cf (\u6574\u80a1:\u5f35, \u76e4\u4e2d\u96f6\u80a1: \u80a1)\nask_side_total_vol (int): \u8ce3\u76e4\u6210\u4ea4\u7e3d\u91cf (\u6574\u80a1:\u5f35, \u76e4\u4e2d\u96f6\u80a1: \u80a1)\nbid_side_total_cnt (int): \u8cb7\u76e4\u6210\u4ea4\u7b46\u6578 \nask_side_total_cnt (int): \u8ce3\u76e4\u6210\u4ea4\u7b46\u6578 \nclosing_oddlot_shares (int): \u76e4\u5f8c\u96f6\u80a1\u6210\u4ea4\u80a1\u6578(\u80a1)   \nfixed_trade_vol (int): \u5b9a\u76e4\u6210\u4ea4\u91cf (\u6574\u80a1:\u5f35, \u76e4\u4e2d\u96f6\u80a1: \u80a1)\nsuspend (bool): \u66ab\u505c\u4ea4\u6613\nsimtrade (bool): \u8a66\u64ae\nintraday_odd (int): \u76e4\u4e2d\u96f6\u80a1 {0: \u6574\u80a1, 1:\u76e4\u4e2d\u96f6\u80a1}\n</code></pre> <pre><code>AmountSum (:List:float): \u7e3d\u6210\u4ea4\u984d\nClose (:List:float): \u6210\u4ea4\u50f9\nDate (str): \u65e5\u671f (yyyy/MM/dd)\nTickType (:List:int): \u5167\u5916\u76e4\u5225{1: \u5916\u76e4, 2: \u5167\u76e4, 0: \u7121\u6cd5\u5224\u5b9a}\nTime (str): \u6642\u9593 (HH:mm:ss.ffffff)\nVolSum (:List:int): \u7e3d\u6210\u4ea4\u91cf (\u5f35)\nVolume (:List:int): \u6210\u4ea4\u91cf (\u5f35)\n</code></pre>"},{"location":"tutor/market_data/streaming/stocks/#bidask","title":"BidAsk","text":""},{"location":"tutor/market_data/streaming/stocks/#common-stock_1","title":"Common Stock","text":"<p>In</p> <pre><code>api.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"], \n    quote_type = sj.constant.QuoteType.BidAsk,\n    version = sj.constant.QuoteVersion.v1\n)\n</code></pre> <p>Out</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>Response Code: 200 | Event Code: 16 | Info: QUO/v1/STK/*/TSE/2330 | Event: Subscribe or Unsubscribe ok\n\nExchange.TSE \nBidAsk(\n    code = '2330', \n    datetime = datetime.datetime(2021, 7, 1, 9, 9, 54, 36828), \n    bid_price = [Decimal('593'), Decimal('592'), Decimal('591'), Decimal('590'), Decimal('589')], \n    bid_volume = [248, 180, 258, 267, 163], \n    diff_bid_vol = [3, 0, 0, 0, 0], \n    ask_price = [Decimal('594'), Decimal('595'), Decimal('596'), Decimal('597'), Decimal('598')], \n    ask_volume = [1457, 531, 506, 90, 259], \n    diff_ask_vol = [0, 0, 0, 0, 0], \n    suspend = 0, \n    simtrade = 0,\n    intraday_odd = 0\n)\n</code></pre> <pre><code>Response Code: 200 | Event Code: 16 | Info: QUT/*/TSE/2330 | Event: Subscribe or Unsubscribe ok\n\nQUT/idcdmzpcr01/TSE/2330 \n{\n    'AskPrice': [594.0, 595.0, 596.0, 597.0, 598.0], \n    'AskVolume': [1465, 532, 507, 92, 258], \n    'BidPrice': [593.0, 592.0, 591.0, 590.0, 589.0], \n    'BidVolume': [254, 178, 255, 268, 163], \n    'Date': '2021/07/01', \n    'Time': '09:09:48.447219'\n}\n</code></pre>"},{"location":"tutor/market_data/streaming/stocks/#intraday-odd_1","title":"Intraday odd","text":"<p>In</p> <pre><code>api.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"], \n    quote_type = sj.constant.QuoteType.BidAsk,\n    version = sj.constant.QuoteVersion.v1\n    intraday_odd=True\n)\n</code></pre> <p>Out</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>Response Code: 200 | Event Code: 16 | Info: QUO/v1/ODD/*/TSE/2330 | Event: Subscribe or Unsubscribe ok\n\nExchange.TSE \nBidAsk(\n    code = '2330',\n    datetime = datetime.datetime(2021, 7, 2, 13, 17, 45, 743299),\n    bid_price = [Decimal('589'), Decimal('588'), Decimal('587'), Decimal('586'), Decimal('585')], \n    bid_volume = [59391, 224490, 74082, 68570, 125246], \n    diff_bid_vol = [49874, 101808, 23863, 38712, 77704], \n    ask_price = [Decimal('590'), Decimal('591'), Decimal('592'), Decimal('593'), Decimal('594')], \n    ask_volume = [26355, 9680, 18087, 11773, 3568], \n    diff_ask_vol = [13251, -14347, 39249, -20397, -10591], \n    suspend = 0, \n    simtrade = 1, \n    intraday_odd = 1\n)\n</code></pre> <pre><code>Response Code: 200 | Event Code: 16 | Info: QUO/v2/*/TSE/2330/ODDLOT | Event: Subscribe or Unsubscribe ok\n\nQUO/v2/replay/TSE/2330/ODDLOT \n{\n    'Date': '2021/07/01', \n    'Time': '09:43:47.143789', \n    'BidPrice': ['592', '591', '590', '589', '588'], \n    'AskPrice': ['593', '594', '595', '596', '597'], \n    'BidShares': [16979, 12009, 45045, 5501, 12956], \n    'AskShares': [17276, 14823, 26518, 23388, 10527], \n    'Simtrade': 1\n}\n</code></pre>"},{"location":"tutor/market_data/streaming/stocks/#attributes_1","title":"Attributes","text":"<p>BidAsk</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>code (str): \u5546\u54c1\u4ee3\u78bc\ndatetime (datetime): \u6642\u9593\nbid_price (:List:decimal): \u59d4\u8cb7\u50f9\nbid_volume (:List:int): \u59d4\u8cb7\u91cf (\u5f35)\ndiff_bid_vol (:List:int): \u8cb7\u50f9\u589e\u6e1b\u91cf (\u5f35)\nask_price (:List:decimal): \u59d4\u8ce3\u50f9\nask_volume (:List:int): \u59d4\u8ce3\u91cf\ndiff_ask_vol (:List:int): \u8ce3\u50f9\u589e\u6e1b\u91cf (\u5f35)\nsuspend (bool): \u66ab\u505c\u4ea4\u6613\nsimtrade (bool): \u8a66\u64ae\n</code></pre> <pre><code>AskPrice (:List:float): \u59d4\u8ce3\u50f9\nAskVolume (:List:int): \u59d4\u8ce3\u91cf\nBidPrice (:List:float): \u59d4\u8cb7\u50f9\nBidVolume (:List:int): \u59d4\u8cb7\u91cf\nDate (datetime.date): \u65e5\u671f (yyyy/MM/dd)\nTime (time): \u6642\u9593 (HH:mm:ss.ffffff)\n</code></pre>"},{"location":"tutor/market_data/streaming/stocks/#quote","title":"Quote","text":""},{"location":"tutor/market_data/streaming/stocks/#common-stock_2","title":"Common Stock","text":"<p>In</p> <pre><code>api.quote.subscribe(\n    api.Contracts.Stocks[\"2330\"], \n    quote_type = sj.constant.QuoteType.Quote, \n    version = sj.constant.QuoteVersion.v1\n)\n</code></pre> <p>Out</p> <pre><code>Response Code: 200 | Event Code: 16 | Info: QUO/v2/STK/*/TSE/2330 | Event: Subscribe or Unsubscribe ok\n\nExchange.TSE, \nQuote(\n    code='2330', \n    datetime=datetime.datetime(2022, 7, 1, 10, 43, 15, 430329), \n    open=Decimal('471.5'), \n    avg_price=Decimal('467.91'), \n    close=Decimal('461'), \n    high=Decimal('474'), \n    low=Decimal('461'), \n    amount=Decimal('461000'), \n    total_amount=Decimal('11834476000'), \n    volume=1, \n    total_volume=25292, \n    tick_type=2, \n    chg_type=4, \n    price_chg=Decimal('-15'), \n    pct_chg=Decimal('-3.15'), \n    bid_side_total_vol=9350, \n    ask_side_total_vol=15942, \n    bid_side_total_cnt=2730, \n    ask_side_total_cnt=2847, \n    closing_oddlot_shares=0, \n    closing_oddlot_close=Decimal('0.0'), \n    closing_oddlot_amount=Decimal('0'), \n    closing_oddlot_bid_price=Decimal('0.0'), \n    closing_oddlot_ask_price=Decimal('0.0'), \n    fixed_trade_vol=0, \n    fixed_trade_amount=Decimal('0'), \n    bid_price=[Decimal('461'), Decimal('460.5'), Decimal('460'), Decimal('459.5'), Decimal('459')], \n    bid_volume=[220, 140, 994, 63, 132], \n    diff_bid_vol=[-1, 0, 0, 0, 0], \n    ask_price=[Decimal('461.5'), Decimal('462'), Decimal('462.5'), Decimal('463'), Decimal('463.5')], \n    ask_volume=[115, 101, 103, 147, 91], \n    diff_ask_vol=[0, 0, 0, 0, 0], \n    avail_borrowing=9579699, \n    suspend=0, \n    simtrade=0\n)\n</code></pre>"},{"location":"tutor/market_data/streaming/stocks/#attributes_2","title":"Attributes","text":"<p>Quote</p> <pre><code>code (str): \u5546\u54c1\u4ee3\u78bc\ndatetime (datetime): \u6642\u9593\nopen (decimal): \u958b\u76e4\u50f9\navg_price (decimal): \u5747\u50f9\nclose (decimal): \u6210\u4ea4\u50f9\nhigh (decimal): \u6700\u9ad8\u50f9(\u81ea\u958b\u76e4)\nlow (decimal): \u6700\u4f4e\u50f9(\u81ea\u958b\u76e4)\namount (decimal): \u6210\u4ea4\u984d (NTD)\ntotal_amount (decimal): \u7e3d\u6210\u4ea4\u984d (NTD)\nvolume (int): \u6210\u4ea4\u91cf\ntotal_volume (int): \u7e3d\u6210\u4ea4\u91cf\ntick_type (int): \u5167\u5916\u76e4\u5225\nchg_type (int): \u6f32\u8dcc\u8a3b\u8a18\nprice_chg (decimal): \u6f32\u8dcc\u50f9\npct_chg (decimal): \u6f32\u8dcc\u7387\nbid_side_total_vol (int): \u8cb7\u76e4\u6210\u4ea4\u7e3d\u91cf (\u5f35)\nask_side_total_vol (int): \u8ce3\u76e4\u6210\u4ea4\u7e3d\u91cf (\u5f35)\nbid_side_total_cnt (int): \u8cb7\u76e4\u6210\u4ea4\u7b46\u6578\nask_side_total_cnt (int): \u8ce3\u76e4\u6210\u4ea4\u7b46\u6578\nclosing_oddlot_shares (int): \u76e4\u5f8c\u96f6\u80a1\u6210\u4ea4\u80a1\u6578 \nclosing_oddlot_close (decimal): \u76e4\u5f8c\u96f6\u80a1\u6210\u4ea4\u50f9\nclosing_oddlot_amount (decimal): \u76e4\u5f8c\u96f6\u80a1\u6210\u4ea4\u984d\nclosing_oddlot_bid_price (decimal): \u76e4\u5f8c\u96f6\u80a1\u8cb7\u50f9 \nclosing_oddlot_ask_price (decimal): \u76e4\u5f8c\u96f6\u80a1\u8ce3\u50f9 \nfixed_trade_vol (int): \u5b9a\u76e4\u6210\u4ea4\u91cf (\u5f35)\nfixed_trade_amount (decimal): \u5b9a\u76e4\u6210\u4ea4\u984d\nbid_price (:List:decimal): \u8cb7\u50f9\nbid_volume (:List:int) \u8cb7\u91cf\ndiff_bid_vol (:List:int) \u8cb7\u50f9\u589e\u6e1b\u91cf\nask_price (:List:decimal): \u8ce3\u50f9\nask_volume (:List:int) \u8ce3\u91cf\ndiff_ask_vol (:List:int) \u8ce3\u50f9\u589e\u6e1b\u91cf\navail_borrowing (int): \u501f\u5238\u53ef\u7528\u9918\u984d\nsuspend (bool): \u66ab\u505c\u4ea4\u6613\nsimtrade (bool): \u8a66\u64ae\n</code></pre>"},{"location":"tutor/market_data/streaming/stocks/#callback","title":"Callback","text":"<p>In default, we set quote callback as print function. You can modify callback function as you wish. Just remember, always avoid making calulations inside the callback function.</p>"},{"location":"tutor/market_data/streaming/stocks/#tick_1","title":"Tick","text":"<p>In: pythonic way by using decorator</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>from shioaji import TickSTKv1, Exchange\n\n@api.on_tick_stk_v1()\ndef quote_callback(exchange: Exchange, tick:TickSTKv1):\n    print(f\"Exchange: {exchange}, Tick: {tick}\")\n</code></pre> <pre><code>@api.quote.on_quote\ndef quote_callback(topic: str, quote: dict):\n    print(f\"Topic: {topic}, Quote: {quote}\")\n</code></pre> <p>In: traditional way</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>from shioaji import TickSTKv1, Exchange\n\ndef quote_callback(exchange: Exchange, tick:TickSTKv1):\n    print(f\"Exchange: {exchange}, Tick: {tick}\")\n\napi.quote.set_on_tick_stk_v1_callback(quote_callback)\n</code></pre> <pre><code>def quote_callback(topic: str, quote: dict):\n    print(f\"Topic: {topic}, Quote: {quote}\")\n\napi.quote.set_quote_callback(quote_callback)\n</code></pre> <p>Out</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>Exchange: Exchange.TSE, Tick: Tick(code='2330', datetime=datetime.datetime(2021, 7, 2, 13, 16, 35, 92970), open=Decimal('590'), avg_price=Decimal('589.05'), close=Decimal('590'), high=Decimal('593'), low=Decimal('587'), amount=Decimal('590000'), total_amount=Decimal('8540101000'), volume=1, total_volume=14498, tick_type=1, chg_type=4, price_chg=Decimal('-3'), pct_chg=Decimal('-0.505902'), trade_bid_volume=6638, ask_side_total_vol=7860, bid_side_total_cnt=2694, ask_side_total_cnt=2705, closing_oddlot_shares=0, fixed_trade_vol=0, suspend=0, simtrade=0, intraday_odd=0)\n</code></pre> <pre><code>Topic: MKT/*/TSE/2330, Quote: {'AmountSum': [4739351000.0], 'Close': [596.0], 'Date': '2021/03/30', 'TickType': [2], 'Time': '10:01:33.349431', 'VolSum': [7932], 'Volume': [1]}\n</code></pre>"},{"location":"tutor/market_data/streaming/stocks/#bidask_1","title":"BidAsk","text":"<p>In: pythonic way by using decorator</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>from shioaji import BidAskSTKv1, Exchange\n\n@api.on_bidask_stk_v1()\ndef quote_callback(exchange: Exchange, bidask:BidAskSTKv1):\n    print(f\"Exchange: {exchange}, BidAsk: {bidask}\")\n</code></pre> <pre><code>@api.quote.on_quote\ndef quote_callback(topic: str, quote: dict):\n    print(f\"Topic: {topic}, Quote: {quote}\")\n</code></pre> <p>In: traditional way</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>from shioaji import BidAskSTKv1, Exchange\n\ndef quote_callback(exchange: Exchange, bidask:BidAskSTKv1):\n    print(f\"Exchange: {exchange}, BidAsk: {bidask}\")\n\napi.quote.set_on_bidask_stk_v1_callback(quote_callback)\n</code></pre> <pre><code>def quote_callback(topic: str, quote: dict):\n    print(f\"Topic: {topic}, Quote: {quote}\")\n\napi.quote.set_quote_callback(quote_callback)\n</code></pre> <p>Out</p> QuoteVersion.v1QuoteVersion.v0 <pre><code>Exchange: Exchange.TSE, BidAsk: BidAsk(code='2330', datetime=datetime.datetime(2021, 7, 2, 13, 17, 29, 726428), bid_price=[Decimal('589'), Decimal('588'), Decimal('587'), Decimal('586'), Decimal('585')], bid_volume=[223, 761, 1003, 809, 1274], diff_bid_vol=[0, 0, 0, 0, 0], ask_price=[Decimal('590'), Decimal('591'), Decimal('592'), Decimal('593'), Decimal('594')], ask_volume=[304, 232, 183, 242, 131], diff_ask_vol=[1, 0, 0, 0, 0], suspend=0, simtrade=0, intraday_odd=0)\n</code></pre> <pre><code>Topic: QUT/idcdmzpcr01/TSE/2330, Quote: {'AskPrice': [590.0, 591.0, 592.0, 593.0, 594.0], 'AskVolume': [303, 232, 183, 242, 131], 'BidPrice': [589.0, 588.0, 587.0, 586.0, 585.0], 'BidVolume': [224, 762, 1003, 809, 1274], 'Date': '2021/07/02', 'Time': '13:17:26.391840'}\n</code></pre>"},{"location":"tutor/market_data/streaming/stocks/#quote_1","title":"Quote","text":"<p>In: pythonic way by using decorator</p> <pre><code>from shioaji import QuoteSTKv1, Exchange\n\n@api.on_quote_stk_v1()\ndef quote_callback(exchange: Exchange, quote:QuoteSTKv1):\n    print(f\"Exchange: {exchange}, Quote: {quote}\")\n</code></pre> <p>In: traditional way</p> <pre><code>from shioaji import QuoteSTKv1, Exchange\n\ndef quote_callback(exchange: Exchange, quote:QuoteSTKv1):\n    print(f\"Exchange: {exchange}, Quote: {quote}\")\n\napi.quote.set_on_quote_stk_v1_callback(quote_callback)\n</code></pre> <p>Out</p> <pre><code>Exchange: TSE, Quote: Quote(code='2330', datetime=datetime.datetime(2022, 7, 1, 10, 43, 15, 430329), open=Decimal('471.5'), avg_price=Decimal('467.91'), close=Decimal('461'), high=Decimal('474'), low=Decimal('461'), amount=Decimal('461000'), total_amount=Decimal('11834476000'), volume=1, total_volume=25292, tick_type=2, chg_type=4, price_chg=Decimal('-15'), pct_chg=Decimal('-3.15'), bid_side_total_vol=9350, ask_side_total_vol=15942, bid_side_total_cnt=2730, ask_side_total_cnt=2847, closing_oddlot_shares=0, closing_oddlot_close=Decimal('0.0'), closing_oddlot_amount=Decimal('0'), closing_oddlot_bid_price=Decimal('0.0'), closing_oddlot_ask_price=Decimal('0.0'), fixed_trade_vol=0, fixed_trade_amount=Decimal('0'), bid_price=[Decimal('461'), Decimal('460.5'), Decimal('460'), Decimal('459.5'), Decimal('459')], bid_volume=[220, 140, 994, 63, 132], diff_bid_vol=[-1, 0, 0, 0, 0], ask_price=[Decimal('461.5'), Decimal('462'), Decimal('462.5'), Decimal('463'), Decimal('463.5')], ask_volume=[115, 101, 103, 147, 91], diff_ask_vol=[0, 0, 0, 0, 0], avail_borrowing=9579699, suspend=0, simtrade=0)\n</code></pre> <ul> <li>Intraday odd share the callback function with common stock.</li> <li>Advanced quote callback settings please refer to Quote-Binding Mode.</li> </ul>"},{"location":"tutor/order/Combo/","title":"Combo","text":"<p>Reminder </p> <p>First, you need to login and activate CA.</p>"},{"location":"tutor/order/Combo/#place-combo-order","title":"Place Combo Order.","text":"<p>Combo orders offer types include: Price Call/Put Spreads,  Time Call/Put Spreads, Straddles, Strangles, Conversions and Reversal. Please refer to the futures exchange document for details on the combo rules.</p> <p>place_comboorder</p> <pre><code>api.place_comboorder?\n\n    Signature:\n        api.place_comboorder(\n            combo_contract: shioaji.contracts.ComboContract,\n            order: shioaji.order.ComboOrder,\n            timeout: int = 5000,\n            cb: Callable[[shioaji.order.ComboTrade], NoneType] = None,\n        )\n    Docstring:\n        placing combo order\n</code></pre> <p>Product information ( <code>contract</code>) and order information ( <code>order</code>) must be provided when placing an order. The order of the contracts is irrelevant, only the approved combination is required.</p> <p>Combo Contract</p> <pre><code>contract_1 = api.Contracts.Options.TX4.TX4202111017850C\ncontract_2 = api.Contracts.Options.TX4.TX4202111017850P\ncombo_contract = sj.contracts.ComboContract(\n    legs=[\n        sj.contracts.ComboBase(action=\"Sell\", **contract_1.dict()),\n        sj.contracts.ComboBase(action=\"Sell\", **contract_2.dict()),\n    ]\n)\n</code></pre> <p>Order</p> <pre><code>order = api.ComboOrder(\n    price_type=\"LMT\", \n    price=1, \n    quantity=1, \n    order_type=\"IOC\",\n    octype=sj.constant.FuturesOCType.New,\n)\n</code></pre> <p>In</p> <pre><code>trade = api.place_comboorder(combo_c, order)\n</code></pre>"},{"location":"tutor/order/Combo/#cancel-combo-order","title":"Cancel Combo Order","text":"<p><code>Trade</code> is the order to be deleted, which can be obtained from the <code>update_combostatus</code>.</p> <p>In</p> <pre><code>api.cancel_comboorder(trade)\n</code></pre>"},{"location":"tutor/order/Combo/#update-combo-status","title":"Update Combo Status","text":"<p>Like <code>list_trades</code> and <code>update_status</code> concepts. Before getting the combo status, the status must be updated with <code>update_combostatus</code>.</p> <p>In</p> <pre><code>api.update_combostatus()\napi.list_combotrades()\n</code></pre> <p>Out</p> <pre><code>[\n    ComboTrade(\n        contract=ComboContract(\n            legs=[\n                ComboBase(\n                    security_type=&lt;SecurityType.Option: 'OPT'&gt;, \n                    exchange=&lt;Exchange.TAIFEX: 'TAIFEX'&gt;, \n                    code='TX516000L1', \n                    symbol='TX5202112016000C', \n                    name='\u81fa\u6307\u9078\u64c7\u6b0a12W5\u6708 16000C', \n                    category='TX5', \n                    delivery_month='202112', \n                    delivery_date='2021/12/29', \n                    strike_price=16000.0, \n                    option_right=&lt;OptionRight.Call: 'C'&gt;, \n                    underlying_kind='I', \n                    unit=1, \n                    limit_up=3630.0, \n                    limit_down=68.0, \n                    reference=1850.0, \n                    update_date='2021/12/23', \n                    action=&lt;Action.Sell: 'Sell'&gt;), \n                ComboBase(\n                    security_type=&lt;SecurityType.Option: 'OPT'&gt;, \n                    exchange=&lt;Exchange.TAIFEX: 'TAIFEX'&gt;, \n                    code='TX516000X1', \n                    symbol='TX5202112016000P', \n                    name='\u81fa\u6307\u9078\u64c7\u6b0a12W5\u6708 16000P', \n                    category='TX5', \n                    delivery_month='202112',\n                    delivery_date='2021/12/29',\n                    strike_price=16000.0, \n                    option_right=&lt;OptionRight.Put: 'P'&gt;, \n                    underlying_kind='I', \n                    unit=1, \n                    limit_up=1780.0, \n                    limit_down=0.1, \n                    reference=0.9, \n                    update_date='2021/12/23', \n                    action=&lt;Action.Sell: 'Sell'&gt;)\n                ]\n            ), \n        order=Order(\n            action=&lt;Action.Sell: 'Sell'&gt;, \n            price=1.0,\n            quantity=1, \n            id='46989de8', \n            seqno='743595', \n            ordno='000000', \n            account=Account(\n                account_type=&lt;AccountType.Future: 'F'&gt;, \n                person_id='YOUR_PERSON_ID', \n                broker_id='F002000', \n                account_id='1234567', \n                signed=True\n            ), \n            price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n            order_type=&lt;OrderType.IOC: 'IOC'&gt;, \n            octype=&lt;FuturesOCType.New: 'New'&gt;\n        ), \n        status=ComboStatus(\n            id='46989de8', \n            status=&lt;Status.Failed: 'Failed'&gt;, \n            status_code='99Q9', \n            order_datetime=datetime.datetime(2021, 12, 23, 8, 46, 47), \n            msg='\u53ef\u59d4\u8a17\u91d1\u984d\u4e0d\u8db3', \n            modified_price=1.0, \n            deals={}\n        )\n    )\n]\n</code></pre>"},{"location":"tutor/order/FutureOption/","title":"Futures and Option","text":"<p>Reminder </p> <p>First, you need to login and activate CA.</p>"},{"location":"tutor/order/FutureOption/#futures-order","title":"Futures Order","text":"<p>Order Attributes</p> <pre><code>price (float or int): the price of order\nquantity (int): the quantity of order\naction (str): order action to buy or sell\n    {Buy, Sell}\nprice_type (str): pricing type of order\n    {LMT, MKT, MKP}\norder_type (str): the type of order\n    {ROD, IOC, FOK}\noctype (str): the type or order to open new position or close position future only\n    {Auto, New, Cover, DayTrade} (\u81ea\u52d5\u3001\u65b0\u5009\u3001\u5e73\u5009\u3001\u7576\u6c96)\naccount (:obj:Account): which account to place this order\nca (binary): the ca of this order\n</code></pre>"},{"location":"tutor/order/FutureOption/#place-order","title":"Place Order","text":"<p>Product information ( <code>contract</code>) and order information ( <code>order</code>) must be provided when placing an order.</p> <p>Place Order</p> <pre><code>api.place_order?\n\n    Signature:\n        api.place_order(\n            contract: shioaji.contracts.Contract,\n            order: shioaji.order.Order,\n            timeout: int = 5000,\n            cb: Callable[[shioaji.order.Trade], NoneType] = None,\n        ) -&gt; shioaji.order.Trade\n    Docstring:\n    placing order\n</code></pre> <p>Contract</p> <pre><code>contract = api.Contracts.Futures.TXF.TXF202301\n</code></pre> <p>Order</p> version&gt;=1.0version&lt;1.0 <pre><code>order = api.Order(\n    action=sj.constant.Action.Buy,\n    price=14400,\n    quantity=3,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD, \n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\n</code></pre> <pre><code>order = api.Order(\n    action=sj.constant.Action.Buy,\n    price=14400,\n    quantity=3,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.FuturesOrderType.ROD, \n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\n</code></pre> <p>Place Order</p> <pre><code>trade = api.place_order(contract, order)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Future(\n        code='TXFA3', \n        symbol='TXF202301', \n        name='\u81fa\u80a1\u671f\u8ca801', \n        category='TXF', \n        delivery_month='202301', \n        delivery_date='2023/01/30', \n        underlying_kind='I', \n        unit=1, \n        limit_up=16270.0, \n        limit_down=13312.0, \n        reference=14791.0, \n        update_date='2023/01/12'\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=14400, \n        quantity=3, \n        id='5efffde1', \n        seqno='000004', \n        ordno='000003', \n        account=Account(\n            account_type=&lt;AccountType.Future: 'F'&gt;,\n            person_id='A123456789', \n            broker_id='F002000', \n            account_id='1234567', \n            signed=True\n        ), \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;\n    ), \n    status=OrderStatus(\n        id='5efffde1', \n        status=&lt;Status.PendingSubmit: 'PendingSubmit'&gt;, \n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 14, 56, 13, 995651), \n        deals=[]\n    )\n)\n</code></pre> <p>After <code>place_order</code>, you will also receive the information sent back from the exchange. For details, please refer to Order &amp; Deal Event.</p> <p>To update the <code>trade</code> status, you need to call <code>update_status</code>.</p> <p>Update Status</p> <pre><code>api.update_status(api.futopt_account)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Future(\n        code='TXFA3', \n        symbol='TXF202301', \n        name='\u81fa\u80a1\u671f\u8ca801', \n        category='TXF', \n        delivery_month='202301', \n        delivery_date='2023/01/30', \n        underlying_kind='I', \n        unit=1, \n        limit_up=16270.0, \n        limit_down=13312.0, \n        reference=14791.0, \n        update_date='2023/01/12'\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=14400, \n        quantity=3, \n        id='5efffde1', \n        seqno='000004', \n        ordno='000003', \n        account=Account(\n            account_type=&lt;AccountType.Future: 'F'&gt;,\n            person_id='A123456789', \n            broker_id='F002000', \n            account_id='1234567', \n            signed=True\n        ), \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;\n    ), \n    status=OrderStatus(\n        id='5efffde1', \n        status=&lt;Status.Submitted: 'Submitted'&gt;,\n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 14, 56, 13, 995651), \n        deals=[]\n    )\n)\n</code></pre> <p>Status of Trade</p> <ul> <li><code>PendingSubmit</code>: Sending</li> <li><code>PreSubmitted</code>: Reservation</li> <li><code>Submitted</code>: Send Successfully</li> <li><code>Failed</code>: Failed</li> <li><code>Cancelled</code>: Cancelled</li> <li><code>Filled</code>: Complete Fill</li> <li><code>Filling</code>: Part Fill</li> </ul>"},{"location":"tutor/order/FutureOption/#update-order","title":"Update Order","text":"<p>Update Order</p> <pre><code>api.update_order?\n\n    Signature:\n        api.update_order(\n            trade: shioaji.order.Trade,\n            price: Union[pydantic.types.StrictInt, float] = None,\n            qty: int = None,\n            timeout: int = 5000,\n            cb: Ca  lable[[shioaji.order.Trade], NoneType] = None,\n        ) -&gt; shioaji.order.Trade\n    Docstring: update the order price or qty\n</code></pre>"},{"location":"tutor/order/FutureOption/#update-price","title":"Update Price","text":"<p>Update Price</p> <pre><code>api.update_order(trade=trade, price=14450)\napi.update_status(api.futopt_account)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Future(\n        code='TXFA3', \n        symbol='TXF202301', \n        name='\u81fa\u80a1\u671f\u8ca801', \n        category='TXF', \n        delivery_month='202301', \n        delivery_date='2023/01/30', \n        underlying_kind='I', \n        unit=1, \n        limit_up=16270.0, \n        limit_down=13312.0, \n        reference=14791.0, \n        update_date='2023/01/12'\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=14400, \n        quantity=3, \n        id='5efffde1', \n        seqno='000004', \n        ordno='000003', \n        account=Account(\n            account_type=&lt;AccountType.Future: 'F'&gt;,\n            person_id='A123456789', \n            broker_id='F002000', \n            account_id='1234567', \n            signed=True\n        ), \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;\n    ), \n    status=OrderStatus(\n        id='5efffde1', \n        status=&lt;Status.Submitted: 'Submitted'&gt;,\n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 14, 56, 13, 995651), \n        modified_price=14450,\n        order_quantity=3,\n        deals=[]\n    )\n)\n</code></pre>"},{"location":"tutor/order/FutureOption/#update-quantity-reduce","title":"Update Quantity (Reduce)","text":"<p><code>update_order</code> can only reduce the quantity of the order.</p> <p>Update Quantity</p> <pre><code>api.update_order(trade=trade, qty=1)\napi.update_status(api.futopt_account)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Future(\n        code='TXFA3', \n        symbol='TXF202301', \n        name='\u81fa\u80a1\u671f\u8ca801', \n        category='TXF', \n        delivery_month='202301', \n        delivery_date='2023/01/30', \n        underlying_kind='I', \n        unit=1, \n        limit_up=16270.0, \n        limit_down=13312.0, \n        reference=14791.0, \n        update_date='2023/01/12'\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=14400, \n        quantity=3, \n        id='5efffde1', \n        seqno='000004', \n        ordno='000003', \n        account=Account(\n            account_type=&lt;AccountType.Future: 'F'&gt;,\n            person_id='A123456789', \n            broker_id='F002000', \n            account_id='1234567', \n            signed=True\n        ), \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;\n    ), \n    status=OrderStatus(\n        id='5efffde1', \n        status=&lt;Status.Submitted: 'Submitted'&gt;,\n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 14, 56, 13, 995651), \n        order_quantity=3,\n        cancel_quantity=1,\n        deals=[]\n    )\n)\n</code></pre>"},{"location":"tutor/order/FutureOption/#cancel-order","title":"Cancel Order","text":"<p>Cancel Order</p> <pre><code>api.cancel_order(trade)\napi.update_status(api.futopt_account)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Future(\n        code='TXFA3', \n        symbol='TXF202301', \n        name='\u81fa\u80a1\u671f\u8ca801', \n        category='TXF', \n        delivery_month='202301', \n        delivery_date='2023/01/30', \n        underlying_kind='I', \n        unit=1, \n        limit_up=16270.0, \n        limit_down=13312.0, \n        reference=14791.0, \n        update_date='2023/01/12'\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=14400, \n        quantity=3, \n        id='5efffde1', \n        seqno='000004', \n        ordno='000003', \n        account=Account(\n            account_type=&lt;AccountType.Future: 'F'&gt;,\n            person_id='A123456789', \n            broker_id='F002000', \n            account_id='1234567', \n            signed=True\n        ), \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;\n    ), \n    status=OrderStatus(\n        id='5efffde1', \n        status=&lt;Status.Cancelled: 'Cancelled'&gt;, \n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 14, 56, 13, 995651), \n        order_quantity=3,\n        cancel_quantity=3,\n        deals=[]\n    )\n)\n</code></pre>"},{"location":"tutor/order/FutureOption/#deal","title":"Deal","text":"<p>Update Status</p> <pre><code>api.update_status(api.futopt_account)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Future(\n        code='TXFA3', \n        symbol='TXF202301', \n        name='\u81fa\u80a1\u671f\u8ca801', \n        category='TXF', \n        delivery_month='202301', \n        delivery_date='2023/01/30', \n        underlying_kind='I', \n        unit=1, \n        limit_up=16270.0, \n        limit_down=13312.0, \n        reference=14791.0, \n        update_date='2023/01/12'\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=14400, \n        quantity=3, \n        id='5efffde1', \n        seqno='000004', \n        ordno='000003', \n        account=Account(\n            account_type=&lt;AccountType.Future: 'F'&gt;,\n            person_id='A123456789', \n            broker_id='F002000', \n            account_id='1234567', \n            signed=True\n        ), \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;\n    ), \n    status=OrderStatus(\n        id='5efffde1', \n        status=&lt;Status.Filled: 'Filled'&gt;,\n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 14, 56, 13, 995651), \n        order_quantity=3,\n        deals=[\n            Deal(seq='000001', price=14400, quantity=3, ts=1673501631.62918)\n        ]\n    )\n)\n</code></pre>"},{"location":"tutor/order/FutureOption/#examples","title":"Examples","text":"<p>Future and Option place order jupyter link</p>"},{"location":"tutor/order/FutureOption/#action","title":"Action","text":"<p>Buy</p> <pre><code>order = api.Order(\n    action=sj.constant.Action.Buy,\n    price=14400,\n    quantity=2,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD, \n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\n</code></pre> <p>Sell</p> <pre><code>order = api.Order(\n    action=sj.constant.Action.Sell,\n    price=14400,\n    quantity=2,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD, \n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\n</code></pre>"},{"location":"tutor/order/FutureOption/#rod-lmt","title":"ROD + LMT","text":"<p>ROD + LMT</p> <pre><code>order = api.Order(\n    action=sj.constant.Action.Sell,\n    price=14400,\n    quantity=2,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD, \n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\n</code></pre>"},{"location":"tutor/order/IntradayOdd/","title":"Intraday Odd","text":"<p>Reminder </p> <p>First, you need to login and activate CA.</p> <p>place intraday odd order jupyter link</p>"},{"location":"tutor/order/IntradayOdd/#place-order","title":"Place Order","text":"<p>In</p> <pre><code>contract = api.Contracts.Stocks.TSE.TSE0050\norder = api.Order(\n    price=90,\n    quantity=10,\n    action=sj.constant.Action.Buy,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,     \n    order_lot=sj.constant.StockOrderLot.IntradayOdd, \n    account=api.stock_account,\n)\n\ntrade = api.place_order(contract, order)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Stock(\n        exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n        code='0050', \n        symbol='TSE0050', \n        name='\u5143\u5927\u53f0\u706350', \n        category='00', \n        limit_up=115.8, \n        limit_down=94.8, \n        eference=105.3, \n        update_date='2020/09/21', \n        margin_trading_balance=15390, \n        short_selling_balance=2, \n        day_trade=&lt;DayTrade.Yes: 'Yes'&gt;\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=90.0, \n        quantity=10, \n        id='38e68afe', \n        seqno='482283', \n        ordno='WA313', \n        account=Account(\n            account_type=&lt;AccountType.Stock: 'S'&gt;, \n            person_id='YOUR_PERSON_ID', \n            broker_id='9A95', \n            account_id='0506112', \n            signed=True\n        ), \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;, \n        order_lot=&lt;StockOrderLot.IntradayOdd: 'IntradayOdd'&gt;\n    ), \n    status=OrderStatus(\n        id='38e68afe', \n        status=&lt;Status.Submitted: 'Submitted'&gt;, \n        status_code='00', \n        order_datetime=datetime.datetime(2020, 9, 21, 14, 38, 51), \n        deals=[]\n    )\n)\n</code></pre>"},{"location":"tutor/order/IntradayOdd/#update-order","title":"Update Order","text":"<p>Attention</p> <p>Intraday Odd cannot update price.</p> <p><code>update_order</code> can only reduce the quantity of the order.</p> <p>Update Quantity</p> <pre><code>api.update_order(trade=trade, qty=2)\napi.update_status(api.stock_account)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Stock(\n        exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n        code='0050', \n        symbol='TSE0050', \n        name='\u5143\u5927\u53f0\u706350', \n        category='00', \n        limit_up=115.8, \n        limit_down=94.8, \n        reference=105.3, \n        update_date='2020/09/21', \n        margin_trading_balance=15390, \n        short_selling_balance=2, \n        day_trade=&lt;DayTrade.Yes: 'Yes'&gt;\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=90.0, \n        quantity=10, \n        id='9b44c3b2', \n        seqno='482293', \n        ordno='WA328', \n        account=Account(\n            account_type=&lt;AccountType.Stock: 'S'&gt;, \n            person_id='YOUR_PERSON_ID', \n            broker_id='9A95', \n            account_id='0506112', \n            signed=True\n        ), \n    price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n    order_type=&lt;OrderType.ROD: 'ROD'&gt;, \n    order_lot=&lt;StockOrderLot.IntradayOdd: 'IntradayOdd'&gt;), \n    status=OrderStatus(\n        id='9b44c3b2', \n        status=&lt;Status.Submitted: 'Submitted'&gt;, \n        status_code='00', \n        order_datetime=datetime.datetime(2020, 9, 21, 14, 54, 36), \n        cancel_quantity=2, \n        deals=[]\n    )\n)\n</code></pre>"},{"location":"tutor/order/IntradayOdd/#cancel-order","title":"Cancel Order","text":"<p>Cancel Order</p> <pre><code>api.cancel_order(trade)\napi.update_status(api.stock_account)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Stock(\n        exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n        code='0050', \n        symbol='TSE0050', \n        name='\u5143\u5927\u53f0\u706350', \n        category='00', \n        limit_up=115.8, \n        limit_down=94.8, \n        reference=105.3, \n        update_date='2020/09/21', \n        margin_trading_balance=15390, \n        short_selling_balance=2, \n        day_trade=&lt;DayTrade.Yes: 'Yes'&gt;\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=90.0, \n        quantity=10, \n        id='9b44c3b2', \n        seqno='482293', \n        ordno='WA328', \n        account=Account(\n            account_type=&lt;AccountType.Stock: 'S'&gt;, \n            person_id='YOUR_PERSON_ID', \n            broker_id='9A95', \n            account_id='0506112', \n            signed=True\n        ), \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;, \n        order_lot=&lt;StockOrderLot.IntradayOdd: 'IntradayOdd'&gt;\n    ), \n    status=OrderStatus(\n        id='9b44c3b2', \n        status=&lt;Status.Cancelled: 'Cancelled'&gt;, \n        status_code='00', \n        order_datetime=datetime.datetime(2020, 9, 21, 14, 54, 36), \n        cancel_quantity=10,\n        deals=[]\n    )\n)\n</code></pre>"},{"location":"tutor/order/Reserve/","title":"Reserve Order","text":"<p>When Stock triggers some transaction abnormal conditions, it is necessary to <code>Reserve Order</code> in advance. Abnormal conditions include: watch out for stocks, warn about stocks, dispose of stocks, and manage stocks.</p> <p>Reminder </p> <ul> <li>First, you need to login and activate CA.</li> <li>Service hours are from 8:00 to 14:30 on trading days.</li> </ul>"},{"location":"tutor/order/Reserve/#get-stock-reserve-summay-status","title":"Get Stock Reserve Summay Status","text":"<p>In</p> <pre><code>reserve_summary_resp = api.stock_reserve_summary(account)\n</code></pre> <p>Out</p> <pre><code>ReserveStocksSummaryResponse(\n    response=ReserveStocksSummary(\n        stocks=[\n            ReserveStockSummary(\n                contract=Contract(\n                    security_type=&lt;SecurityType.Stock: 'STK'&gt;, \n                    exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n                    code='2890', \n                    name='\u6c38\u8c50\u91d1'\n                ),\n                available_share=5000, \n                reserved_share=0\n            )\n        ], \n        account=StockAccount(\n            person_id='X123456789', \n            broker_id='9A95', \n            account_id='12345678', \n            signed=True\n            )\n        )\n    )\n</code></pre>"},{"location":"tutor/order/Reserve/#reserve-stock","title":"Reserve Stock","text":"<p>In</p> <pre><code>contract = api.Contracts.Stocks[\"2890\"]\nresp = api.reserve_stock(account, contract, 1000)\n</code></pre> <p>Out</p> <pre><code>ReserveStockResponse(\n    response=ReserveOrderResp(\n        contract=Stock(\n            exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n            code='2890', \n            symbol='TSE2890', \n            name='\u6c38\u8c50\u91d1'\n        ), \n        account=StockAccount(\n            person_id='X123456789', \n            broker_id='9A95', \n            account_id='12345678', \n            signed=True), \n        share=1000, \n        status=True, \n        info=''\n    )\n)\n</code></pre>"},{"location":"tutor/order/Reserve/#get-stock-reserve-detail-satus","title":"Get Stock Reserve Detail Satus","text":"<p>In</p> <pre><code>resp = api.stock_reserve_detail(account)\n</code></pre> <p>Out</p> <pre><code>ReserveStocksDetailResponse(\n    response=ReserveStocksDetail(stocks=[\n            ReserveStockDetail(\n                contract=Contract(\n                    security_type=&lt;SecurityType.Stock: 'STK'&gt;, \n                    exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n                    code='6153', \n                    name='\u5609\u806f\u76ca'\n                ), \n                share=1000, \n                order_ts=1638253253, \n                status=True, \n                info='\u5df2\u5b8c\u6210'\n            )\n        ], \n        account=StockAccount(\n            person_id='X123456789', \n            broker_id='9A95', \n            account_id='12345678', \n            signed=True)\n        )\n)\n</code></pre>"},{"location":"tutor/order/Reserve/#reserve-earmarking","title":"Reserve Earmarking","text":"<p>In</p> <pre><code>contract = api.Contracts.Stocks[\"2890\"]\nresp = api.reserve_earmarking(account, contract, 1000, 15.15)\n</code></pre> <p>Out</p> <pre><code>ReserveEarmarkingResponse(\n    response=EarmarkingOrderResp(\n        contract=Stock(\n            exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n            code='2890', \n            symbol='TSE2890', \n            name='\u6c38\u8c50\u91d1', \n        ), \n        account=StockAccount(\n            person_id='X123456789', \n            broker_id='9A95', \n            account_id='12345678', \n            signed=True)\n        ), \n        share=1000, \n        price=15.15, \n        status=True, \n        info='OK')\n)\n</code></pre>"},{"location":"tutor/order/Reserve/#get-earmarking-detail-status","title":"Get Earmarking Detail Status","text":"<p>In</p> <pre><code>api.earmarking_detail(account)\n</code></pre> <p>Out</p> <pre><code>EarmarkStocksDetailResponse(\n    response=EarmarkStocksDetail(\n        stocks=[\n            EarmarkStockDetail(\n                contract=Contract(\n                    security_type=&lt;SecurityType.Stock: 'STK'&gt;, \n                    exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n                    code='2890', \n                    name='\u6c38\u8c50\u91d1'\n                ), \n                share=1000, \n                price=15.15, \n                amount=15171, \n                order_ts=1638416488, \n                status=False, \n                info='\u6263\u6b3e\u5931\u6557'), \n            EarmarkStockDetail(\n                contract=Contract(\n                    security_type=&lt;SecurityType.Stock: 'STK'&gt;, \n                    exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n                    code='2890', \n                    name='\u6c38\u8c50\u91d1'\n                ), \n                share=1000, \n                price=15.15, \n                amount=15171, \n                order_ts=1638415662, status=True, \n                info='')\n            ], \n            account=StockAccount(\n                person_id='X123456789', \n                broker_id='9A95', \n                account_id='12345678', \n                signed=True)\n            )\n        )\n    )\n</code></pre>"},{"location":"tutor/order/Reserve/#example","title":"Example","text":"<p>Query the reserve status of all accounts under your name.</p> <p>In</p> <pre><code>import shioaji as sj\n\napi = sj.Shioaji()\naccounts = api.login(\"YOUR_PERSON_ID\", \"YOUR_PASSWORD\", contracts_timeout=10000)\napi.activate_ca(\n    ca_path=\"/c/your/ca/path/Sinopac.pfx\",\n    ca_passwd=\"YOUR_CA_PASSWORD\",\n    person_id=\"Person of this Ca\",\n)\nfor account in accounts:\n    if account.account_type == AccountType.Stock:\n        reserve_summary_resp = api.stock_reserve_summary(account)\n        for reserve_stock_summary in reserve_summary_resp.response.stocks:\n                if reserve_stock_summary.available_share:\n                    resp = api.reserve_stock(\n                        account, \n                        reserve_stock_summary.contract,\n                        reserve_stock_summary.available_share\n                    )\n</code></pre>"},{"location":"tutor/order/Stock/","title":"Stock","text":"<p>Reminder </p> <p>First, you need to login and activate CA.</p>"},{"location":"tutor/order/Stock/#stock-order","title":"Stock Order","text":"<p>Order Attributes</p> version&gt;=1.0version&lt;1.0 <pre><code>price (float or int): the price of order\nquantity (int): the quantity of order\naction (str): order action to buy or sell\n    {Buy, Sell}\nprice_type (str): pricing type of order\n    {LMT, MKT, MKP} (\u9650\u50f9\u3001\u5e02\u50f9\u3001\u7bc4\u570d\u5e02\u50f9)\norder_type (str): the type of order\n    {ROD, IOC, FOK}\norder_cond (str): order condition stock only\n    {Cash, MarginTrading, ShortSelling} (\u73fe\u80a1\u3001\u878d\u8cc7\u3001\u878d\u5238)\norder_lot (str): the type of order\n    {Common, Fixing, Odd, IntradayOdd} (\u6574\u80a1\u3001\u5b9a\u76e4\u3001\u76e4\u5f8c\u96f6\u80a1\u3001\u76e4\u4e2d\u96f6\u80a1)\ndaytrade_short {bool}: the type of first sell\n    {True, False}\ncustom_field {str}: memo field, only letters and numbers are allowed, and the maximum length is 6.\naccount (:obj:Account): which account to place this order\nca (binary): the ca of this order\n</code></pre> <pre><code>price (float or int): the price of order\nquantity (int): the quantity of order\naction (str): order action to buy or sell\n    {Buy, Sell}\nprice_type (str): pricing type of order\n    {LMT, MKT, MKP} (\u9650\u50f9\u3001\u5e02\u50f9\u3001\u7bc4\u570d\u5e02\u50f9)\norder_type (str): the type of order\n    {ROD, IOC, FOK}\norder_cond (str): order condition stock only\n    {Cash, MarginTrading, ShortSelling} (\u73fe\u80a1\u3001\u878d\u8cc7\u3001\u878d\u5238)\norder_lot (str): the type of order\n    {Common, Fixing, Odd, IntradayOdd} (\u6574\u80a1\u3001\u5b9a\u76e4\u3001\u76e4\u5f8c\u96f6\u80a1\u3001\u76e4\u4e2d\u96f6\u80a1)\nfirst_sell {str}: the type of first sell\n    {true, false}\ncustom_field {str}: memo field, only letters and numbers are allowed, and the maximum length is 6.\naccount (:obj:Account): which account to place this order\nca (binary): the ca of this order\n</code></pre>"},{"location":"tutor/order/Stock/#place-order","title":"Place Order","text":"<p>Product information ( <code>contract</code>) and order information ( <code>order</code>) must be provided when placing an order.</p> <p>Place Order</p> <pre><code>api.place_order?\n\n    Signature:\n        api.place_order(\n            contract: shioaji.contracts.Contract,\n            order: shioaji.order.Order,\n            timeout: int = 5000,\n            cb: Callable[[shioaji.order.Trade], NoneType] = None,\n        ) -&gt; shioaji.order.Trade\n    Docstring:\n    placing order\n</code></pre> <p>Contract</p> <pre><code>contract = api.Contracts.Stocks.TSE.TSE2890\n</code></pre> <p>Order</p> version&gt;=1.0version&lt;1.0 <pre><code>order = api.Order(\n    price=17, \n    quantity=3, \n    action=sj.constant.Action.Buy, \n    price_type=sj.constant.StockPriceType.LMT, \n    order_type=sj.constant.OrderType.ROD, \n    order_lot=sj.constant.StockOrderLot.Common, \n    # daytrade_short=False,\n    custom_field=\"test\",\n    account=api.stock_account\n)\n</code></pre> <pre><code>order = api.Order(\n    price=17, \n    quantity=3, \n    action=sj.constant.Action.Buy, \n    price_type=sj.constant.TFTStockPriceType.LMT, \n    order_type=sj.constant.TFTOrderType.ROD, \n    order_lot=sj.constant.TFTStockOrderLot.Common, \n    # first_sell=sj.constant.StockFirstSell.No,\n    custom_field=\"test\",\n    account=api.stock_account\n)\n</code></pre> <p>Place Order</p> <pre><code>trade = api.place_order(contract, order)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Stock(\n        exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n        code='2890', \n        symbol='TSE2890', \n        name='\u6c38\u8c50\u91d1', \n        category='17', \n        unit=1000, \n        limit_up=19.05, \n        limit_down=15.65, \n        reference=17.35, \n        update_date='2023/01/12',\n        day_trade=&lt;DayTrade.Yes: 'Yes'&gt;\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=17, \n        quantity=3, \n        id='531e27af', \n        seqno='000002', \n        ordno='000001', \n        account=Account(\n            account_type=&lt;AccountType.Stock: 'S'&gt;,\n            person_id='A123456789', \n            broker_id='9A95', \n            account_id='1234567', \n            signed=True\n        ), \n        custom_field='test', \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;, \n        daytrade_short=False\n    ), \n    status=OrderStatus(\n        id='531e27af', \n        status=&lt;Status.PendingSubmit: 'PendingSubmit'&gt;, \n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 11, 18, 3, 867490), \n        deals=[]\n    )\n)\n</code></pre> <p>After <code>place_order</code>, you will also receive the information sent back from the exchange. For details, please refer to Order &amp; Deal Event.</p> <p>To update the <code>trade</code> status, you need to call <code>update_status</code>.</p> <p>Update Status</p> <pre><code>api.update_status(api.stock_account)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Stock(\n        exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n        code='2890', \n        symbol='TSE2890', \n        name='\u6c38\u8c50\u91d1', \n        category='17', \n        unit=1000, \n        limit_up=19.05, \n        limit_down=15.65, \n        reference=17.35, \n        update_date='2023/01/12',\n        day_trade=&lt;DayTrade.Yes: 'Yes'&gt;\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=17, \n        quantity=3, \n        id='531e27af', \n        seqno='000002', \n        ordno='000001', \n        account=Account(\n            account_type=&lt;AccountType.Stock: 'S'&gt;,\n            person_id='A123456789', \n            broker_id='9A95', \n            account_id='1234567', \n            signed=True\n        ), \n        custom_field='test', \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;, \n        daytrade_short=False\n    ), \n    status=OrderStatus(\n        id='531e27af', \n        status=&lt;Status.Submitted: 'Submitted'&gt;, \n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 11, 18, 3, 867490), \n        order_quantity=3,\n        deals=[]\n    )\n)\n</code></pre> <p>Status of Trade</p> <ul> <li><code>PendingSubmit</code>: Sending</li> <li><code>PreSubmitted</code>: Reservation</li> <li><code>Submitted</code>: Send Successfully</li> <li><code>Failed</code>: Failed</li> <li><code>Cancelled</code>: Cancelled</li> <li><code>Filled</code>: Complete Fill</li> <li><code>Filling</code>: Part Fill</li> </ul>"},{"location":"tutor/order/Stock/#update-order","title":"Update Order","text":"<p>Update Order</p> <pre><code>api.update_order?\n\n    Signature:\n        api.update_order(\n            trade: shioaji.order.Trade,\n            price: Union[pydantic.types.StrictInt, float] = None,\n            qty: int = None,\n            timeout: int = 5000,\n            cb: Ca  lable[[shioaji.order.Trade], NoneType] = None,\n        ) -&gt; shioaji.order.Trade\n    Docstring: update the order price or qty\n</code></pre>"},{"location":"tutor/order/Stock/#update-price","title":"Update Price","text":"<p>Update Price</p> <pre><code>api.update_order(trade=trade, price=17.5)\napi.update_status(api.stock_account)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Stock(\n        exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n        code='2890', \n        symbol='TSE2890', \n        name='\u6c38\u8c50\u91d1', \n        category='17', \n        unit=1000, \n        limit_up=19.05, \n        limit_down=15.65, \n        reference=17.35, \n        update_date='2023/01/12',\n        day_trade=&lt;DayTrade.Yes: 'Yes'&gt;\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=17, \n        quantity=3, \n        id='531e27af', \n        seqno='000002', \n        ordno='000001', \n        account=Account(\n            account_type=&lt;AccountType.Stock: 'S'&gt;,\n            person_id='A123456789', \n            broker_id='9A95', \n            account_id='1234567', \n            signed=True\n        ), \n        custom_field='test', \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;, \n        daytrade_short=False\n    ), \n    status=OrderStatus(\n        id='531e27af', \n        status=&lt;Status.Submitted: 'Submitted'&gt;, \n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 11, 18, 3, 867490), \n        modified_price=17.5,\n        order_quantity=3,\n        deals=[]\n    )\n)\n</code></pre>"},{"location":"tutor/order/Stock/#update-quantity-reduce","title":"Update Quantity (Reduce)","text":"<p><code>update_order</code> can only reduce the quantity of the order.</p> <p>Update Quantity</p> <pre><code>api.update_order(trade=trade, qty=1)\napi.update_status(api.stock_account)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Stock(\n        exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n        code='2890', \n        symbol='TSE2890', \n        name='\u6c38\u8c50\u91d1', \n        category='17', \n        unit=1000, \n        limit_up=19.05, \n        limit_down=15.65, \n        reference=17.35, \n        update_date='2023/01/12',\n        day_trade=&lt;DayTrade.Yes: 'Yes'&gt;\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=17, \n        quantity=3, \n        id='531e27af', \n        seqno='000002', \n        ordno='000001', \n        account=Account(\n            account_type=&lt;AccountType.Stock: 'S'&gt;,\n            person_id='A123456789', \n            broker_id='9A95', \n            account_id='1234567', \n            signed=True\n        ), \n        custom_field='test', \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;, \n        daytrade_short=False\n    ), \n    status=OrderStatus(\n        id='531e27af', \n        status=&lt;Status.Submitted: 'Submitted'&gt;, \n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 11, 18, 3, 867490), \n        order_quantity=3,\n        cancel_quantity=1,\n        deals=[]\n    )\n)\n</code></pre>"},{"location":"tutor/order/Stock/#cancel-order","title":"Cancel Order","text":"<p>Cancel Order</p> <pre><code>api.cancel_order(trade)\napi.update_status(api.stock_account)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Stock(\n        exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n        code='2890', \n        symbol='TSE2890', \n        name='\u6c38\u8c50\u91d1', \n        category='17', \n        unit=1000, \n        limit_up=19.05, \n        limit_down=15.65, \n        reference=17.35, \n        update_date='2023/01/12',\n        day_trade=&lt;DayTrade.Yes: 'Yes'&gt;\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=17, \n        quantity=3, \n        id='531e27af', \n        seqno='000002', \n        ordno='000001', \n        account=Account(\n            account_type=&lt;AccountType.Stock: 'S'&gt;,\n            person_id='A123456789', \n            broker_id='9A95', \n            account_id='1234567', \n            signed=True\n        ), \n        custom_field='test', \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;, \n        daytrade_short=False\n    ), \n    status=OrderStatus(\n        id='531e27af', \n        status=&lt;Status.Cancelled: 'Cancelled'&gt;, \n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 11, 18, 3, 867490), \n        order_quantity=3,\n        cancel_quantity=3,\n        deals=[]\n    )\n)\n</code></pre>"},{"location":"tutor/order/Stock/#deal","title":"Deal","text":"<p>Update Status</p> <pre><code>api.update_status(api.stock_account)\ntrade\n</code></pre> <p>Out</p> <pre><code>Trade(\n    contract=Stock(\n        exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n        code='2890', \n        symbol='TSE2890', \n        name='\u6c38\u8c50\u91d1', \n        category='17', \n        unit=1000, \n        limit_up=19.05, \n        limit_down=15.65, \n        reference=17.35, \n        update_date='2023/01/12',\n        day_trade=&lt;DayTrade.Yes: 'Yes'&gt;\n    ), \n    order=Order(\n        action=&lt;Action.Buy: 'Buy'&gt;, \n        price=17, \n        quantity=3, \n        id='531e27af', \n        seqno='000002', \n        ordno='000001', \n        account=Account(\n            account_type=&lt;AccountType.Stock: 'S'&gt;,\n            person_id='A123456789', \n            broker_id='9A95', \n            account_id='1234567', \n            signed=True\n        ), \n        custom_field='test', \n        price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n        order_type=&lt;OrderType.ROD: 'ROD'&gt;, \n        daytrade_short=False\n    ), \n    status=OrderStatus(\n        id='531e27af', \n        status=&lt;Status.Filled: 'Filled'&gt;,\n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 11, 18, 3, 867490), \n        order_quantity=3,\n        deals=[\n            Deal(seq='000001', price=17, quantity=3, ts=1673501631.62918)\n        ]\n    )\n)\n</code></pre>"},{"location":"tutor/order/Stock/#examples","title":"Examples","text":"<p>Stock place order jupyter link</p>"},{"location":"tutor/order/Stock/#action","title":"Action","text":"<p>Buy</p> <pre><code>order = api.Order(\n    price=12, \n    quantity=1, \n    action=sj.constant.Action.Buy, \n    price_type=sj.constant.StockPriceType.LMT, \n    order_type=sj.constant.OrderType.ROD, \n    order_lot=sj.constant.StockOrderLot.Common, \n    custom_field=\"test\",\n    account=api.stock_account\n)\n</code></pre> <p>Sell</p> <pre><code>order = api.Order(\n    price=12, \n    quantity=1, \n    action=sj.constant.Action.Sell, \n    price_type=sj.constant.StockPriceType.LMT, \n    order_type=sj.constant.OrderType.ROD, \n    order_lot=sj.constant.StockOrderLot.Common, \n    custom_field=\"test\",\n    account=api.stock_account\n)\n</code></pre> <p>Daytrade Short</p> version&gt;=1.0version&lt;1.0 <pre><code>order = api.Order(\n    price=12, \n    quantity=1, \n    action=sj.constant.Action.Sell,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    order_lot=sj.constant.StockOrderLot.Common,\n    daytrade_short=True,\n    custom_field=\"test\",\n    account=api.stock_account\n)\n</code></pre> <pre><code>order = api.Order(\n    price=12, \n    quantity=1, \n    action=sj.constant.Action.Sell,\n    price_type=sj.constant.TFTStockPriceType.LMT, \n    order_type=sj.constant.TFTOrderType.ROD, \n    order_lot=sj.constant.TFTStockOrderLot.Common, \n    first_sell=sj.constant.StockFirstSell.Yes,\n    custom_field=\"test\",\n    account=api.stock_account\n)\n</code></pre>"},{"location":"tutor/order/Stock/#rod-lmt","title":"ROD + LMT","text":"<p>ROD + LMT</p> version&gt;=1.0version&lt;1.0 <pre><code>order = api.Order(\n    price=12, \n    quantity=1, \n    action=sj.constant.Action.Sell,\n    price_type=sj.constant.StockPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD,\n    order_lot=sj.constant.StockOrderLot.Common,\n    custom_field=\"test\",\n    account=api.stock_account\n)\n</code></pre> <pre><code>order = api.Order(\n    price=12, \n    quantity=1, \n    action=sj.constant.Action.Sell,\n    price_type=sj.constant.TFTStockPriceType.LMT, \n    order_type=sj.constant.TFTOrderType.ROD, \n    order_lot=sj.constant.TFTStockOrderLot.Common, \n    custom_field=\"test\",\n    account=api.stock_account\n)\n</code></pre>"},{"location":"tutor/order/UpdateStatus/","title":"Update Status","text":"<p>Reminder </p> <p>First, you need to login and activate CA.</p> <p>Before obtaining the <code>Trade</code> status, it must be updated with <code>update_status</code>. If you cannot successfully <code>update_order</code> or <code>cancel_order</code>, you can use <code>update_status</code> to update the specific <code>trade</code> status, and check the <code>OrderStatus</code> in <code>trade</code>, whether it is available to modify the order.</p> <p>The update_status defaults to querying all accounts under the user's name. If you wish to inquire about a specific account, provide the account as a parameter to account.</p> <p>Update Status</p> <pre><code>api.update_status?\n</code></pre> <p>Out</p> <pre><code>Signature:\n    api.update_status(\n        account: shioaji.account.Account = None,\n        trade: shioaji.order.Trade = None,\n        timeout: int = 5000,\n        cb: Callable[[List[shioaji.order.Trade]], NoneType] = None,\n    )\nDocstring: update status of all trades you have\n</code></pre>"},{"location":"tutor/order/UpdateStatus/#get-stock-trades","title":"Get Stock Trades","text":"<p>Get Stock Trades</p> <pre><code>api.update_status(api.stock_account)\napi.list_trades()\n</code></pre> <p>Out</p> <pre><code>[\n    Trade(\n        contract=Stock(\n            exchange=&lt;Exchange.TSE: 'TSE'&gt;, \n            code='2890', \n            symbol='TSE2890', \n            name='\u6c38\u8c50\u91d1', \n            category='17', \n            unit=1000, \n            limit_up=19.05, \n            limit_down=15.65, \n            reference=17.35, \n            update_date='2023/01/12',\n            day_trade=&lt;DayTrade.Yes: 'Yes'&gt;\n        ), \n        order=Order(\n            action=&lt;Action.Buy: 'Buy'&gt;, \n            price=17, \n            quantity=3, \n            id='531e27af', \n            seqno='000002', \n            ordno='000001', \n            account=Account(\n                account_type=&lt;AccountType.Stock: 'S'&gt;,\n                person_id='A123456789', \n                broker_id='9A95', \n                account_id='1234567', \n                signed=True\n            ), \n            custom_field='test', \n            price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n            order_type=&lt;OrderType.ROD: 'ROD'&gt;, \n            daytrade_short=True\n        ), \n        status=OrderStatus(\n            id='531e27af', \n            status=&lt;Status.Filled: 'Filled'&gt;,\n            status_code='00', \n            order_datetime=datetime.datetime(2023, 1, 12, 11, 18, 3, 867490), \n            order_quantity=3,\n            deals=[\n                Deal(seq='000001', price=17, quantity=3, ts=1673501631.62918)\n            ]\n        )\n    )\n]\n</code></pre>"},{"location":"tutor/order/UpdateStatus/#get-futures-trades","title":"Get Futures Trades","text":"<p>Get Futures Trades</p> <pre><code>api.update_status(api.futopt_account)\napi.list_trades()\n</code></pre> <p>Out</p> <pre><code>[\n    Trade(\n        contract=Future(\n            code='TXFA3', \n            symbol='TXF202301', \n            name='\u81fa\u80a1\u671f\u8ca801', \n            category='TXF', \n            delivery_month='202301', \n            delivery_date='2023/01/30', \n            underlying_kind='I', \n            unit=1, \n            limit_up=16270.0, \n            limit_down=13312.0, \n            reference=14791.0, \n            update_date='2023/01/12'\n        ), \n        order=Order(\n            action=&lt;Action.Buy: 'Buy'&gt;, \n            price=14400, \n            quantity=3, \n            id='5efffde1', \n            seqno='000004', \n            ordno='000003', \n            account=Account(\n                account_type=&lt;AccountType.Future: 'F'&gt;,\n                person_id='A123456789', \n                broker_id='F002000', \n                account_id='1234567', \n                signed=True\n            ), \n            price_type=&lt;StockPriceType.LMT: 'LMT'&gt;, \n            order_type=&lt;OrderType.ROD: 'ROD'&gt;\n        ), \n        status=OrderStatus(\n            id='5efffde1', \n            status=&lt;Status.Filled: 'Filled'&gt;,\n            status_code='00', \n            order_datetime=datetime.datetime(2023, 1, 12, 14, 56, 13, 995651), \n            order_quantity=3,\n            deals=[\n                Deal(seq='000001', price=14400, quantity=3, ts=1673501631.62918)\n            ]\n        )\n    )\n]\n</code></pre>"},{"location":"tutor/order/UpdateStatus/#update-specific-trade","title":"Update Specific Trade","text":"<p>Update Trade</p> <pre><code># you can get trade from place_order\n# trade = api.place_order(contract, order)\n\n# or get from api.list_trades\n# trade = api.list_trades()[0]\n\napi.update_status(trade=trade)\n</code></pre>"},{"location":"tutor/order/UpdateStatus/#trade-status","title":"Trade Status","text":"<p>OrderStatus</p> <pre><code>id (str): the id uses to correlate the order object\nstatus (:obj:Status): the status of order {Cancelled, Filled, PartFilled, Failed, PendingSubmit, PreSubmitted, Submitted}\nstatus_code (str): the code of status\norder_datetime (datetime): order time\norder_quantity (int): order quantity\nmodified_price (float): the price of modification\ncancel_quantity (int): the quantity of cancel\ndeals (:List:Deal): information of filled order\n</code></pre> <p>Deal</p> <pre><code>seq (str): deal sequence number\nprice (int or float): deal price\nquantity (int): deal quantity\nts (float): deal timestamp\n</code></pre>"},{"location":"tutor/order/order_deal_event/futures/","title":"Futures","text":""},{"location":"tutor/order/order_deal_event/futures/#order-callback","title":"Order CallBack","text":"<p>When the exchange receives the order, it will return the callback. The callback is divided into four parts, including operation, order, status and contract. We will explain in detail below.</p> <p>Order Event</p> version&gt;=1.0version&lt;1.0 <pre><code>OrderState.FuturesOrder {\n    'operation': {\n        'op_type': 'New', \n        'op_code': '00', \n        'op_msg': ''\n    }, \n    'order': {\n        'id': 'fcb42a6e', \n        'seqno': '585886', \n        'ordno': '00', \n        'account': {\n            'account_type': 'F', \n            'person_id': '', \n            'broker_id': 'F002000', \n            'account_id': '1234567', \n            'signed': True\n        }, \n        'action': 'Buy', \n        'price': 14000.0, \n        'quantity': 1, \n        'order_type': 'ROD', \n        'price_type': 'LMT', \n        'market_type': 'Night', \n        'oc_type': 'New', \n        'subaccount': '', \n        'combo': False\n    }, \n    'status': {\n        'id': 'fcb42a6e', \n        'exchange_ts': 1673512283.0, \n        'modified_price': 0.0, \n        'cancel_quantity': 0, \n        'order_quantity': 1, \n        'web_id': 'Z'\n    }, \n    'contract': {\n        'security_type': 'FUT', \n        'code': 'TXF', \n        'exchange': 'TIM', \n        'delivery_month': '202301', \n        'delivery_date': '', \n        'strike_price': 0.0, \n        'option_right': 'Future'\n    }\n}\n</code></pre> <pre><code>OrderState.FOrder {\n    'operation': {\n        'op_type': 'New', \n        'op_code': '00', \n        'op_msg': ''\n    }, \n    'order': {\n        'id': 'fcb42a6e', \n        'seqno': '585886', \n        'ordno': '00', \n        'account': {\n            'account_type': 'F', \n            'person_id': '', \n            'broker_id': 'F002000', \n            'account_id': '1234567', \n            'signed': True\n        }, \n        'action': 'Buy', \n        'price': 14000.0, \n        'quantity': 1, \n        'order_type': 'ROD', \n        'price_type': 'LMT', \n        'market_type': 'Night', \n        'oc_type': 'New', \n        'subaccount': '', \n        'combo': False\n    }, \n    'status': {\n        'id': 'fcb42a6e', \n        'exchange_ts': 1673512283.0, \n        'modified_price': 0.0, \n        'cancel_quantity': 0, \n        'order_quantity': 1, \n        'web_id': 'Z'\n    }, \n    'contract': {\n        'security_type': 'FUT', \n        'code': 'TXF', \n        'exchange': 'TIM', \n        'delivery_month': '202301', \n        'delivery_date': '', \n        'strike_price': 0.0, \n        'option_right': 'Future'\n    }\n}\n</code></pre> <p>Order CallBack Info.</p> <p>operation <pre><code>op_type (str): {\n            \"New\": new order, \n            \"Cancel\": cancel order, \n            \"UpdatePrice\": update price, \n            \"UpdateQty\": update quantity\n        }\nop_code (str): {\"00\": success, others: fail}\nop_msg (str): error message\n</code></pre> order <pre><code>id (str): same as the trade_id in FuturesDeal\nseqno (str): sequence number\nordno (str): order number\naccount (dict): account info\naction (str): {Buy, Sell}\nprice (float or int): order price\nquantity (int): order quantity\norder_type (str): the type of order {ROD, IOC, FOK}\nprice_type (str): pricing type of order {LMT, MKT, MKP}\nmarket_type (str): {Day, Night}\noc_type (str): {New: \u65b0\u5009, Cover: \u5e73\u5009, Auto: \u81ea\u52d5}\nsubaccount (str): subaccount\ncombo (bool): whether order is combo order\n</code></pre> status <pre><code>id (str): same as the trade_id in FuturesDeal\nexchange_ts (int): exchange time\nmodified_price (float or int): modified price\ncancel_quantity (int): cancel quantity\norder_quantity (int): irder quantity\nweb_id (str): web id\n</code></pre> contract <pre><code>security_type (str): security type\ncode (str): code id\nexchange (str): exchange\ndelivery_month (str): delivery month\ndelivery_date (str): delivery date\nstrike_price (float): strike price\noption_right (str): {Future, OptionCall, OptionPut}\n</code></pre></p>"},{"location":"tutor/order/order_deal_event/futures/#deal-callback","title":"Deal CallBack","text":"<p>When the matching is successful, the exchange will send a transaction report notification. Successful matching includes partial transactions and complete transactions. You can confirm whether it is the same order from the <code>id</code> in the order callback to the <code>trade_id</code> in the deal callback.</p> <p>Deal Event</p> version&gt;=1.0version&lt;1.0 <pre><code>OrderState.FuturesDeal {\n    'trade_id': '4e6df0f6', \n    'seqno': '458545', \n    'ordno': 'tA0deX1O', \n    'exchange_seq': 'j5006396', \n    'broker_id': 'F002000', \n    'account_id': '1234567', \n    'action': 'Sell', \n    'code': 'TXO', \n    'price': 58.0, \n    'quantity': 1, \n    'subaccount': '', \n    'security_type': 'OPT', \n    'delivery_month': '202301', \n    'strike_price': 14300.0, \n    'option_right': 'OptionPut', \n    'market_type': 'Day', \n    'combo': False, \n    'ts': 1673270852.0\n}\n</code></pre> <pre><code>OrderState.FDeal {\n    'trade_id': '4e6df0f6', \n    'seqno': '458545', \n    'ordno': 'tA0deX1O', \n    'exchange_seq': 'j5006396', \n    'broker_id': 'F002000', \n    'account_id': '1234567', \n    'action': 'Sell', \n    'code': 'TXO', \n    'price': 58.0, \n    'quantity': 1, \n    'subaccount': '', \n    'security_type': 'OPT', \n    'delivery_month': '202301', \n    'strike_price': 14300.0, \n    'option_right': 'OptionPut', \n    'market_type': 'Day', \n    'combo': False, \n    'ts': 1673270852.0\n}\n</code></pre> <p>FuturesDeal</p> <pre><code>trade_id (str): same as the id in FuturesOrder\nseqno (str): sequence number\nordno (str): The first 5 characters is the same as ordno in FuturesOrder. The last 3 characters represent the deal sequence number.\nexchange_seq (str): exchange sequence number\nbroker_id (str): broker id\naccount_id (str): account\naction (str): buy/sell\ncode (str): code\nprice (float or int): deal price\nquantity (int): deal quantity\nsubaccount (str): subaccount\nsecurity_type (str): security type\ndelivery_month (str): delivery month\nstrike_price (float): strike price\noption_right (str): {Future, OptionCall, OptionPut}\nmarket_type (str): {Day, Night}\nts (int): deal timestamp    \n</code></pre> <p>Note</p> <p>you \"may\" recieve the deal event sooner than the order event due to message priority in exchange.</p>"},{"location":"tutor/order/order_deal_event/futures/#handle-callback","title":"Handle Callback","text":"<p>If you would like to handle callback info, please refer to Callback.</p>"},{"location":"tutor/order/order_deal_event/stocks/","title":"Stock","text":""},{"location":"tutor/order/order_deal_event/stocks/#order-callback","title":"Order CallBack","text":"<p>When the exchange receives the order, it will return the callback. The callback is divided into four parts, including operation, order, status and contract. We will explain in detail below.</p> <p>Order Event</p> version&gt;=1.0version&lt;1.0 <pre><code>OrderState.StockOrder {\n    'operation': {\n        'op_type': 'New', \n        'op_code': '00', \n        'op_msg': ''\n    }, \n    'order': {\n        'id': '97b63e2f', \n        'seqno': '267677', \n        'ordno': 'IM394', \n        'account': {\n            'account_type': 'S', \n            'person_id': '', \n            'broker_id': '9A95', \n            'account_id': '1234567', \n            'signed': True\n        }, \n        'action': 'Buy', \n        'price': 16.0, \n        'quantity': 1, \n        'order_type': 'ROD', \n        'price_type': 'LMT', \n        'order_cond': 'Cash', \n        'order_lot': 'Common', \n        'custom_field': 'test'\n    }, \n    'status': {\n        'id': '97b63e2f', \n        'exchange_ts': 1673576134.038, \n        'modified_price': 0.0, \n        'cancel_quantity': 0, \n        'order_quantity': 1, \n        'web_id': '137'\n    }, \n    'contract': {\n        'security_type': 'STK', \n        'exchange': 'TSE', \n        'code': '2890', \n        'symbol': '', \n        'name': '', \n        'currency': 'TWD'\n    }\n}\n</code></pre> <pre><code>OrderState.TFTOrder {\n    'operation': {\n        'op_type': 'New', \n        'op_code': '00', \n        'op_msg': ''\n    }, \n    'order': {\n        'id': '97b63e2f', \n        'seqno': '267677', \n        'ordno': 'IM394', \n        'account': {\n            'account_type': 'S', \n            'person_id': '', \n            'broker_id': '9A95', \n            'account_id': '1234567', \n            'signed': True\n        }, \n        'action': 'Buy', \n        'price': 16.0, \n        'quantity': 1, \n        'order_type': 'ROD', \n        'price_type': 'LMT', \n        'order_cond': 'Cash', \n        'order_lot': 'Common', \n        'custom_field': 'test'\n    }, \n    'status': {\n        'id': '97b63e2f', \n        'exchange_ts': 1673576134.038, \n        'modified_price': 0.0, \n        'cancel_quantity': 0, \n        'order_quantity': 1, \n        'web_id': '137'\n    }, \n    'contract': {\n        'security_type': 'STK', \n        'exchange': 'TSE', \n        'code': '2890', \n        'symbol': '', \n        'name': '', \n        'currency': 'TWD'\n    }\n}\n</code></pre> <p>Order CallBack Info.</p> <p>operation <pre><code>op_type (str): {\n        \"New\": new order, \n        \"Cancel\": cancel order, \n        \"UpdatePrice\": update price, \n        \"UpdateQty\": update quantity\n    }\nop_code (str): {\"00\": success, others: fail}\nop_msg (str): error message\n</code></pre> order <pre><code>id (str): same as the trade_id in SDeal\nseqno (str): sequence number\nordno (str): order number\naccount (dict): account info\naction (str): {Buy, Sell}\nprice (float or int): order price\nquantity (int): order quantity\norder_type (str): the type of order {ROD, IOC, FOK}\nprice_type (str): pricing type of order {LMT, MKT, MKP}\norder_cond (str): {\n            Cash: \u73fe\u80a1, \n            MarginTrading: \u878d\u8cc7, \n            ShortSelling: \u878d\u5238\n        }\norder_lot (str): {\n            Common: \u6574\u80a1, \n            Fixing: \u5b9a\u76e4, \n            Odd: \u76e4\u5f8c\u96f6\u80a1, \n            IntradayOdd: \u76e4\u4e2d\u96f6\u80a1\n        }\ncustom_field (str): memo field\n</code></pre> status <pre><code>id (str): same as the trade_id in SDeal\nexchange_ts (int): exchange time\nmodified_price (float or int): modified price\ncancel_quantity (int): cancel quantity\norder_quantity (int): order quantity\nweb_id (str): web id\n</code></pre> contract <pre><code>security_type (str): security type\nexchange (str): exchange\ncode (str): code id\nsymbol (str): symbol\nname (str): name\ncurrency (str): currency\n</code></pre></p>"},{"location":"tutor/order/order_deal_event/stocks/#deal-callback","title":"Deal CallBack","text":"<p>When the matching is successful, the exchange will send a transaction report notification. Successful matching includes partial transactions and complete transactions. You can confirm whether it is the same order from the <code>id</code> in the order callback to the <code>trade_id</code> in the deal callback.</p> <p>Deal Event</p> version&gt;=1.0version&lt;1.0 <pre><code>OrderState.StockDeal {\n    'trade_id': '9c6ae2eb', \n    'seqno': '269866', \n    'ordno': 'IN497', \n    'exchange_seq': '669915', \n    'broker_id': '9A95', \n    'account_id': '1234567', \n    'action': 'Buy', \n    'code': '2890', \n    'order_cond': 'Cash', \n    'order_lot': 'IntradayOdd', \n    'price': 267.5, \n    'quantity': 3, \n    'web_id': '137', \n    'custom_field': 'test', \n    'ts': 1673577256.354\n}\n</code></pre> <pre><code>OrderState.TFTDeal {\n    'trade_id': '9c6ae2eb', \n    'seqno': '269866', \n    'ordno': 'IN497', \n    'exchange_seq': '669915', \n    'broker_id': '9A95', \n    'account_id': '1234567', \n    'action': 'Buy', \n    'code': '2890', \n    'order_cond': 'Cash', \n    'order_lot': 'IntradayOdd', \n    'price': 267.5, \n    'quantity': 3, \n    'web_id': '137', \n    'custom_field': 'test', \n    'ts': 1673577256.354\n}\n</code></pre> <p>Deal Callback Info.</p> <pre><code>trade_id (str): same as the id in StockOrder\nseqno (str): sequence number\nordno (str): The first 5 characters is the same as ordno in StockOrder. The last 3 characters represent the deal sequence number.\nexchange_seq (str): exchange sequence number\nbroker_id (str): broker id\naccount_id (str): account\naction (str): {Buy, Sell}\ncode (str): code id\norder_cond (str): {\n            Cash: \u73fe\u80a1, \n            MarginTrading: \u878d\u8cc7, \n            ShortSelling: \u878d\u5238\n        }\norder_lot (str): {\n            Common: \u6574\u80a1, \n            Fixing: \u5b9a\u76e4, \n            Odd: \u76e4\u5f8c\u96f6\u80a1, \n            IntradayOdd: \u76e4\u4e2d\u96f6\u80a1\n        }\nprice (float or int): deal price\nquantity (int): deal quantity\nweb_id (str): web id\ncustom_field (str): memo field\nts (int): deal timestamp    \n</code></pre> <p>Note</p> <p>you \"may\" recieve the deal event sooner than the order event due to message priority in exchange.</p>"},{"location":"tutor/order/order_deal_event/stocks/#handle-callback","title":"Handle Callback","text":"<p>If you would like to handle callback info, please refer to Callback.</p>"},{"location":"tutor/prepare/example_testing_flow/","title":"Example Project For Testing Flow","text":"<p>First, we extend the project <code>sj-trading</code> created using <code>uv</code> in the environment creation chapter to add the testing flow part.</p> <p>The complete project code can be referred to sj-trading https://github.com/Sinotrade/sj-trading-demo.</p> <p>You can use <code>git</code> to clone the entire environment to your local machine and use it directly.</p> <p>Download Project</p> <pre><code>git clone https://github.com/Sinotrade/sj-trading-demo.git\ncd sj-trading-demo\n</code></pre> <p>Next, we will step by step introduce how to add the testing flow.</p>"},{"location":"tutor/prepare/example_testing_flow/#shioaji-version","title":"Shioaji Version","text":"<p>Get Shioaji version information</p> <p>Add Version Information</p> <p>Add the following content to <code>src/sj_trading/__init__.py</code></p> <pre><code>def show_version() -&gt; str:\n    print(f\"Shioaji Version: {sj.__version__}\")\n    return sj.__version__\n</code></pre> <p>Add <code>version</code> Command to Project</p> <p>Add <code>version</code> command to <code>pyproject.toml</code></p> <pre><code>[project.scripts]\nversion = \"sj_trading:show_version\"\n</code></pre> <p>Execute <code>uv run version</code> to see the Shioaji version information</p> <pre><code>Shioaji Version: 1.2.0\n</code></pre>"},{"location":"tutor/prepare/example_testing_flow/#stock-testing","title":"Stock Testing","text":"<p>Add Stock Testing File</p> <p>Add file <code>testing_flow.py</code> to <code>src/sj_trading</code></p> <p>Add the following content <pre><code>import shioaji as sj\nfrom shioaji.constant import Action, StockPriceType, OrderType\nimport os\n\ndef testing_stock_ordering():\n    # Login to the testing environment\n    api = sj.Shioaji(simulation=True)\n    accounts = api.login(\n        api_key=os.environ[\"API_KEY\"],\n        secret_key=os.environ[\"SECRET_KEY\"],\n    )\n    # Show all available accounts\n    print(f\"Available accounts: {accounts}\")\n    api.activate_ca(\n        ca_path=os.environ[\"CA_CERT_PATH\"],\n        ca_passwd=os.environ[\"CA_PASSWORD\"],\n    )\n\n    # Prepare the Contract for Ordering\n    # Use 2890 Fubon Financial as an example\n    contract = api.Contracts.Stocks[\"2890\"]\n    print(f\"Contract: {contract}\")\n\n    # Create an Order for Ordering\n    order = sj.order.StockOrder(\n        action=Action.Buy, # Buy\n        price=contract.reference, # Buy at the reference price\n        quantity=1, # Order quantity\n        price_type=StockPriceType.LMT, # Limit price order\n        order_type=OrderType.ROD, # Effective for the day\n        account=api.stock_account, # Use the default account\n    )\n    print(f\"Order: {order}\")\n\n    # Send the order\n    trade = api.place_order(contract=contract, order=order)\n    print(f\"Trade: {trade}\")\n\n    # Update the status\n    api.update_status()\n    print(f\"Status: {trade.status}\")\n</code></pre></p> <p>Add <code>stock_testing</code> Command to Project</p> <p>Add <code>stock_testing</code> command to <code>pyproject.toml</code></p> <pre><code>[project.scripts]\nstock_testing = \"sj_trading.testing_flow:testing_stock_ordering\"\n</code></pre> <p>Execute <code>uv run stock_testing</code> to start testing stock ordering</p>"},{"location":"tutor/prepare/example_testing_flow/#futures-testing","title":"Futures Testing","text":"<p>Add Futures Testing Content</p> <p>Add the following content to <code>src/sj_trading/testing_flow.py</code></p> <pre><code>from shioaji.constant import (\n    FuturesPriceType,\n    FuturesOCType,\n)\n\ndef testing_futures_ordering():\n    # Login to the testing environment\n    api = sj.Shioaji(simulation=True)\n    accounts = api.login(\n        api_key=os.environ[\"API_KEY\"],\n        secret_key=os.environ[\"SECRET_KEY\"],\n    )\n    # Show all available accounts\n    print(f\"Available accounts: {accounts}\")\n    api.activate_ca(\n        ca_path=os.environ[\"CA_CERT_PATH\"],\n        ca_passwd=os.environ[\"CA_PASSWORD\"],\n    )\n\n    # Get the contract for ordering\n    # Use TXFR1 as an example\n    contract = api.Contracts.Futures[\"TXFR1\"]\n    print(f\"Contract: {contract}\")\n\n    # Create an Order for Ordering\n    order = sj.order.FuturesOrder(\n        action=Action.Buy,  # Buy\n        price=contract.reference,  # Buy at the reference price\n        quantity=1,  # Order quantity\n        price_type=FuturesPriceType.LMT,  # Limit price order\n        order_type=OrderType.ROD,  # Effective for the day\n        octype=FuturesOCType.Auto,  # Auto select new close\n        account=api.futopt_account,  # Use the default account\n    )\n    print(f\"Order: {order}\")\n\n    # Send the order\n    trade = api.place_order(contract=contract, order=order)\n    print(f\"Trade: {trade}\")\n\n    # Update the status\n    api.update_status()\n    print(f\"Status: {trade.status}\")\n</code></pre> <p>Add <code>futures_testing</code> Command to Project</p> <p>Add <code>futures_testing</code> command to <code>pyproject.toml</code></p> <pre><code>[project.scripts]\nfutures_testing = \"sj_trading.testing_flow:testing_futures_ordering\"\n</code></pre> <p>Execute <code>uv run futures_testing</code> to start testing futures ordering</p>"},{"location":"tutor/prepare/open_account/","title":"Open Account","text":"<p>To use Shioaji, you must have a SinoPac Securities account. If you do not have a SinoPac Securities account yet, please follow the steps below to open an account:</p> <ol> <li>To Open Account Page.      </li> <li>If you do not have a bank account with Bank SinoPac, please open a bank account as your delivery account.     </li> <li>Please select\u6211\u8981\u958bDAWHO+\u5927\u6236\u6295, to open a bank account and a securities account.     </li> <li>Complete bank and securities account opening.</li> </ol>"},{"location":"tutor/prepare/terms/","title":"Terms of service","text":"<p>Restricted by Taiwan's financial regulations, new users need to sign relevant documents and complete a test report in the simulation mode before using it in a production environment.</p>"},{"location":"tutor/prepare/terms/#sign-documents","title":"Sign Documents","text":"<p>Please refer to sign center and read the documents carefully before you sign.   </p>"},{"location":"tutor/prepare/terms/#test-report","title":"Test Report","text":"<p>To ensure that you fully understand how to use Shioaji, you need to complete the test in the simulation mode, which includes the following functions:</p> <ul> <li><code>login</code></li> <li><code>place_order</code></li> </ul> <p>Attention</p> <p>Service Hour:</p> <ul> <li>In response to the company's information security regulations, the test service is Monday to Friday 08:00 ~ 20:00</li> <li>18:00 ~ 20:00: Only allow Taiwan IP</li> <li>08:00 ~ 18:00: No limit</li> </ul> <p>Version Restriction:  </p> <ul> <li>version &gt;= 1.2:     install command: <code>uv add shioaji</code> or <code>pip install -U shioaji</code></li> </ul> <p>Others:  </p> <ul> <li>You should sign the API related document before you test!</li> <li>Stock and Futures account should be test separately.</li> <li>The time interval between stock place order test and futures place order test should be more than 1 second.</li> </ul>"},{"location":"tutor/prepare/terms/#version-check","title":"Version Check","text":"<p>version</p> <pre><code>import shioaji as sj\n\nprint(sj.__version__)\n# 1.0.0\n</code></pre> <ul> <li>please note the Version Restriction.</li> </ul>"},{"location":"tutor/prepare/terms/#login-test","title":"Login Test","text":"<p>Login</p> version&gt;=1.0version&lt;1.0 <pre><code>api = sj.Shioaji(simulation=True)   # Simulation Mode\napi.login(\n    api_key=\"YOUR_API_KEY\",         # edit it\n    secret_key=\"YOUR_SECRET_KEY\"    # edit it\n)\n</code></pre> <pre><code>api = sj.Shioaji(simulation=True)   # Simulation Mode\napi.login(\n    person_id=\"YOUR_PERSON_ID\",     # edit it\n    passwd=\"YOUR_PASSWORD\",         # edit it\n)\n</code></pre> <ul> <li>version &gt;= 1.0: use <code>api_key</code> to login, if you haven't applied for the API Key, please refer to Token section.</li> <li>version &lt; 1.0: use <code>person_id</code> to login.</li> </ul>"},{"location":"tutor/prepare/terms/#place-order-test-stock","title":"Place Order Test - Stock","text":"<p>Stock Order</p> version&gt;=1.0version&lt;1.0 <pre><code># contract - edit it\ncontract = api.Contracts.Stocks.TSE[\"2890\"]\n\n# order - edit it\norder = api.Order(\n    price=18, \n    quantity=1, \n    action=sj.constant.Action.Buy, \n    price_type=sj.constant.StockPriceType.LMT, \n    order_type=sj.constant.OrderType.ROD, \n    account=api.stock_account\n)\n\n# place order\ntrade = api.place_order(contract, order)\ntrade\n</code></pre> <pre><code># contract - edit it\ncontract = api.Contracts.Stocks.TSE[\"2890\"]\n\n# order - edit it\norder = api.Order(\n    price=18, \n    quantity=1, \n    action=sj.constant.Action.Buy, \n    price_type=sj.constant.TFTStockPriceType.LMT, \n    order_type=sj.constant.TFTOrderType.ROD, \n    account=api.stock_account\n)\n\n# place order\ntrade = api.place_order(contract, order)\ntrade\n</code></pre> <p>Out</p> <pre><code>Response Code: 0 | Event Code: 0 | Info: host '218.32.76.102:80', IP 218.32.76.102:80 (host 1 of 1) (host connection attempt 1 of 1) (total connection attempt 1 of 1) | Event: Session up\n\nTrade(\n    contract=Stock(...), \n    order=Order(...),\n    status=OrderStatus(\n        id='531e27af', \n        status=&lt;Status.Submitted: 'Submitted'&gt;, \n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 11, 18, 3, 867490), \n        order_quantity=1,\n        deals=[]\n    )\n)\n</code></pre> <ul> <li> <p>You should receive the message, <code>Response Code: 0 | Event Code: 0 | Info: host '218.32.76.102:80' ...</code>, which means that you have successfully connected to our testing server. The message will only appear on your first order. If you don't receive the connected message, please confirm that all the following conditions are met.</p> <ol> <li>Doing test in the service hour</li> <li>Version restriction</li> <li><code>signed</code> is not present in your account</li> </ol> </li> <li> <p>order status should NOT be <code>Failed</code>. If you got <code>Failed</code> status, please modify your order correctly and then <code>place_order</code> again.</p> </li> <li>Contract</li> <li>Stock Order</li> </ul>"},{"location":"tutor/prepare/terms/#place-order-test-futures","title":"Place Order Test - Futures","text":"<p>Future Order</p> verion&gt;=1.0verion&lt;1.0 <pre><code># near-month TXF - edit it\ncontract = min(\n    [\n        x for x in api.Contracts.Futures.TXF \n        if x.code[-2:] not in [\"R1\", \"R2\"]\n    ],\n    key=lambda x: x.delivery_date\n)\n\n# order - edit it\norder = api.Order(\n    action=sj.constant.Action.Buy,\n    price=15000,\n    quantity=1,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.OrderType.ROD, \n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\n\n# place order\ntrade = api.place_order(contract, order)\ntrade\n</code></pre> <pre><code># near-month TXF - edit it\ncontract = min(\n    [\n        x for x in api.Contracts.Futures.TXF \n        if x.code[-2:] not in [\"R1\", \"R2\"]\n    ],\n    key=lambda x: x.delivery_date\n)\n\n# order - edit it\norder = api.Order(\n    action=sj.constant.Action.Buy,\n    price=15000,\n    quantity=1,\n    price_type=sj.constant.FuturesPriceType.LMT,\n    order_type=sj.constant.FuturesOrderType.ROD, \n    octype=sj.constant.FuturesOCType.Auto,\n    account=api.futopt_account\n)\n\n# place order\ntrade = api.place_order(contract, order)\ntrade\n</code></pre> <p>Out</p> <pre><code>Response Code: 0 | Event Code: 0 | Info: host '218.32.76.102:80', IP 218.32.76.102:80 (host 1 of 1) (host connection attempt 1 of 1) (total connection attempt 1 of 1) | Event: Session up\n\nTrade(\n    contract=Future(...), \n    order=Order(...),\n    status=OrderStatus(\n        id='531e27af', \n        status=&lt;Status.Submitted: 'Submitted'&gt;, \n        status_code='00', \n        order_datetime=datetime.datetime(2023, 1, 12, 11, 18, 3, 867490), \n        order_quantity=1,\n        deals=[]\n    )\n)\n</code></pre> <ul> <li> <p>You should receive the message, <code>Response Code: 0 | Event Code: 0 | Info: host '218.32.76.102:80' ...</code>, which means that you have successfully connected to our testing server. The message will only appear on your first order. If you don't receive the connected message, please confirm that all the following conditions are met.</p> <ol> <li>Doing test in the service hour</li> <li>Version restriction</li> <li><code>signed</code> is not present in your account</li> </ol> </li> <li> <p>order status should NOT be <code>Failed</code>. If you got <code>Failed</code> status, please modify your order correctly and then <code>place_order</code> again.</p> </li> <li>Contract</li> <li>Future Order</li> </ul>"},{"location":"tutor/prepare/terms/#check-if-api-tests-has-passed","title":"Check if API tests has passed","text":"<p>Attention</p> <p>Before you check, please confirm the following conditions are met.    </p> <ul> <li>Sign the API related document before you test, or you will not pass the test.</li> <li>Doing test in service hour.</li> <li>Stock accounts and Futures accounts should be tested separately.</li> <li>Waiting for reviewing your tests at least 5 minutes.</li> </ul> <p>Sign Status</p> version&gt;=1.0version&lt;1.0 <pre><code>import shioaji as sj\n\napi = sj.Shioaji(simulation=False)   # Production Mode\naccounts = api.login(\n    api_key=\"YOUR_API_KEY\",         # edit it\n    secret_key=\"YOUR_SECRET_KEY\"    # edit it\n)\naccounts\n</code></pre> <pre><code>import shioaji as sj\n\napi = sj.Shioaji(simulation=False)   # Production Mode\naccounts = api.login(\n    person_id=\"YOUR_PERSON_ID\",     # edit it\n    passwd=\"YOUR_PASSWORD\",         # edit it\n)\naccounts\n</code></pre> <p>Out</p> <pre><code>Response Code: 0 | Event Code: 0 | Info: host '203.66.91.161:80', hostname '203.66.91.161:80' IP 203.66.91.161:80 (host 1 of 1) (host connection attempt 1 of 1) (total connection attempt 1 of 1) | Event: Session up\n\n[FutureAccount(person_id='QBCCAIGJBJ', broker_id='F002000', account_id='9100020', signed=True, username='PAPIUSER01'),\nStockAccount(person_id='QBCCAIGJBJ', broker_id='9A95', account_id='0504350', username='PAPIUSER01')]\n</code></pre> <ul> <li><code>signed=True</code>: Congrats, done! Ex: FutureAccount.</li> <li><code>signed=False</code> or <code>signed</code> not present: the account haven't passed the api tests or haven't been signed the api documents. Ex: StockAccount.</li> </ul>"},{"location":"tutor/prepare/terms/#ca","title":"CA","text":"<p>You must apply and activate the CA before <code>place_order</code>.</p>"},{"location":"tutor/prepare/terms/#apply-ca","title":"Apply CA","text":"<ol> <li>Go to SinoPac Securities to download eleader </li> <li>Login eleader       </li> <li>Select (3303)\u5e33\u865f\u8cc7\u6599\u8a2d\u5b9a from the \u5e33\u6236\u8cc7\u6599 above </li> <li>Click \"\u6b65\u9a5f\u8aaa\u660e\" </li> <li>CA Operation steps </li> </ol>"},{"location":"tutor/prepare/terms/#activate-ca","title":"Activate CA","text":"<ul> <li>If you use simulation account, you don't have to activate CA.</li> <li>If you are a macOS user, you may subject to version-issue. We suggest you to use docker and run shioaji service on docker.</li> </ul> <p>In</p> <pre><code>result = api.activate_ca(\n    ca_path=\"/c/your/ca/path/Sinopac.pfx\",\n    ca_passwd=\"YOUR_CA_PASSWORD\",\n    person_id=\"Person ID of this Ca\",\n)\n\nprint(result)\n# True\n</code></pre> <p>The Certification Path</p> <p>In Windows you copy the file path with <code>\\</code> to separate the file, you need to replace it with <code>/</code>.</p>"},{"location":"tutor/prepare/terms/#check-ca-expire-time","title":"Check CA expire time","text":"<p>In</p> <pre><code>api.get_ca_expiretime(\"Person ID\")\n</code></pre>"},{"location":"tutor/prepare/token/","title":"Token & Certificate","text":"<p>After version 1.0, we will use Token as our login method. Please follow the steps below to apply and use.</p>"},{"location":"tutor/prepare/token/#apply-the-api-key","title":"Apply The API Key","text":"<ol> <li> <p>Go to the API management  page in the personal service.      </p> </li> <li> <p>Click Add API KEY.     </p> </li> <li> <p>Use your mobile phone or email to do two-factor authentication, and the API KEY can only be established if the verification is successful.     </p> </li> <li> <p>You can set expiration time, permission, which account can be used, whether it can be used in the production environment and allowed IP list of the key.     </p> <p>Permission Description</p> <ul> <li>Market / Data : Whether to use the market / data related API</li> <li>Account : Whether to use the account related API</li> <li>Trading : Whether to use the trading related API</li> <li>Production Environment : Whether to use in the production environment</li> </ul> <p>Attention</p> <p>It is recommended to limit the use of IP, which can improve the security of the KEY.</p> </li> <li> <p>If you add successfully, you will get the API Key and Secret Key.     </p> <p>Attention</p> <ul> <li> <p>Please keep your key properly and do not disclose it to anyone to avoid property loss.</p> </li> <li> <p>The Secret Key is only obtained when the establishment is successful, and there is no way to obtain it after that, please make sure to save it.</p> </li> </ul> </li> </ol>"},{"location":"tutor/prepare/token/#download-certificate","title":"Download Certificate","text":"<ol> <li> <p>Click the Download Certificate button</p> <p> </p> </li> <li> <p>Download the certificate and place it into the folder that the API can read</p> <p> </p> </li> </ol>"},{"location":"tutor/prepare/token/#confirm-the-api-key-and-certificate","title":"Confirm The API Key And Certificate","text":"<p>Continue with the previous project <code>sj-trading</code>, add <code>.env</code> file in the project folder, and add the following content</p> <p><code>.env</code> <pre><code>API_KEY=&lt;API Key&gt;\nSECRET_KEY=&lt;Secret Key&gt;\nCA_CERT_PATH=&lt;CA Certificate Path&gt;\nCA_PASSWORD=&lt;CA Certificate Password&gt;\n</code></pre></p> <p>the project folder structure should be like this <pre><code>sj-trading\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 .env\n\u251c\u2500\u2500 pyproject.toml\n\u251c\u2500\u2500 src\n\u2502   \u2514\u2500\u2500 sj_trading\n\u2502       \u2514\u2500 __init__.py\n\u2514\u2500\u2500 uv.lock\n</code></pre></p> <p>Add the <code>python-dotenv</code> package to load the key and certificate into environment variables <pre><code>uv add python-dotenv\n</code></pre></p> <p>Add the following content into <code>src/sj_trading/__init__.py</code> <pre><code>import os\nfrom dotenv import load_dotenv\n\nload_dotenv()\n\ndef main():\n    api = sj.Shioaji(simulation=True)\n    api.login(\n        api_key=os.environ[\"API_KEY\"],\n        secret_key=os.environ[\"SECRET_KEY\"],\n        fetch_contract=False\n    )\n    api.activate_ca(\n        ca_path=os.environ[\"CA_CERT_PATH\"],\n        ca_passwd=os.environ[\"CA_PASSWORD\"],\n    )\n    print(\"login and activate ca success\")\n</code></pre></p> <p>Add the <code>main</code> command into <code>pyproject.toml</code> <pre><code>[project.scripts]\nmain = \"sj_trading\"\n</code></pre></p> <p>Run the <code>main</code> command <pre><code>uv run main\n</code></pre></p> <p>If you see <code>login and activate ca success</code>, it means you have successfully logged in to the simulation environment.</p> <p>Next, if you have not yet completed the API usage signature, please proceed to the next chapter to complete the signature and pass the audit for the API.</p>"},{"location":"zh/qa/","title":"\u554f\u8207\u7b54","text":""},{"location":"zh/quickstart/","title":"\u5feb\u901f\u5165\u9580","text":"<p>Just import our API library like other popular python library and new the instance to start using our API. Login your account and activate the certification then you can start placing order.</p> <p>Note</p> <p>** Please complete the Prepare before starting, including Open Account, Terms of Service and Token. **</p>"},{"location":"zh/release/","title":"\u767c\u4f48\u7248\u672c","text":""},{"location":"zh/upgrade/","title":"\u5347\u7248\u6307\u5357","text":"<p>Version 1.0 is a major release. This document assist users migrating to version 1.0.</p>"},{"location":"zh/tutor/contract/","title":"\u5546\u54c1\u6a94","text":"<p>Contract object will be used by a lot of place like place order, subscribe quote, etc.</p>"},{"location":"zh/tutor/limit/","title":"\u4f7f\u7528\u9650\u5236","text":"<p>In order to avoid affecting other users' connections, please follow the following usage rules. </p> <p>Traffic</p> <ul> <li> <p>Stock :</p> Trading volume by API in the past 30 days Daily Traffic Limit 0 500MB 1 - 1E 2GB &gt;   1E 10GB </li> <li> <p>Future :</p> Trading volume by API in the past 30 days Daily Traffic Limit 0 500MB 1 - TXF 1000 contracts / MXF 4000 contracts 2GB &gt;   TXF 1000 contracts / MXF 4000 contracts 10GB </li> </ul> <p>Traffic query</p> <pre><code>api.usage()\n</code></pre> <p>Out</p> <pre><code>UsageStatus(connections=1, bytes=41343260, limit_bytes=2147483648, remaining_bytes=2106140388)\n</code></pre> <pre><code>connection: connection count.\nbytes: traffic.\nlimit_bytes: limit bytes of daily.\nremaining_bytes: remaining bytes of daily.\n</code></pre> <p>Counts</p> <ul> <li> <p>Data : </p> <p><code>credit_enquire</code>, <code>short_stock_sources</code>, <code>snapshots</code>, <code>ticks</code>, <code>kbars</code></p> <ul> <li>The total amount of inquiries above is limited to 50 times within 5 seconds.</li> <li>During trading hours, it is prohibited to query <code>ticks</code> more than 10 times.</li> <li>During trading hours, it is prohibited to query <code>kbars</code> more than 270 times.</li> </ul> </li> <li> <p>Portfolio :</p> <p><code>list_profit_loss_detail</code>,<code>account_balance</code>, <code>list_settlements</code>, <code>list_profit_loss</code>, <code>list_positions</code>, <code>margin</code></p> <p>The total amount of inquiries above is limited to 25 times within 5 seconds.</p> </li> <li> <p>Order :</p> <p><code>place_order</code>, <code>update_status</code>, <code>update_qty</code>, <code>update_price</code>, <code>cancel_order</code></p> <p>The total amount of inquiries above is limited to 250 times within 10 seconds.</p> </li> <li> <p>Subscribe : </p> <p>Number of <code>api.subscribe()</code> is 200.</p> </li> <li> <p>Connect : </p> <p>The same SinoPac Securities <code>person_id</code> can only use up to 5 connections.</p> <p>note. <code>api.login()</code>create a connection.</p> </li> <li> <p>Login : </p> <p>Up to 1000 times per day.</p> </li> </ul> <p>Warn</p> <ul> <li>If the traffic exceeds the limit, query requests for market data such as ticks, snapshots, and kbars will return empty values, while other functionalities remain unaffected.</li> <li>If the usage exceeds the limit, the service will be suspended for one minute.</li> <li>If the limit is exceeded multiple times in a row on the same day, the company will suspend the right to use the IP and ID.</li> <li>If the ID is suspended, please contact Shioaji management staff</li> </ul>"},{"location":"zh/tutor/login/","title":"\u767b\u5165","text":"<p>Login must have a SinoPac Securities account. If you do not have a SinoPac Securities account yet. See the document for details.</p>"},{"location":"zh/tutor/simulation/","title":"\u6a21\u64ec\u6a21\u5f0f","text":"<p>Users can first familiarize themselves with the API services in the simulation mode, which can avoid the loss of property caused by operational errors in the production environment. </p> <p>Simulation</p> <pre><code>import shioaji as sj\napi = sj.Shioaji(simulation=True)\n</code></pre>"},{"location":"zh/tutor/accounting/account_balance/","title":"\u9280\u884c\u9918\u984d","text":"<p>The feature of account_balance is used to query account balance  of stock account and you need to login first.</p> <p>In</p> <pre><code>api.account_balance?\n</code></pre> <p>Out</p> <pre><code>Signature:\n    api.account_balance(\n        timeout: int = 5000,\n        cb: Callable[[shioaji.position.AccountBalance], NoneType] = None,\n    )\nDocstring: query stock account balance \n</code></pre> <p>In</p> <pre><code>api.account_balance()\n</code></pre> <p>Out</p> <pre><code>AccountBalance(\n    status=&lt;FetchStatus.Fetched: 'Fetched'&gt;, \n    acc_balance=100000.0, \n    date='2023-01-06 13:30:00.000000', \n    errmsg=''\n)\n</code></pre> <p>AccountBalance</p> <pre><code>status (FetchStatus): fetch status\nacc_balance (float): account balance\ndate (str): query date\nerrmsg (str): error message    \n</code></pre>"},{"location":"zh/tutor/accounting/margin/","title":"\u4fdd\u8b49\u91d1","text":"<p>The feature of margin is used to query margin of futures account and you need to login first.</p> <p>In</p> <pre><code>api.margin?\n</code></pre> <p>Out</p> <pre><code>Signature:\napi.margin(\n    account: shioaji.account.Account = None,\n    timeout: int = 5000,\n    cb: Callable[[shioaji.position.Margin], NoneType] = None,\n) -&gt; shioaji.position.Margin\nDocstring: query future account of margin\n</code></pre> <p>In</p> <pre><code>api.margin(api.futopt_account)\n</code></pre> <p>Out</p> <pre><code>Margin(\n    status=&lt;FetchStatus.Fetched: 'Fetched'&gt;, \n    yesterday_balance=6000.0, \n    today_balance=6000.0, \n    deposit_withdrawal=0.0, \n    fee=0.0, \n    tax=0.0, \n    initial_margin=0.0, \n    maintenance_margin=0.0, \n    margin_call=0.0, \n    risk_indicator=999.0, \n    royalty_revenue_expenditure=0.0, \n    equity=6000.0, \n    equity_amount=6000.0, \n    option_openbuy_market_value=0.0, \n    option_opensell_market_value=0.0, \n    option_open_position=0.0, \n    option_settle_profitloss=0.0, \n    future_open_position=0.0, \n    today_future_open_position=0.0, \n    future_settle_profitloss=0.0, \n    available_margin=6000.0, \n    plus_margin=0.0, \n    plus_margin_indicator=0.0, \n    security_collateral_amount=0.0, \n    order_margin_premium=0.0, \n    collateral_amount=0.0\n)\n</code></pre> <p>Margin</p> <pre><code>status (FetchStatus): fetch status\nyesterday_balance (float): balance of yesterday\ntoday_balance (float): balance of today\ndeposit_withdrawal (float): deposit and withdrawal\nfee (float): fee\ntax (float): tax\ninitial_margin (float): margin of origin\nmaintenance_margin (float):  margin of maintenance\nmargin_call (float):  margin of call\nrisk_indicator (float): risk indicator\nroyalty_revenue_expenditure (float): revenue and expenditure of royalty\nequity (float): equity\nequity_amount (float): amount of equity\noption_openbuy_market_value (float): value of option openbuy market\noption_opensell_market_value (float): value of option opensell market\noption_open_position (float): profit loss of open option \noption_settle_profitloss (float): profit loss of settle option\nfuture_open_position (float): profit loss of open future\ntoday_future_open_position (float): profit loss of today open future\nfuture_settle_profitloss (float): profit loss of settle future\navailable_margin (float): available margin\nplus_margin (float): plus margin\nplus_margin_indicator (float): indicator of plus margin\nsecurity_collateral_amount (float): amount of security collateral\norder_margin_premium (float): order margin and order premium \ncollateral_amount (float): amount of collateral\n</code></pre>"},{"location":"zh/tutor/accounting/position/","title":"\u672a\u5be6\u73fe\u640d\u76ca","text":"<p>The feature of list_positions is used to query unrealized gain or loss of account and you need to login first.</p>"},{"location":"zh/tutor/accounting/profit_loss/","title":"\u5df2\u5be6\u73fe\u640d\u76ca","text":"<p>You need to login first.</p>"},{"location":"zh/tutor/accounting/settlements/","title":"\u7d50\u7b97","text":"<p>The feature of settlements is used to query settlements of stock account and you need to login first.</p>"},{"location":"zh/tutor/advanced/nonblock/","title":"\u975e\u963b\u585e\u6a21\u5f0f\u7bc4\u4f8b","text":"<p>Blocking is a pattern where a function must wait for something to complete. Every function is waiting, whether it is doing I/O or doing CPU tasks. For example, if the function tries to get data from the database, it needs to stop and wait for the return result, and then continue processing the next task after receiving the return result. In contrast, non-blocking mode does not wait for operations to complete. Non-blocking mode is useful if you are trying to send batch operation in a short period of time. We provide the following examples to give you a better understanding of the difference.</p> <p>To switch blocking/non-blocking mode use parameter <code>timeout</code>. Set the API parameter <code>timeout</code> to <code>0</code> for non-blocking mode. The default value of <code>timeout</code> is 5000 (milliseconds), which means the function waits for up to 5 seconds.</p>"},{"location":"zh/tutor/advanced/quote_binding/","title":"\u7d81\u8a02\u5831\u50f9\u6a21\u5f0f","text":"<p>Shioaji provides quote-binding mode which you can store tick/bidask in queue, push them to redis, or submit a stop order inside quote callback function. We show examples to make you more understand how to use quote-binding mode.</p>"},{"location":"zh/tutor/advanced/quote_manager_basic/","title":"\u884c\u60c5\u7ba1\u7406","text":"<p>the whole project code can be found in sj-trading, the whole example jupyter notebook can be found in quote_manager_usage.</p> <p>this project is created by using <code>uv</code>, if you are not familiar with how to use <code>uv</code> to create a project and manage dependencies, it is recommended to learn from the environment setup chapter.</p> <p>before start writing the quote manager, we will use the Polars package to process the quote data, so we need to add it to the project dependencies, at the same time, this tutorial will have an example of how to use Polars to quickly calculate technical indicators for multiple commodities, so we also need to add the polars_talib package to the project dependencies.</p> <p>add Polars dependencies</p> <pre><code>uv add polars polars_talib\n</code></pre> <p>if you are not familiar with Polars, you can refer to the Polars official documentation to learn how to use it.</p> <p>polars_talib is a Polars extension package that provides the complete functionality of the ta-lib library in the polars expression version, allowing us to easily calculate technical indicators using Polars. It is developed by the shioaji author, and detailed usage can be found in polars_ta_extension.</p> <p>Polars is an efficient DataFrame package that is suitable for processing large amounts of data and can use multiple cores without any additional configuration. In this example, we can see how to use the Shioaji quote manager to obtain quote data, and use Polars for parallel computation, while converting the ticks of the commodity into K lines, and performing parallel multi-commodity technical indicator calculations.</p> <p>add quote.py</p> <p>add <code>quote.py</code> file in <code>src/sj_trading/</code>, and add the following code</p> <pre><code>import shioaji as sj\nfrom typing import List\n\nclass QuoteManager:\n    def __init__(self, api: sj.Shioaji):\n        self.api = api\n        self.api.quote.set_on_tick_stk_v1_callback(self.on_stk_v1_tick_handler)\n        self.api.quote.set_on_tick_fop_v1_callback(self.on_fop_v1_tick_handler)\n        self.ticks_stk_v1: List[sj.TickSTKv1] = []\n        self.ticks_fop_v1: List[sj.TickFOPv1] = []\n\n    def on_stk_v1_tick_handler(self, _exchange: sj.Exchange, tick: sj.TickSTKv1):\n        self.ticks_stk_v1.append(tick)\n\n    def on_fop_v1_tick_handler(self, _exchange: sj.Exchange, tick: sj.TickFOPv1):\n        self.ticks_fop_v1.append(tick)\n</code></pre> <p>this part is relatively simple, let the handle func of receiving the quote data do as little as possible, we define a <code>QuoteManager</code> class, and register two callback functions in the initialization, respectively <code>on_stk_v1_tick_handler</code> and <code>on_fop_v1_tick_handler</code>, these two functions will be called when receiving the quote data, and the quote data will be stored in <code>ticks_stk_v1</code> and <code>ticks_fop_v1</code>.</p> <p>add <code>QuoteManager</code> subscribe and unsubscribe methods</p> <pre><code>def __init__(self, api: sj.Shioaji):\n    # skip\n    self.subscribed_stk_tick: Set[str] = set()\n\ndef subscribe_stk_tick(self, codes: List[str], recover: bool = False):\n    for code in codes:\n        contract = self.api.Contracts.Stocks[code]\n        if contract is not None and code not in self.subscribed_stk_tick:\n            self.api.quote.subscribe(contract, \"tick\")\n            self.subscribed_stk_tick.add(code)\n\ndef unsubscribe_stk_tick(self, codes: List[str]):\n    for code in codes:\n        contract = self.api.Contracts.Stocks[code]\n        if contract is not None and code in self.subscribed_stk_tick:\n            self.api.quote.unsubscribe(contract, \"tick\")\n            self.subscribed_stk_tick.remove(code)\n\ndef unsubscribe_all_stk_tick(self):\n    for code in self.subscribed_stk_tick:\n        contract = self.api.Contracts.Stocks[code]\n        if contract is not None:\n            self.api.quote.unsubscribe(contract, \"tick\")\n    self.subscribed_stk_tick.clear()\n</code></pre> <p>in the above code, we have added the <code>subscribe_stk_tick</code> method, this method will add the commodity codes in the incoming commodity code list to the <code>subscribed_stk_tick</code>, and call the <code>subscribe</code> method of Shioaji to subscribe to the market, <code>subscribed_stk_tick</code> is a <code>Set</code>, used to store the commodity codes that have been subscribed to avoid duplicate subscriptions and facilitate subsequent unsubscribing all subscribed commodities.</p> <p>add <code>QuoteManager</code> get ticks method</p> <pre><code>def __init__(self, api: sj.Shioaji):\n    # skip\n    self.df_stk: pl.DataFrame = pl.DataFrame(\n        [],\n        schema=[\n            (\"datetime\", pl.Datetime),\n            (\"code\", pl.Utf8),\n            (\"price\", pl.Float64),\n            (\"volume\", pl.Int64),\n            (\"tick_type\", pl.Int8),\n        ],\n    )\n\ndef get_df_stk(self) -&gt; pl.DataFrame:\n    poped_ticks, self.ticks_stk_v1 = self.ticks_stk_v1, []\n    if poped_ticks:\n        df = pl.DataFrame([tick.to_dict() for tick in poped_ticks]).select(\n            pl.col(\"datetime\", \"code\"),\n            pl.col(\"close\").cast(pl.Float64).alias(\"price\"),\n            pl.col(\"volume\").cast(pl.Int64),\n            pl.col(\"tick_type\").cast(pl.Int8),\n        )\n        self.df_stk = self.df_stk.vstack(df)\n    return self.df_stk\n</code></pre> <p>in <code>__init__</code> we define a <code>df_stk</code> Polars DataFrame, used to store all subscribed stock tick data, <code>get_df_stk</code> method will convert the <code>ticks_stk_v1</code> list to a Polars DataFrame, and return it, at this point, we have already got a DataFrame that can be used to calculate technical indicators.</p> <p> </p> <p>add <code>QuoteManager</code> get kbar method</p> <pre><code>def get_df_stk_kbar(\n    self, unit: str = \"1m\", exprs: List[pl.Expr] = []\n) -&gt; pl.DataFrame:\n    df = self.get_df_stk()\n    df = df.group_by(\n        pl.col(\"datetime\").dt.truncate(unit),\n        pl.col(\"code\"),\n        maintain_order=True,\n    ).agg(\n        pl.col(\"price\").first().alias(\"open\"),\n        pl.col(\"price\").max().alias(\"high\"),\n        pl.col(\"price\").min().alias(\"low\"),\n        pl.col(\"price\").last().alias(\"close\"),\n        pl.col(\"volume\").sum().alias(\"volume\"),\n    )\n    if exprs:\n        df = df.with_columns(exprs)\n    return df\n</code></pre> <p>in <code>get_df_stk_kbar</code> method, we will use <code>get_df_stk</code> method to get the Ticks DataFrame and then group the data by truncated <code>datetime</code> and <code>code</code>, and then aggregate the data in each group to get the K line data, finally, we will return the K line DataFrame. Here we remain the <code>exprs</code> parameter, allowing users to pass in additional expressions for more calculations.</p> <p>In this part, we use <code>1m</code> to represent 1 minute, if you want to get 5 minutes K line, you can change the unit to <code>5m</code>, 1 hour K line can be changed to <code>1h</code>, if you want more different units, you can refer to the  truncate API documentation.</p> <p>add custom technical indicator calculation method</p> <pre><code>import polars as pl\nimport polars_talib as plta\n\nquote_manager.get_df_stk_kbar(\"5m\", [\n    pl.col(\"close\").ta.ema(5).over(\"code\").fill_nan(None).alias(\"ema5\"),\n    plta.macd(pl.col(\"close\"), 12, 26, 9).over(\"code\").struct.field(\"macd\").fill_nan(None),\n])\n</code></pre> <p>in this part, we use polars_ta to calculate technical indicators and add them to the K line data, here we calculate <code>ema</code> and <code>macd</code> two indicators, more indicators can refer to polars_ta_extension supported indicators list.</p> <p>in this polars_ta expression, we use <code>over(\"code\")</code> to group the data by commodity code for independent calculation of each commodity, so even if all commodities are in the same DataFrame, the calculation results are independent of each other, and this <code>over</code> partition is automatically parallel computing, so even if there are a large number of commodities, the calculation can be very fast and then using <code>alias</code> to set the field name of the calculation result as <code>ema5</code>, in the <code>macd</code> indicator, the return is a struct with multiple fields, and this part gets the <code>macd</code> field.</p> <p>because this part only passes in expressions and is very lightweight, you can pass in any expressions you need according to your needs, and you can also make your own indicators using polars expression, this part just provides an interface for calculation and a simple usage example.</p> <p>add <code>QuoteManager</code> backfill missed ticks method</p> <pre><code>def fetch_ticks(self, contract: BaseContract) -&gt; pl.DataFrame:\n    code = contract.code\n    ticks = self.api.ticks(contract)\n    df = pl.DataFrame(ticks.dict()).select(\n        pl.from_epoch(\"ts\", time_unit=\"ns\").dt.cast_time_unit(\"us\").alias(\"datetime\"),\n        pl.lit(code).alias(\"code\"),\n        pl.col(\"close\").alias(\"price\"),\n        pl.col(\"volume\").cast(pl.Int64),\n        pl.col(\"tick_type\").cast(pl.Int8),\n    )\n    return df\n\ndef subscribe_stk_tick(self, codes: List[str], recover: bool = False):\n    for code in codes:\n        # skop\n        if recover:\n            df = self.fetch_ticks(contract)\n            if not df.is_empty():\n                code_ticks = [t for t in self.ticks_stk_v1 if t.code == code]\n                if code_ticks:\n                    t_first = code_ticks[0].datetime\n                    df = df.filter(pl.col(\"datetime\") &lt; t_first)\n                    self.df_stk = self.df_stk.vstack(df)\n                else:\n                    self.df_stk = self.df_stk.vstack(df)\n</code></pre> <p>in <code>subscribe_stk_tick</code> method, we will check if the <code>recover</code> parameter is true, if it is, we will call <code>fetch_ticks</code> method to get the historical ticks data, and then use <code>filter</code> method to filter out the ticks data that have been received, and use <code>vstack</code> method to add the historical ticks data to the <code>df_stk</code> DataFrame.</p> <p>In above we have completed a quote manager that can subscribe to market data, backfill missed ticks, and calculate technical indicators. Next, we will integrate all the code and use it in a jupyter lab environment.</p> <p>The complete QuoteManager can be found in quote.py.</p> <p>The complete example jupyter notebook can be found in quote_manager_usage.</p>"},{"location":"zh/tutor/advanced/touchorder/","title":"\u89f8\u50f9\u59d4\u8a17\u7bc4\u4f8b","text":""},{"location":"zh/tutor/callback/event_cb/","title":"\u4e8b\u4ef6","text":"<p>In this api, we use solace as mesh broker. This event mean the status for your client with solace connection situation. If you have no experience with networking, please skip this part, In defalut, we help you reconnect solace broker 50 times without any setting. Best way is keep your network connection alive.</p> <p>In</p> <pre><code>@api.quote.on_event\ndef event_callback(resp_code: int, event_code: int, info: str, event: str):\n    print(f'Event code: {event_code} | Event: {event}')\n</code></pre> <p>Out</p> <pre><code>Event code: 16 | Event: Subscribe or Unsubscribe ok\n</code></pre> <p>Like the quote callback, your can also set event cllback with two way.</p> <p>In</p> <pre><code>api.quote.set_event_callback?\n</code></pre> <p>Out</p> <pre><code>Signature: api.quote.set_event_callback(func:Callable[[int, int, str, str], NoneType]) -&gt; None\nDocstring: &lt;no docstring&gt;\nType:      method\n</code></pre>"},{"location":"zh/tutor/callback/orderdeal_event/","title":"\u59d4\u8a17\u56de\u5831","text":"<p>Each time you <code>place_order</code>, <code>update_order</code> or <code>cancel_order</code>, by default, you will recieve an order event (or deal event) from exchange. If you don't want recieve both events, please refer to Subscribe Trade. We also provide interface to handle order and deal events. It's extremely helpful if you are implementing your custom trading system.</p>"},{"location":"zh/tutor/market_data/credit_enquires/","title":"\u8cc7\u5238\u9918\u984d","text":"<p>Credit Enquires</p> <pre><code>&gt;&gt; api.credit_enquires?\n\nSignature:\napi.credit_enquires(\n    contracts: List[shioaji.contracts.Stock],\n    timeout: int = 30000,\n    cb: Callable[[shioaji.data.CreditEnquire], NoneType] = None,\n) -&gt; List[shioaji.data.CreditEnquire]\n</code></pre>"},{"location":"zh/tutor/market_data/historical/","title":"\u6b77\u53f2\u884c\u60c5","text":""},{"location":"zh/tutor/market_data/scanners/","title":"\u6392\u884c","text":"<p>Scanners can use parameter of scannertype to get the rank of ChangePercent, ChangePrice, DayRange, Volume and Amount. </p> <p>Scanners</p> <pre><code>&gt;&gt; api.scanners?\n\nSignature:\napi.scanners(\n    scanner_type: shioaji.constant.ScannerType, \n    ascending: bool = True,\n    date: str = None,\n    count: shioaji.shioaji.ConstrainedIntValue = 100, # 0 &lt;= count &lt;= 200\n    timeout: int = 30000,\n    cb: Callable[[List[shioaji.data.ChangePercentRank]], NoneType] = None,\n) -&gt; List[shioaji.data.ChangePercentRank]\n</code></pre> <p>Ascending is sorted from largest to smallest by default, and the value of ascending is True. Set ascending to False to sort in descending order, and the other ranking methods are the same. <code>count</code> is how many ranks you get.</p> <p>Supported Scanner Type</p> <pre><code>ChangePercentRank: rank by price percentage change\nChangePriceRank: rank by price change\nDayRangeRank: rank by day range\nVolumeRank: rank by volume\nAmountRank: rank by amount\n</code></pre>"},{"location":"zh/tutor/market_data/short_stock_source/","title":"\u6216\u6709\u5238\u6e90","text":"<p>Short Stock Sources</p> <pre><code>&gt;&gt; api.short_stock_sources?\n\nSignature:\napi.short_stock_sources(\n    contracts: List[shioaji.contracts.Stock],\n    timeout: int = 5000,\n    cb: Callable[[shioaji.data.ShortStockSource], NoneType] = None,\n) -&gt; List[shioaji.data.ShortStockSource]\n</code></pre>"},{"location":"zh/tutor/market_data/snapshot/","title":"\u5e02\u5834\u5feb\u7167","text":"<p>Snapshot is a present stock, future, option info. It contain open, high, low, close, change price, average price, volume, total volume, buy price, buy volume, sell price, sell volume and yesterday volume.</p> <p>Reminder </p> <p>Each snapshot can contain up to 500 contracts.</p> <p>Snapshots</p> <pre><code>&gt;&gt; api.snapshots?\n\nSignature:\napi.snapshots(\n    contracts: List[Union[shioaji.contracts.Option, shioaji.contracts.Future, shioaji.contracts.Stock, shioaji.contracts.Index]],\n    timeout: int = 30000,\n    cb: Callable[[shioaji.data.Snapshot], NoneType] = None,\n) -&gt; List[shioaji.data.Snapshot]\nDocstring:\nget contract snapshot info\n</code></pre>"},{"location":"zh/tutor/market_data/streaming/futures/","title":"\u671f\u8ca8","text":"<p>To subscribe quotes is very easy, just call <code>subscribe</code> function with contract which we've discussed in previous topic.</p> <p>Subscribe</p> <pre><code>api.quote.subscribe?\n\n    Signature:\n        api.quote.subscribe(\n            contract:shioaji.contracts.Contract,\n            quote_type:shioaji.constant.QuoteType=&lt;QuoteType.Tick: 'tick'&gt;,\n            intraday_odd:bool=False,\n            version: shioaji.constant.QuoteVersion=&lt;QuoteVersion.v0: 'v0'&gt;,\n        )\n    Docstring: &lt;no docstring&gt;\n    Type:      method\n</code></pre> <p>Quote Parameters:</p> <pre><code>quote_type: tick price or bid/ask price to subscribe\n    {'tick', 'bidask'}\nintraday_odd: \u76e4\u4e2d\u96f6\u80a1\n    {True, False}\nversion: version of quote format\n    {'v1', 'v0'}\n</code></pre>"},{"location":"zh/tutor/market_data/streaming/stocks/","title":"\u8b49\u5238","text":"<p>To subscribe quotes is very easy, just call <code>subscribe</code> function with contract which we've discussed in previous topic.</p> <p>Subscribe</p> <pre><code>&gt;&gt; api.quote.subscribe?\n\nSignature:\n    api.quote.subscribe(\n        contract:shioaji.contracts.Contract,\n        quote_type:shioaji.constant.QuoteType=&lt;QuoteType.Tick: 'tick'&gt;,\n        intraday_odd:bool=False,\n        version: shioaji.constant.QuoteVersion=&lt;QuoteVersion.v0: 'v0'&gt;,\n    )\n</code></pre> <p>Quote Parameters</p> <pre><code>quote_type: tick price or bid/ask price to subscribe\n    {'tick', 'bidask'}\nintraday_odd: \u76e4\u4e2d\u96f6\u80a1\n    {True, False}\nversion: version of quote format\n    {'v1', 'v0'}\n</code></pre>"},{"location":"zh/tutor/order/Combo/","title":"\u7d44\u5408\u55ae","text":"<p>Reminder </p> <p>First, you need to login and activate CA.</p>"},{"location":"zh/tutor/order/FutureOption/","title":"\u671f\u8ca8\u9078\u64c7\u6b0a","text":"<p>Reminder </p> <p>First, you need to login and activate CA.</p>"},{"location":"zh/tutor/order/IntradayOdd/","title":"\u96f6\u80a1","text":"<p>Reminder </p> <p>First, you need to login and activate CA.</p> <p>place intraday odd order jupyter link</p>"},{"location":"zh/tutor/order/Reserve/","title":"\u9810\u6536\u5238\u6b3e","text":"<p>When Stock triggers some transaction abnormal conditions, it is necessary to <code>Reserve Order</code> in advance. Abnormal conditions include: watch out for stocks, warn about stocks, dispose of stocks, and manage stocks.</p> <p>Reminder </p> <ul> <li>First, you need to login and activate CA.</li> <li>Service hours are from 8:00 to 14:30 on trading days.</li> </ul>"},{"location":"zh/tutor/order/Stock/","title":"\u8b49\u5238","text":"<p>Reminder </p> <p>First, you need to login and activate CA.</p>"},{"location":"zh/tutor/order/UpdateStatus/","title":"\u67e5\u8a62\u72c0\u614b","text":"<p>Reminder </p> <p>First, you need to login and activate CA.</p> <p>Before obtaining the <code>Trade</code> status, it must be updated with <code>update_status</code>. If you cannot successfully <code>update_order</code> or <code>cancel_order</code>, you can use <code>update_status</code> to update the specific <code>trade</code> status, and check the <code>OrderStatus</code> in <code>trade</code>, whether it is available to modify the order.</p> <p>The update_status defaults to querying all accounts under the user's name. If you wish to inquire about a specific account, provide the account as a parameter to account.</p> <p>Update Status</p> <pre><code>api.update_status?\n</code></pre> <p>Out</p> <pre><code>Signature:\n    api.update_status(\n        account: shioaji.account.Account = None,\n        trade: shioaji.order.Trade = None,\n        timeout: int = 5000,\n        cb: Callable[[List[shioaji.order.Trade]], NoneType] = None,\n    )\nDocstring: update status of all trades you have\n</code></pre>"},{"location":"zh/tutor/order/order_deal_event/futures/","title":"\u671f\u8ca8","text":""},{"location":"zh/tutor/order/order_deal_event/stocks/","title":"\u8b49\u5238","text":""},{"location":"zh/tutor/prepare/example_testing_flow/","title":"\u6e2c\u8a66\u5c08\u6848\u7bc4\u4f8b","text":"<p>First, we extend the project <code>sj-trading</code> created using <code>uv</code> in the environment creation chapter to add the testing flow part.</p> <p>The complete project code can be referred to sj-trading https://github.com/Sinotrade/sj-trading-demo.</p> <p>You can use <code>git</code> to clone the entire environment to your local machine and use it directly.</p> <p>Download Project</p> <pre><code>git clone https://github.com/Sinotrade/sj-trading-demo.git\ncd sj-trading-demo\n</code></pre> <p>Next, we will step by step introduce how to add the testing flow.</p>"},{"location":"zh/tutor/prepare/open_account/","title":"\u958b\u6236","text":"<p>To use Shioaji, you must have a SinoPac Securities account. If you do not have a SinoPac Securities account yet, please follow the steps below to open an account:</p> <ol> <li>To Open Account Page.      </li> <li>If you do not have a bank account with Bank SinoPac, please open a bank account as your delivery account.     </li> <li>Please select\u6211\u8981\u958bDAWHO+\u5927\u6236\u6295, to open a bank account and a securities account.     </li> <li>Complete bank and securities account opening.</li> </ol>"},{"location":"zh/tutor/prepare/terms/","title":"\u670d\u52d9\u689d\u6b3e\u7c3d\u7f72","text":"<p>Restricted by Taiwan's financial regulations, new users need to sign relevant documents and complete a test report in the simulation mode before using it in a production environment.</p>"},{"location":"zh/tutor/prepare/token/","title":"\u91d1\u9470\u8207\u6191\u8b49\u7533\u8acb","text":"<p>After version 1.0, we will use Token as our login method. Please follow the steps below to apply and use.</p>"}]}